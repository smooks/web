<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0071)http://smooks.org/mediawiki/index.php?title=V1.5:Smooks_v1.5_User_Guide -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="generator" content="MediaWiki 1.13.3">
		<meta name="keywords" content="V1.5:Smooks v1.5 User Guide,V1.5:Smooks v1.5 User Guide,Examples,FAQ,Maven &amp; Ant,Smooks v1.2 Examples,Smooks v1.2 User Guide,Smooks v1.5 Examples,Useful Regular Expressions,User Documentation,V1.2:groovy">
		<link rel="shortcut icon" href="http://smooks.org/mediawiki/skins/common/images/smooks-favicon.png">
		<link rel="search" type="application/opensearchdescription+xml" href="http://smooks.org/mediawiki/opensearch_desc.php" title="Smooks (en)">
		<link rel="alternate" type="application/rss+xml" title="Smooks RSS Feed" href="http://www.smooks.org/mediawiki/index.php?title=Special:RecentChanges&amp;feed=rss">
		<link rel="alternate" type="application/atom+xml" title="Smooks Atom Feed" href="http://www.smooks.org/mediawiki/index.php?title=Special:RecentChanges&amp;feed=atom">
    <title>V1.5:Smooks v1.5 User Guide - Smooks</title>
    <style type="text/css" media="screen,projection">/*<![CDATA[*/
		@import "/mediawiki/skins/common/shared.css?164";
		@import "/mediawiki/skins/gumaxdd/gumax_main.css?164";
	/*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="./User-Guide_files/commonPrint.css">
	<link rel="stylesheet" type="text/css" media="print" href="./User-Guide_files/gumax_print.css">
    <!--[if lt IE 5.5000]><style type="text/css">@import "/mediawiki/skins/gumaxdd/IE50Fixes.css?164";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "/mediawiki/skins/gumaxdd/IE55Fixes.css?164";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "/mediawiki/skins/gumaxdd/IE60Fixes.css?164";</style><![endif]-->
    <!--[if IE 7]><style type="text/css">@import "/mediawiki/skins/gumaxdd/IE70Fixes.css?164";</style><![endif]-->
    <!--[if lt IE 7]><script type="text/javascript" src="/mediawiki/skins/common/IEFixes.js?164"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
	<script type="text/javascript" src="./User-Guide_files/jquery-1.3.2.min.js"></script>
	<script type="text/javascript" src="./User-Guide_files/jquery.droppy.js"></script>
	<script type="text/javascript"> $(function() { $('#gumax-nav').droppy({speed: 100}); }); </script>

    <script type="text/javascript">/*<![CDATA[*/
var skin = "gumaxdd";
var stylepath = "/mediawiki/skins";
var wgArticlePath = "/mediawiki/index.php?title=$1";
var wgScriptPath = "/mediawiki";
var wgScript = "/mediawiki/index.php";
var wgVariantArticlePath = false;
var wgActionPaths = [];
var wgServer = "http://www.smooks.org";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "V1.5:Smooks_v1.5_User_Guide";
var wgTitle = "V1.5:Smooks v1.5 User Guide";
var wgAction = "view";
var wgArticleId = "581";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "en";
var wgContentLanguage = "en";
var wgBreakFrames = false;
var wgCurRevisionId = "2594";
var wgVersion = "1.13.3";
var wgEnableAPI = true;
var wgEnableWriteAPI = false;
var wgRestrictionEdit = [];
var wgRestrictionMove = [];
/*]]>*/</script>

    <script type="text/javascript" src="./User-Guide_files/wikibits.js"><!-- wikibits js --></script><style type="text/css">@import "/mediawiki/skins/gumaxdd/KHTMLFixes.css";</style>
            <script type="text/javascript" src="./User-Guide_files/index.php"><!-- site js --></script>
                <style type="text/css">/*<![CDATA[*/
@import "/mediawiki/index.php?title=MediaWiki:Common.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "/mediawiki/index.php?title=MediaWiki:Gumaxdd.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "/mediawiki/index.php?title=-&action=raw&gen=css&maxage=18000&useskin=gumaxdd";
/*]]>*/</style>
        <!-- Head Scripts -->
    		<script type="text/javascript" src="./User-Guide_files/ajax.js"></script>
<meta name="chromesniffer" id="chromesniffer_meta" content="{&quot;MediaWiki&quot;:-1,&quot;Google Analytics&quot;:-1,&quot;jQuery&quot;:&quot;1.3.2&quot;}"><script type="text/javascript" src="chrome-extension://homgcnaoacgigpkkljjjekpignblkeae/detector.js"></script></head>

<body class="mediawiki ns-0 ltr page-V1_5_Smooks_v1_5_User_Guide">

<!-- ===== gumax-page ===== -->
<div id="gumax-page">


	<!-- ///// gumax-header ///// -->
	<div id="gumax-header">
		<a name="top" id="contentTop"></a>

		<!-- gumax-p-logo -->
		<div id="gumax-p-logo">
				<div id="p-logo">
		<a style="background-image: url(/mediawiki/skins/common/images/smooks-logo.png);" href="http://smooks.org/mediawiki/index.php?title=Main_Page" title="Visit the Main Page [z]" accesskey="z"></a>
	</div>

<table id="toc" class="toc" summary="Contents"><tbody><tr><td>
<ul>
<li class="toclevel-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a>
<ul>
<li class="toclevel-2"><a href="#What.27s_new_in_Smooks_v1.5.3F"><span class="tocnumber">1.1</span> <span class="toctext">What's new in Smooks v1.5?</span></a></li>
<li class="toclevel-2"><a href="#Getting_Started"><span class="tocnumber">1.2</span> <span class="toctext">Getting Started</span></a></li>
<li class="toclevel-2"><a href="#FAQs"><span class="tocnumber">1.3</span> <span class="toctext">FAQs</span></a></li>
<li class="toclevel-2"><a href="#Maven"><span class="tocnumber">1.4</span> <span class="toctext">Maven</span></a></li>
<li class="toclevel-2"><a href="#Ant"><span class="tocnumber">1.5</span> <span class="toctext">Ant</span></a></li>
<li class="toclevel-2"><a href="#Download"><span class="tocnumber">1.6</span> <span class="toctext">Download</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Basics"><span class="tocnumber">2</span> <span class="toctext">Basics</span></a>
<ul>
<li class="toclevel-2"><a href="#Basic_Processing_Model"><span class="tocnumber">2.1</span> <span class="toctext">Basic Processing Model</span></a></li>
<li class="toclevel-2"><a href="#Simple_Example"><span class="tocnumber">2.2</span> <span class="toctext">Simple Example</span></a></li>
<li class="toclevel-2"><a href="#Smooks_Resources_.28Visitors_etc.29"><span class="tocnumber">2.3</span> <span class="toctext">Smooks Resources (Visitors etc)</span></a>
<ul>
<li class="toclevel-3"><a href="#Selectors"><span class="tocnumber">2.3.1</span> <span class="toctext">Selectors</span></a></li>
<li class="toclevel-3"><a href="#Namespace_Declaration"><span class="tocnumber">2.3.2</span> <span class="toctext">Namespace Declaration</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Smooks_Cartridges"><span class="tocnumber">2.4</span> <span class="toctext">Smooks Cartridges</span></a></li>
<li class="toclevel-2"><a href="#Filtering_Process_Selection_.28DOM_or_SAX.3F.29"><span class="tocnumber">2.5</span> <span class="toctext">Filtering Process Selection (DOM or SAX?)</span></a>
<ul>
<li class="toclevel-3"><a href="#Mixing_DOM_and_SAX"><span class="tocnumber">2.5.1</span> <span class="toctext">Mixing DOM and SAX</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#The_Bean_Context"><span class="tocnumber">2.6</span> <span class="toctext">The Bean Context</span></a>
<ul>
<li class="toclevel-3"><a href="#Pre_Installed_Beans"><span class="tocnumber">2.6.1</span> <span class="toctext">Pre Installed Beans</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Multiple_Outputs.2FResults"><span class="tocnumber">2.7</span> <span class="toctext">Multiple Outputs/Results</span></a>
<ul>
<li class="toclevel-3"><a href="#.22In-Result.22_Instances"><span class="tocnumber">2.7.1</span> <span class="toctext">"In-Result" Instances</span></a>
<ul>
<li class="toclevel-4"><a href="#StreamResults_.2F_DOMResults"><span class="tocnumber">2.7.1.1</span> <span class="toctext">StreamResults / DOMResults</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#During_the_Filtering_Process"><span class="tocnumber">2.7.2</span> <span class="toctext">During the Filtering Process</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Checking_the_Smooks_Execution_Process"><span class="tocnumber">2.8</span> <span class="toctext">Checking the Smooks Execution Process</span></a></li>
<li class="toclevel-2"><a href="#Terminating_the_Filtering_Process"><span class="tocnumber">2.9</span> <span class="toctext">Terminating the Filtering Process</span></a></li>
<li class="toclevel-2"><a href="#Global_Configurations"><span class="tocnumber">2.10</span> <span class="toctext">Global Configurations</span></a>
<ul>
<li class="toclevel-3"><a href="#Global_Configuration_Parameters"><span class="tocnumber">2.10.1</span> <span class="toctext">Global Configuration Parameters</span></a></li>
<li class="toclevel-3"><a href="#Default_Properties"><span class="tocnumber">2.10.2</span> <span class="toctext">Default Properties</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Filter_Settings"><span class="tocnumber">2.11</span> <span class="toctext">Filter Settings</span></a></li>
<li class="toclevel-2"><a href="#Configuration_Modularization"><span class="tocnumber">2.12</span> <span class="toctext">Configuration Modularization</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Consuming_Input_Data"><span class="tocnumber">3</span> <span class="toctext">Consuming Input Data</span></a>
<ul>
<li class="toclevel-2"><a href="#XML"><span class="tocnumber">3.1</span> <span class="toctext">XML</span></a></li>
<li class="toclevel-2"><a href="#CSV"><span class="tocnumber">3.2</span> <span class="toctext">CSV</span></a>
<ul>
<li class="toclevel-3"><a href="#Defining_fields"><span class="tocnumber">3.2.1</span> <span class="toctext">Defining fields</span></a>
<ul>
<li class="toclevel-4"><a href="#Multi_Record_Field_Definitions"><span class="tocnumber">3.2.1.1</span> <span class="toctext">Multi Record Field Definitions</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#String_manipulation_functions"><span class="tocnumber">3.2.2</span> <span class="toctext">String manipulation functions</span></a></li>
<li class="toclevel-3"><a href="#Ignoring_Fields"><span class="tocnumber">3.2.3</span> <span class="toctext">Ignoring Fields</span></a></li>
<li class="toclevel-3"><a href="#Binding_CSV_Records_to_Java"><span class="tocnumber">3.2.4</span> <span class="toctext">Binding CSV Records to Java</span></a></li>
<li class="toclevel-3"><a href="#Programmatic_Configuration"><span class="tocnumber">3.2.5</span> <span class="toctext">Programmatic Configuration</span></a>
<ul>
<li class="toclevel-4"><a href="#Configuring_Directly_on_the_Smooks_Instance"><span class="tocnumber">3.2.5.1</span> <span class="toctext">Configuring Directly on the Smooks Instance</span></a></li>
<li class="toclevel-4"><a href="#CSV_List_and_Map_Binders"><span class="tocnumber">3.2.5.2</span> <span class="toctext">CSV List and Map Binders</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2"><a href="#Fixed_Length_Values"><span class="tocnumber">3.3</span> <span class="toctext">Fixed Length Values</span></a>
<ul>
<li class="toclevel-3"><a href="#Defining_fields_2"><span class="tocnumber">3.3.1</span> <span class="toctext">Defining fields</span></a></li>
<li class="toclevel-3"><a href="#String_manipulation_functions_2"><span class="tocnumber">3.3.2</span> <span class="toctext">String manipulation functions</span></a></li>
<li class="toclevel-3"><a href="#Ignoring_Fields_2"><span class="tocnumber">3.3.3</span> <span class="toctext">Ignoring Fields</span></a></li>
<li class="toclevel-3"><a href="#Binding_fixed_length_Records_to_Java"><span class="tocnumber">3.3.4</span> <span class="toctext">Binding fixed length Records to Java</span></a></li>
<li class="toclevel-3"><a href="#Programmatic_Configuration_2"><span class="tocnumber">3.3.5</span> <span class="toctext">Programmatic Configuration</span></a>
<ul>
<li class="toclevel-4"><a href="#Configuring_Directly_on_the_Smooks_Instance_2"><span class="tocnumber">3.3.5.1</span> <span class="toctext">Configuring Directly on the Smooks Instance</span></a></li>
<li class="toclevel-4"><a href="#Fixed_length_List_and_Map_Binders"><span class="tocnumber">3.3.5.2</span> <span class="toctext">Fixed length List and Map Binders</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2"><a href="#EDI"><span class="tocnumber">3.4</span> <span class="toctext">EDI</span></a>
<ul>
<li class="toclevel-3"><a href="#EDI_Mapping_Models"><span class="tocnumber">3.4.1</span> <span class="toctext">EDI Mapping Models</span></a>
<ul>
<li class="toclevel-4"><a href="#Segment_Cardinality"><span class="tocnumber">3.4.1.1</span> <span class="toctext">Segment Cardinality</span></a></li>
<li class="toclevel-4"><a href="#Segment_Groups"><span class="tocnumber">3.4.1.2</span> <span class="toctext">Segment Groups</span></a></li>
<li class="toclevel-4"><a href="#Segment_Matching"><span class="tocnumber">3.4.1.3</span> <span class="toctext">Segment Matching</span></a></li>
<li class="toclevel-4"><a href="#Required_Values_.26_Truncation"><span class="tocnumber">3.4.1.4</span> <span class="toctext">Required Values &amp; Truncation</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#Imports"><span class="tocnumber">3.4.2</span> <span class="toctext">Imports</span></a></li>
<li class="toclevel-3"><a href="#Type_Support"><span class="tocnumber">3.4.3</span> <span class="toctext">Type Support</span></a></li>
<li class="toclevel-3"><a href="#Programmatic_Configuration_3"><span class="tocnumber">3.4.4</span> <span class="toctext">Programmatic Configuration</span></a></li>
<li class="toclevel-3"><a href="#EJC_-_Edifact_Java_Compiler"><span class="tocnumber">3.4.5</span> <span class="toctext">EJC - Edifact Java Compiler</span></a>
<ul>
<li class="toclevel-4"><a href="#EJC_Maven_Plugin"><span class="tocnumber">3.4.5.1</span> <span class="toctext">EJC Maven Plugin</span></a></li>
<li class="toclevel-4"><a href="#EJC_Ant_Task"><span class="tocnumber">3.4.5.2</span> <span class="toctext">EJC Ant Task</span></a></li>
<li class="toclevel-4"><a href="#Using_EJC"><span class="tocnumber">3.4.5.3</span> <span class="toctext">Using EJC</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#UN.2FEDIFACT"><span class="tocnumber">3.4.6</span> <span class="toctext">UN/EDIFACT</span></a>
<ul>
<li class="toclevel-4"><a href="#UNEdifactReader_Reader_Configuration"><span class="tocnumber">3.4.6.1</span> <span class="toctext">UNEdifactReader Reader Configuration</span></a></li>
<li class="toclevel-4"><a href="#Application_Classpath_Configuration"><span class="tocnumber">3.4.6.2</span> <span class="toctext">Application Classpath Configuration</span></a></li>
<li class="toclevel-4"><a href="#Mapping_Model_Zip_Sets"><span class="tocnumber">3.4.6.3</span> <span class="toctext">Mapping Model Zip Sets</span></a></li>
<li class="toclevel-4"><a href="#UN.2FEDIFACT_Mapping_Model_URNs"><span class="tocnumber">3.4.6.4</span> <span class="toctext">UN/EDIFACT Mapping Model URNs</span></a></li>
<li class="toclevel-4"><a href="#Reading_and_Writing_UN.2FEDIFACT_with_Java"><span class="tocnumber">3.4.6.5</span> <span class="toctext">Reading and Writing UN/EDIFACT with Java</span></a></li>
<li class="toclevel-4"><a href="#UN.2FEDIFACT_Java_Binding_URNs"><span class="tocnumber">3.4.6.6</span> <span class="toctext">UN/EDIFACT Java Binding URNs</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2"><a href="#JSON"><span class="tocnumber">3.5</span> <span class="toctext">JSON</span></a>
<ul>
<li class="toclevel-3"><a href="#Programmatic_Configuration_4"><span class="tocnumber">3.5.1</span> <span class="toctext">Programmatic Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#YAML"><span class="tocnumber">3.6</span> <span class="toctext">YAML</span></a>
<ul>
<li class="toclevel-3"><a href="#Programmatic_Configuration_5"><span class="tocnumber">3.6.1</span> <span class="toctext">Programmatic Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Java_to_Java"><span class="tocnumber">3.7</span> <span class="toctext">Java to Java</span></a>
<ul>
<li class="toclevel-3"><a href="#Source_and_Target_Object_Models"><span class="tocnumber">3.7.1</span> <span class="toctext">Source and Target Object Models</span></a></li>
<li class="toclevel-3"><a href="#Source_Model_Event_Stream"><span class="tocnumber">3.7.2</span> <span class="toctext">Source Model Event Stream</span></a>
<ul>
<li class="toclevel-4"><a href="#Smooks_Configuration"><span class="tocnumber">3.7.2.1</span> <span class="toctext">Smooks Configuration</span></a></li>
<li class="toclevel-4"><a href="#Smooks_Execution"><span class="tocnumber">3.7.2.2</span> <span class="toctext">Smooks Execution</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2"><a href="#Java_to_Text_.28XML.2C_CSV.2C_EDI_etc.29"><span class="tocnumber">3.8</span> <span class="toctext">Java to Text (XML, CSV, EDI etc)</span></a></li>
<li class="toclevel-2"><a href="#String_manipulation_functions_for_readers"><span class="tocnumber">3.9</span> <span class="toctext">String manipulation functions for readers</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Validating_Data"><span class="tocnumber">4</span> <span class="toctext">Validating Data</span></a>
<ul>
<li class="toclevel-2"><a href="#Rules"><span class="tocnumber">4.1</span> <span class="toctext">Rules</span></a>
<ul>
<li class="toclevel-3"><a href="#Rule_Configuration"><span class="tocnumber">4.1.1</span> <span class="toctext">Rule Configuration</span></a>
<ul>
<li class="toclevel-4"><a href="#Rulebase_Configuration_Options"><span class="tocnumber">4.1.1.1</span> <span class="toctext">Rulebase Configuration Options</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#RuleProvider_Implementations"><span class="tocnumber">4.1.2</span> <span class="toctext">RuleProvider Implementations</span></a>
<ul>
<li class="toclevel-4"><a href="#RegexProvider"><span class="tocnumber">4.1.2.1</span> <span class="toctext">RegexProvider</span></a>
<ul>
<li class="toclevel-5"><a href="#Useful_Regular_Expressions"><span class="tocnumber">4.1.2.1.1</span> <span class="toctext">Useful Regular Expressions</span></a></li>
</ul>
</li>
<li class="toclevel-4"><a href="#MVELProvider"><span class="tocnumber">4.1.2.2</span> <span class="toctext">MVELProvider</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2"><a href="#Rule_Based_Validation"><span class="tocnumber">4.2</span> <span class="toctext">Rule Based Validation</span></a>
<ul>
<li class="toclevel-3"><a href="#Validation_Configuration"><span class="tocnumber">4.2.1</span> <span class="toctext">Validation Configuration</span></a>
<ul>
<li class="toclevel-4"><a href="#Configuring_Max_Failures"><span class="tocnumber">4.2.1.1</span> <span class="toctext">Configuring Max Failures</span></a></li>
<li class="toclevel-4"><a href="#onFail"><span class="tocnumber">4.2.1.2</span> <span class="toctext">onFail</span></a></li>
<li class="toclevel-4"><a href="#Composite_Rule_Name"><span class="tocnumber">4.2.1.3</span> <span class="toctext">Composite Rule Name</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#Validation_Results"><span class="tocnumber">4.2.2</span> <span class="toctext">Validation Results</span></a></li>
<li class="toclevel-3"><a href="#Localized_Validation_Messages"><span class="tocnumber">4.2.3</span> <span class="toctext">Localized Validation Messages</span></a></li>
<li class="toclevel-3"><a href="#Example"><span class="tocnumber">4.2.4</span> <span class="toctext">Example</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Producing_Output_Data"><span class="tocnumber">5</span> <span class="toctext">Producing Output Data</span></a>
<ul>
<li class="toclevel-2"><a href="#Java_Binding"><span class="tocnumber">5.1</span> <span class="toctext">Java Binding</span></a>
<ul>
<li class="toclevel-3"><a href="#Java_Binding_Overview"><span class="tocnumber">5.1.1</span> <span class="toctext">Java Binding Overview</span></a></li>
<li class="toclevel-3"><a href="#When_to_use_Smooks_Java_Binding"><span class="tocnumber">5.1.2</span> <span class="toctext">When to use Smooks Java Binding</span></a></li>
<li class="toclevel-3"><a href="#Basics_Of_Java_Binding"><span class="tocnumber">5.1.3</span> <span class="toctext">Basics Of Java Binding</span></a></li>
<li class="toclevel-3"><a href="#Java_Binding_Configuration_Details"><span class="tocnumber">5.1.4</span> <span class="toctext">Java Binding Configuration Details</span></a>
<ul>
<li class="toclevel-4"><a href="#Data_Decoders.2FEncoders"><span class="tocnumber">5.1.4.1</span> <span class="toctext">Data Decoders/Encoders</span></a>
<ul>
<li class="toclevel-5"><a href="#Date_Decoding"><span class="tocnumber">5.1.4.1.1</span> <span class="toctext">Date Decoding</span></a></li>
<li class="toclevel-5"><a href="#Number_Decoding"><span class="tocnumber">5.1.4.1.2</span> <span class="toctext">Number Decoding</span></a></li>
<li class="toclevel-5"><a href="#Mapping_Decoding"><span class="tocnumber">5.1.4.1.3</span> <span class="toctext">Mapping Decoding</span></a></li>
<li class="toclevel-5"><a href="#Enum_Decoding"><span class="tocnumber">5.1.4.1.4</span> <span class="toctext">Enum Decoding</span></a></li>
</ul>
</li>
<li class="toclevel-4"><a href="#Bean_Retention"><span class="tocnumber">5.1.4.2</span> <span class="toctext">Bean Retention</span></a></li>
<li class="toclevel-4"><a href="#Preprocessing_Binding_Values"><span class="tocnumber">5.1.4.3</span> <span class="toctext">Preprocessing Binding Values</span></a></li>
<li class="toclevel-4"><a href="#Creating_Beans_Using_a_Factory"><span class="tocnumber">5.1.4.4</span> <span class="toctext">Creating Beans Using a Factory</span></a>
<ul>
<li class="toclevel-5"><a href="#Other_Definition_Languages"><span class="tocnumber">5.1.4.4.1</span> <span class="toctext">Other Definition Languages</span></a>
<ul>
<li class="toclevel-6"><a href="#MVEL_as_factory_definition_language"><span class="tocnumber">5.1.4.4.1.1</span> <span class="toctext">MVEL as factory definition language</span></a></li>
</ul>
</li>
<li class="toclevel-5"><a href="#Restrictions"><span class="tocnumber">5.1.4.4.2</span> <span class="toctext">Restrictions</span></a></li>
</ul>
</li>
<li class="toclevel-4"><a href="#Binding_Key_Value_Pairs_into_Maps"><span class="tocnumber">5.1.4.5</span> <span class="toctext">Binding Key Value Pairs into Maps</span></a></li>
<li class="toclevel-4"><a href="#Virtual_Object_Models_.28Maps_.26_Lists.29"><span class="tocnumber">5.1.4.6</span> <span class="toctext">Virtual Object Models (Maps &amp; Lists)</span></a>
<ul>
<li class="toclevel-5"><a href="#Wildcard_Bindings"><span class="tocnumber">5.1.4.6.1</span> <span class="toctext">Wildcard Bindings</span></a></li>
</ul>
</li>
<li class="toclevel-4"><a href="#Merging_Multiple_Data_Entities_Into_a_Single_Binding"><span class="tocnumber">5.1.4.7</span> <span class="toctext">Merging Multiple Data Entities Into a Single Binding</span></a></li>
<li class="toclevel-4"><a href="#Direct_Value_Binding"><span class="tocnumber">5.1.4.8</span> <span class="toctext">Direct Value Binding</span></a>
<ul>
<li class="toclevel-5"><a href="#Configuration"><span class="tocnumber">5.1.4.8.1</span> <span class="toctext">Configuration</span></a></li>
<li class="toclevel-5"><a href="#Example_2"><span class="tocnumber">5.1.4.8.2</span> <span class="toctext">Example</span></a>
<ul>
<li class="toclevel-6"><a href="#The_Message"><span class="tocnumber">5.1.4.8.2.1</span> <span class="toctext">The Message</span></a></li>
<li class="toclevel-6"><a href="#The_Configuration"><span class="tocnumber">5.1.4.8.2.2</span> <span class="toctext">The Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-5"><a href="#Programmatic_Configuration_6"><span class="tocnumber">5.1.4.8.3</span> <span class="toctext">Programmatic Configuration</span></a>
<ul>
<li class="toclevel-6"><a href="#Example_3"><span class="tocnumber">5.1.4.8.3.1</span> <span class="toctext">Example</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3"><a href="#Programmatic_Configuration_7"><span class="tocnumber">5.1.5</span> <span class="toctext">Programmatic Configuration</span></a>
<ul>
<li class="toclevel-4"><a href="#Example_4"><span class="tocnumber">5.1.5.1</span> <span class="toctext">Example</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#XML_to_Java_Reading_and_Writing"><span class="tocnumber">5.1.6</span> <span class="toctext">XML to Java Reading and Writing</span></a>
<ul>
<li class="toclevel-4"><a href="#Simple_XMLBinding_Use_Case"><span class="tocnumber">5.1.6.1</span> <span class="toctext">Simple XMLBinding Use Case</span></a></li>
<li class="toclevel-4"><a href="#Transforming_XML_Messages_Using_XMLBinding"><span class="tocnumber">5.1.6.2</span> <span class="toctext">Transforming XML Messages Using XMLBinding</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#Generating_the_Smooks_Binding_Configuration"><span class="tocnumber">5.1.7</span> <span class="toctext">Generating the Smooks Binding Configuration</span></a></li>
<li class="toclevel-3"><a href="#Notes_on_JavaResult"><span class="tocnumber">5.1.8</span> <span class="toctext">Notes on JavaResult</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Templating"><span class="tocnumber">5.2</span> <span class="toctext">Templating</span></a>
<ul>
<li class="toclevel-3"><a href="#FreeMarker_Templating"><span class="tocnumber">5.2.1</span> <span class="toctext">FreeMarker Templating</span></a>
<ul>
<li class="toclevel-4"><a href="#FreeMarker_Transforms_using_NodeModels"><span class="tocnumber">5.2.1.1</span> <span class="toctext">FreeMarker Transforms using NodeModels</span></a></li>
<li class="toclevel-4"><a href="#FreeMarker_and_the_Javabean_Cartridge"><span class="tocnumber">5.2.1.2</span> <span class="toctext">FreeMarker and the Javabean Cartridge</span></a></li>
<li class="toclevel-4"><a href="#Programmatic_Configuration_8"><span class="tocnumber">5.2.1.3</span> <span class="toctext">Programmatic Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#XSL_Templating"><span class="tocnumber">5.2.2</span> <span class="toctext">XSL Templating</span></a>
<ul>
<li class="toclevel-4"><a href="#Points_to_Note_Regarding_XSL_Support"><span class="tocnumber">5.2.2.1</span> <span class="toctext">Points to Note Regarding XSL Support</span></a></li>
<li class="toclevel-4"><a href="#My_XSLT_Works_Outside_Smooks.2C_but_not_Inside.3F"><span class="tocnumber">5.2.2.2</span> <span class="toctext">My XSLT Works Outside Smooks, but not Inside?</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2"><a href="#Simple_Stream_Manipulations"><span class="tocnumber">5.3</span> <span class="toctext">Simple Stream Manipulations</span></a></li>
<li class="toclevel-2"><a href="#Exporting_Results"><span class="tocnumber">5.4</span> <span class="toctext">Exporting Results</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Enriching_Output_Data"><span class="tocnumber">6</span> <span class="toctext">Enriching Output Data</span></a>
<ul>
<li class="toclevel-2"><a href="#SQL_Support"><span class="tocnumber">6.1</span> <span class="toctext">SQL Support</span></a></li>
<li class="toclevel-2"><a href="#Entity_Persistence_Frameworks"><span class="tocnumber">6.2</span> <span class="toctext">Entity Persistence Frameworks</span></a></li>
<li class="toclevel-2"><a href="#Data_Access_Object_Support"><span class="tocnumber">6.3</span> <span class="toctext">Data Access Object Support</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Scripting"><span class="tocnumber">7</span> <span class="toctext">Scripting</span></a>
<ul>
<li class="toclevel-2"><a href="#Groovy"><span class="tocnumber">7.1</span> <span class="toctext">Groovy</span></a>
<ul>
<li class="toclevel-3"><a href="#Groovy_Scriptlet_Variables_and_Methods"><span class="tocnumber">7.1.1</span> <span class="toctext">Groovy Scriptlet Variables and Methods</span></a></li>
<li class="toclevel-3"><a href="#Adding_Beans_to_the_BeanContext"><span class="tocnumber">7.1.2</span> <span class="toctext">Adding Beans to the BeanContext</span></a></li>
<li class="toclevel-3"><a href="#Mixed_DOM_and_SAX_with_Groovy"><span class="tocnumber">7.1.3</span> <span class="toctext">Mixed DOM and SAX with Groovy</span></a></li>
<li class="toclevel-3"><a href="#Mixed_DOM_and_SAX_Example"><span class="tocnumber">7.1.4</span> <span class="toctext">Mixed DOM and SAX Example</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Routing_Output_Data"><span class="tocnumber">8</span> <span class="toctext">Routing Output Data</span></a>
<ul>
<li class="toclevel-2"><a href="#File"><span class="tocnumber">8.1</span> <span class="toctext">File</span></a></li>
<li class="toclevel-2"><a href="#Database"><span class="tocnumber">8.2</span> <span class="toctext">Database</span></a></li>
<li class="toclevel-2"><a href="#Java"><span class="tocnumber">8.3</span> <span class="toctext">Java</span></a></li>
<li class="toclevel-2"><a href="#JMS"><span class="tocnumber">8.4</span> <span class="toctext">JMS</span></a></li>
<li class="toclevel-2"><a href="#ESB_Support"><span class="tocnumber">8.5</span> <span class="toctext">ESB Support</span></a></li>
<li class="toclevel-2"><a href="#Camel"><span class="tocnumber">8.6</span> <span class="toctext">Camel</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Performance_Tuning"><span class="tocnumber">9</span> <span class="toctext">Performance Tuning</span></a>
<ul>
<li class="toclevel-2"><a href="#General"><span class="tocnumber">9.1</span> <span class="toctext">General</span></a></li>
<li class="toclevel-2"><a href="#Smooks_Cartridges_2"><span class="tocnumber">9.2</span> <span class="toctext">Smooks Cartridges</span></a></li>
<li class="toclevel-2"><a href="#Javabean_Cartridge"><span class="tocnumber">9.3</span> <span class="toctext">Javabean Cartridge</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Testing"><span class="tocnumber">10</span> <span class="toctext">Testing</span></a>
<ul>
<li class="toclevel-2"><a href="#Unit_Testing"><span class="tocnumber">10.1</span> <span class="toctext">Unit Testing</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Common_use_cases"><span class="tocnumber">11</span> <span class="toctext">Common use cases</span></a>
<ul>
<li class="toclevel-2"><a href="#Processing_Huge_Messages_.28GBs.29"><span class="tocnumber">11.1</span> <span class="toctext">Processing Huge Messages (GBs)</span></a>
<ul>
<li class="toclevel-3"><a href="#One-to-One_Transformation"><span class="tocnumber">11.1.1</span> <span class="toctext">One-to-One Transformation</span></a></li>
<li class="toclevel-3"><a href="#Splitting_.26_Routing"><span class="tocnumber">11.1.2</span> <span class="toctext">Splitting &amp; Routing</span></a>
<ul>
<li class="toclevel-4"><a href="#Basic_Splitting_and_Routing"><span class="tocnumber">11.1.2.1</span> <span class="toctext">Basic Splitting and Routing</span></a></li>
<li class="toclevel-4"><a href="#Routing_to_File"><span class="tocnumber">11.1.2.2</span> <span class="toctext">Routing to File</span></a></li>
<li class="toclevel-4"><a href="#Routing_to_JMS"><span class="tocnumber">11.1.2.3</span> <span class="toctext">Routing to JMS</span></a></li>
<li class="toclevel-4"><a href="#Routing_to_a_Database_using_SQL"><span class="tocnumber">11.1.2.4</span> <span class="toctext">Routing to a Database using SQL</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2"><a href="#Message_Splitting_.26_Routing"><span class="tocnumber">11.2</span> <span class="toctext">Message Splitting &amp; Routing</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Extending_Smooks"><span class="tocnumber">12</span> <span class="toctext">Extending Smooks</span></a>
<ul>
<li class="toclevel-2"><a href="#Configuring_Smooks_Components"><span class="tocnumber">12.1</span> <span class="toctext">Configuring Smooks Components</span></a>
<ul>
<li class="toclevel-3"><a href="#Configuration_Annotations"><span class="tocnumber">12.1.1</span> <span class="toctext">Configuration Annotations</span></a>
<ul>
<li class="toclevel-4"><a href="#.40ConfigParam"><span class="tocnumber">12.1.1.1</span> <span class="toctext">@ConfigParam</span></a></li>
<li class="toclevel-4"><a href="#.40Config"><span class="tocnumber">12.1.1.2</span> <span class="toctext">@Config</span></a></li>
<li class="toclevel-4"><a href="#.40Initialize_and_.40Uninitialize"><span class="tocnumber">12.1.1.3</span> <span class="toctext">@Initialize and @Uninitialize</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#Defining_Custom_Configuration_Namespaces"><span class="tocnumber">12.1.2</span> <span class="toctext">Defining Custom Configuration Namespaces</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Implementing_a_Source_Reader"><span class="tocnumber">12.2</span> <span class="toctext">Implementing a Source Reader</span></a>
<ul>
<li class="toclevel-3"><a href="#Implementing_a_Binary_Source_Reader"><span class="tocnumber">12.2.1</span> <span class="toctext">Implementing a Binary Source Reader</span></a></li>
<li class="toclevel-3"><a href="#Implementing_a_Flat_File_Source_Reader"><span class="tocnumber">12.2.2</span> <span class="toctext">Implementing a Flat File Source Reader</span></a>
<ul>
<li class="toclevel-4"><a href="#VariableFieldRecordParser_and_VariableFieldRecordParserFactory"><span class="tocnumber">12.2.2.1</span> <span class="toctext">VariableFieldRecordParser and VariableFieldRecordParserFactory</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2"><a href="#Implementing_a_Fragment_Visitor"><span class="tocnumber">12.3</span> <span class="toctext">Implementing a Fragment Visitor</span></a>
<ul>
<li class="toclevel-3"><a href="#The_SAX_Visitor_API"><span class="tocnumber">12.3.1</span> <span class="toctext">The SAX Visitor API</span></a></li>
<li class="toclevel-3"><a href="#Text_Accumulation"><span class="tocnumber">12.3.2</span> <span class="toctext">Text Accumulation</span></a></li>
<li class="toclevel-3"><a href="#StreamResult_Writing.2FSerialization"><span class="tocnumber">12.3.3</span> <span class="toctext">StreamResult Writing/Serialization</span></a>
<ul>
<li class="toclevel-4"><a href="#SAXToXMLWriter"><span class="tocnumber">12.3.3.1</span> <span class="toctext">SAXToXMLWriter</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#Visitor_Configuration"><span class="tocnumber">12.3.4</span> <span class="toctext">Visitor Configuration</span></a>
<ul>
<li class="toclevel-4"><a href="#Example_Visitor_Configuration"><span class="tocnumber">12.3.4.1</span> <span class="toctext">Example Visitor Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#Visitor_Instance_Lifecycle"><span class="tocnumber">12.3.5</span> <span class="toctext">Visitor Instance Lifecycle</span></a>
<ul>
<li class="toclevel-4"><a href="#ExecutionLifecycleCleanable"><span class="tocnumber">12.3.5.1</span> <span class="toctext">ExecutionLifecycleCleanable</span></a></li>
<li class="toclevel-4"><a href="#VisitLifecycleCleanable"><span class="tocnumber">12.3.5.2</span> <span class="toctext">VisitLifecycleCleanable</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#ExecutionContext_and_ApplicationContext"><span class="tocnumber">12.3.6</span> <span class="toctext">ExecutionContext and ApplicationContext</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Apache_Camel_Integration"><span class="tocnumber">13</span> <span class="toctext">Apache Camel Integration</span></a>
<ul>
<li class="toclevel-2"><a href="#SmooksComponent"><span class="tocnumber">13.1</span> <span class="toctext">SmooksComponent</span></a>
<ul>
<li class="toclevel-3"><a href="#Options"><span class="tocnumber">13.1.1</span> <span class="toctext">Options</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#SmooksDataformat"><span class="tocnumber">13.2</span> <span class="toctext">SmooksDataformat</span></a></li>
<li class="toclevel-2"><a href="#SmooksProcessor"><span class="tocnumber">13.3</span> <span class="toctext">SmooksProcessor</span></a></li>
<li class="toclevel-2"><a href="#Apache_Camel_Examples"><span class="tocnumber">13.4</span> <span class="toctext">Apache Camel Examples</span></a></li>
</ul>
</li>
</ul>
</td></tr></tbody></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<p><br>
</p>
<a name="Introduction"></a><h1> <span class="mw-headline">Introduction</span></h1>
<p>Smooks is an extensible framework for building applications for processing XML and non XML data (CSV, EDI, Java etc) using Java.
</p><p>While Smooks can be used as a lightweight platform on which to build your own custom processing logic for a wide
range of data formats, "out of the box" it comes with some very useful features that can be used individually,
or seamlessly combined together:
</p>
<ul><li> <b>Java Binding</b>:  Populate a Java Object Model from a data source (CSV, EDI, XML, Java etc). Populated object models can be used as a transformation result itself, or can be used by (e.g.) Templating resources for generating XML or other character based results. Also supports Virtual Object Models (Maps and Lists of typed data), which can be used by EL and Templating functionality.
</li><li> <b>Transformation</b>:  Perform a wide range of Data Transforms - XML to XML, CSV to XML, EDI to XML, XML to EDI, XML to CSV, Java to XML, Java to EDI, Java to CSV, Java to Java, XML to Java, EDI to Java etc.
</li><li> <b>Huge Message Processing</b>:  Process huge messages (GBs) - Split, Transform and Route message fragments to JMS, File, Database etc destinations.
</li><li> <b>Message Enrichment</b>:  Enrich a message with data from a Database, or other Datasources.
</li><li> <b>Complex Message Validation</b>: Rules based fragment validation.
</li><li> <b>ORM Based Message Persistence</b>:  Use an entity persistence framework (like Ibatis, Hibernate or any JPA compatible framework) to access a database and use it's query language or CRUD methods to read from it or write to it.   Use custom Data Access Objects (DAO's) to access a database and use it's CRUD methods to read from it or write to it.
</li><li> <b>Combine</b>:  Perform Extract Transform Load (ETL) operations by leveraging Smooks' Transformation, Routing and Persistence functionality.
</li></ul>
<a name="What.27s_new_in_Smooks_v1.5.3F"></a><h2> <span class="mw-headline">What's new in Smooks v1.5?</span></h2>
<p>As well as a ton of bug fixes, Smooks v1.5 includes the following new highlight features:
</p>
<ul><li> EDI:
<ul><li> [<a href="http://jira.codehaus.org/browse/MILYN-567" class="external text" title="http://jira.codehaus.org/browse/MILYN-567" rel="nofollow">MILYN-567</a>]  Simplify EDI Directories lookup.  (By: <i>Renat Zubairov</i>)
</li><li> [<a href="http://jira.codehaus.org/browse/MILYN-570" class="external text" title="http://jira.codehaus.org/browse/MILYN-570" rel="nofollow">MILYN-570</a>]  Namespace aware EDI and UN/EDIFACT Readers i.e. generation of namespaced event streams.   (By: <i>Renat Zubairov</i>)
</li><li> [<a href="http://jira.codehaus.org/browse/MILYN-585" class="external text" title="http://jira.codehaus.org/browse/MILYN-585" rel="nofollow">MILYN-585</a>]  XML Schema generation in ECT.  The generated XSDs can validate the namespaced XML event stream generated by the UNEdifactReader (see MILYN-570 above) (By: <i>Renat Zubairov</i>)
</li></ul>
</li></ul>
<ul><li> Java Binding
<ul><li> [<a href="http://jira.codehaus.org/browse/MILYN-240" class="external text" title="http://jira.codehaus.org/browse/MILYN-240" rel="nofollow">MILYN-240</a>] (<a href="#XML_to_Java_Reading_and_Writing" title="V1.5:Smooks v1.5 User Guide">Docs</a>)  Support for XML Reading and Writing through a new XMLBinding class.  Prior to Smooks v1.5, the &lt;jb:bean&gt; binding configurations only allowed you to read data into a Java Object model.  Serializing that Java Object model back to XML (or EDI, CSV etc) required you to write a template (e.g. FreeMarker) and configure that into Smooks.  The XMLBinding class lets you both read and write/serialize XML (from Java objects) using only the standard &lt;jb:bean&gt; binding configurations i.e. no need for templates.  (By: <i>Tom Fennelly</i>)
</li></ul>
</li></ul>
<ul><li> Flat File Data Support
<ul><li> [<a href="http://jira.codehaus.org/browse/MILYN-592" class="external text" title="http://jira.codehaus.org/browse/MILYN-592" rel="nofollow">MILYN-592</a>]  Simplify the process of implementing a Reader for Flat File data formats (flat record based formats).  This includes support for simple Java binding configurations directly on the reader (SINGLE, LIST, MAP).  Also includes support for "variable field records".  The CSV reader now uses this API.  (By: <i>Tom Fennelly</i>)
</li><li> [<a href="http://jira.codehaus.org/browse/MILYN-593" class="external text" title="http://jira.codehaus.org/browse/MILYN-593" rel="nofollow">MILYN-593</a>]  Create a Regex based Flat File reader.  Allows you to process any flat file structure, parsing the record fields using a regular expression.  (By: <i>Tom Fennelly</i>)
</li></ul>
</li></ul>
<ul><li> Camel/ServiceMix/OSGi Support
<ul><li> Various bug fixes and enhancements.  (By: <i>Daniel Bevenius</i> and <i>Sorin Silaghi</i>)
</li></ul>
</li></ul>
<ul><li> Project Housekeeping
<ul><li> [<a href="http://jira.codehaus.org/browse/MILYN-580" class="external text" title="http://jira.codehaus.org/browse/MILYN-580" rel="nofollow">MILYN-580</a>]  Move from Maven to Gradle build.  (By: <i>Daniel Bevenius</i>)
</li><li> [<a href="http://jira.codehaus.org/browse/MILYN-558" class="external text" title="http://jira.codehaus.org/browse/MILYN-558" rel="nofollow">MILYN-558</a>]  Move to Nexus repository for artifacts.  (By: <i>Tom Fennelly</i>)
</li></ul>
</li></ul>
<p><br>
<b><a href="http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=11071&amp;version=16269" class="external text" title="http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=11071&amp;version=16269" rel="nofollow">See the full list of features and fixes...</a></b>
</p>
<a name="Getting_Started"></a><h2> <span class="mw-headline">Getting Started</span></h2>
<p>The easiest way to get started with Smooks is to download and try out some of the <a href="http://smooks.org/mediawiki/index.php?title=Smooks_v1.5_Examples" title="Smooks v1.5 Examples">examples</a>.  The examples are the perfect base upon which to integrate Smooks into your application.
</p>
<a name="FAQs"></a><h2> <span class="mw-headline">FAQs</span></h2>
<p>See the <a href="http://smooks.org/mediawiki/index.php?title=FAQ" title="FAQ">FAQ</a>
</p>
<a name="Maven"></a><h2> <span class="mw-headline">Maven</span></h2>
<p>For details on how to integrate Smooks into your project via Maven, see the <a href="http://smooks.org/mediawiki/index.php?title=Maven_%26_Ant" title="Maven &amp; Ant">Maven &amp; Ant Guide</a>.
</p>
<a name="Ant"></a><h2> <span class="mw-headline">Ant</span></h2>
<p>For details on how to integrate Smooks into your project via Ant, see the <a href="http://smooks.org/mediawiki/index.php?title=Maven_%26_Ant" title="Maven &amp; Ant">Maven &amp; Ant Guide</a>.
</p>
<a name="Download"></a><h2> <span class="mw-headline">Download</span></h2>
<p>Smooks can be download from the <a href="http://www.smooks.org/mediawiki/index.php?title=Downloads|download" class="external autonumber" title="http://www.smooks.org/mediawiki/index.php?title=Downloads|download" rel="nofollow">[1]</a> page.
</p>
<a name="Basics"></a><h1> <span class="mw-headline">Basics</span></h1>
<p>The most commonly accepted definition of Smooks would be that it is a "Transformation Engine". However, at it's core, Smooks makes no mention of "data transformation". The <b>smooks-core</b> codebase is designed simply to support hooking of custom "<a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a>" logic into an Event Stream produced by a data Source of some kind (XML, CSV, EDI, Java etc). As such, <b>smooks-core</b> is simply a "<b>Structured Data Event Stream Processor</b>".
</p><p>Of course, the most common application of this will be in the creation of <b>Transformation</b> solutions i.e. implementing <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic that uses the Event Stream produced from a Source message to produce a Result of some other kind. The capabilities in <b>smooks-core</b> enable more than this however. We have implemented a range of other solutions based on this processing model:
</p>
<ul><li> <b>Java Binding</b>: Population of a Java Object Model from the Source message.
</li><li> <b>Message Splitting &amp; Routing</b>: The ability to perform complex splitting and routing operations on the Source message, including routing to multiple destinations concurrently, as well as routing different data formats concurrently (XML, EDI, CSV, Java etc).
</li><li> <b>Huge Message Processing</b>: The ability to declaratively consume (transform, or split and route) huge message without writing lots of high maintenance code.
</li></ul>
<a name="Basic_Processing_Model"></a><h2> <span class="mw-headline">Basic Processing Model</span></h2>
<p>As stated above, the basic principal of Smooks is to take a data <b>Source</b> of some kind (e.g. XML) and from it generate an <b>Event Stream</b>, to which you apply <b><a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic</b> to produce a <b>Result</b> of some other kind (e.g. EDI).
</p><p>Many different data Source and Result types are supported, meaning many different transformation types are supported, including (but not limited to):
</p>
<ul><li> XML to XML
</li><li> XML to Java
</li><li> Java to XML
</li><li> Java to Java
</li><li> EDI to XML
</li><li> EDI to Java
</li><li> Java to EDI
</li><li> CSV to XML
</li><li> CSV to ...
</li><li> etc etc
</li></ul>
<p>In terms of the Event Model used to map between the Source and Result, Smooks currently supports DOM and SAX Event Models. We will concentrate on the SAX event model here. If you want low level details on either models, please consult the <a href="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_Developer_Guide" class="external text" title="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_Developer_Guide" rel="nofollow">Smooks Developer Guide</a>. The SAX event model is based on the hierarchical SAX events generated from an XML Source (startElement, endElement etc). However, this event model can be just as easily applied to other structured/hierarchical data Sources (EDI, CSV, Java etc).
</p><p>The most important events (typically) are the <b>visitBefore</b> and <b>visitAfter</b> events. The following illustration tries to convey the hierarchical nature of these events.
</p><p><a href="http://smooks.org/mediawiki/index.php?title=Image:Event-model.gif" class="image" title="Image:event-model.gif"><img alt="Image:event-model.gif" src="./User-Guide_files/Event-model.gif" width="228" height="162" border="0"></a>
</p>
<a name="Simple_Example"></a><h2> <span class="mw-headline">Simple Example</span></h2>
<p>In order to consume the SAX Event Stream produced from the Source message, you need to implement one or more of the <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/delivery/sax/SAXVisitor.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/delivery/sax/SAXVisitor.html" rel="nofollow">SAXVisitor</a> interfaces (depending on which events you need to consume).
</p><p>The following is a very simple example of how you implement <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic and target that logic at the <b>visitBefore</b> and <b>visitAfter</b> events for a specific element in the Event Stream.  In this case we target the <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic at the &lt;xxx&gt; element events.
</p><p><a href="http://smooks.org/mediawiki/index.php?title=Image:Simple-example.png" class="image" title="Image:simple-example.png"><img alt="Image:simple-example.png" src="./User-Guide_files/Simple-example.png" width="705" height="301" border="0"></a>
</p><p>As you can see, the <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementation is very simple; one method implementation per event.  To target this implementation at the &lt;xxx&gt; element <b>visitBefore</b> and <b>visitAfter</b> events, we need to create a Smook configuration as shown (more on "Resource Configurations" in the following sections).
</p><p>The Smooks code to execute this is very simple:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #0000ff;">"/smooks/echo-example.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>inputStream<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Note that in this case we don't produce a Result.  Also note that we don't interact with the "execution" of the filtering process in any way, since we don't explicitly create an <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/container/ExecutionContext.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/container/ExecutionContext.html" rel="nofollow">ExecutionContext</a> and supply it to the <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/Smooks.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/Smooks.html" rel="nofollow">Smooks</a>.filterSource method call.
</p><p>This example illustrated the lower level mechanics of the Smooks Programming Model. In reality however, users are not going to want to solve their problems by implementing lots Java code themselves from scratch. For this reason, Smooks is shipped with quite a lot of pre-built functionality i.e. ready to use <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic. We bundle this <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic based on functionality and we call the bundles "<b>Cartridges</b>".
</p>
<a name="Smooks_Resources_.28Visitors_etc.29"></a><h2> <span class="mw-headline">Smooks Resources (Visitors etc)</span></h2>
<p>Smooks executes by taking a data stream of one form or another (XML, EDI, Java, JSON, CSV etc) and from it, it generates an event stream, which it uses to fire different types of "<a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic" (Java, Groovy, FreeMarker, XSLT etc). The result of this process can be to produce a new data stream in a different format (i.e. a traditional "transformation"), bind data from the source message data stream to java objects to produce a populated Java object graph (i.e. a "Java binding"), produce many smaller messages (message splitting) etc.
</p><p>At a core level (inside Smooks), it just sees all of the "<a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic" etc as "Smooks Resources" (SmooksResourceConfiguration) that are configured to be applied based on an event <b>selector</b> (i.e. event from the source data event stream). This is a very generic processing model and makes a lot of sense from the point of view of Smooks Core and it's architecture (maintainance etc). However, it can be a little too generic from a usability perspective because everything looks very similar in the configuration. To help with this, Smooks v1.1 introduced an "Extensible Configuration Model" feature.  This allows specific resource types (Javabean binding configs, FreeMarker template configs etc) to be specified in the configuration using dedicated XSD namespaces of their own.
</p><p>Example (Java Binding Resource):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"lineOrder"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"example.trgmodel.LineOrder"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"example.srcmodel.Order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"lineItems"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"lineItems"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerId"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customerNumber"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerName"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customerName"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Example (FreeMarker Template Resource):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><span style="color: #808080; font-style: italic;">&lt;!-- &lt;item&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;id&gt;${.vars["order-item"].@id}&lt;/id&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;productId&gt;${.vars["order-item"].product}&lt;/productId&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;quantity&gt;${.vars["order-item"].quantity}&lt;/quantity&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;price&gt;${.vars["order-item"].price}&lt;/price&gt;</span><br><span style="color: #808080; font-style: italic;">&lt;/item&gt;</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>When comparing the above examples to the pre Smooks v1.1 equivalents you can see that:
</p>
<ol><li> The user now has a more strongly typed configuration that is domain specific in each case (and so easier to read).
</li><li> Because the v1.1+ configurations are XSD based, the user also gets autocompletion support from their IDE.
</li><li> No longer any need to define the actual handler for the given resource type e.g. the BeanPopulator for java bindings.
</li></ol>
<a name="Selectors"></a><h3> <span class="mw-headline">Selectors</span></h3>
<p>Smooks Resource "selectors" are a very important part of Smooks and how it works.  They instruct Smooks as to which message fragments to apply configured <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic to, as well working as a simple opaque lookup value for non <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic.
</p><p>When the resource is a <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementation (e.g. &lt;jb:bean&gt;, &lt;ftl:freemarker&gt; etc), Smooks will interpret the selector as an <a href="http://www.w3.org/TR/xpath/" class="external text" title="http://www.w3.org/TR/xpath/" rel="nofollow">XPath</a> (like) selector.  There are a number of things to be aware of:
</p>
<ol><li> The order in which the <a href="http://www.w3.org/TR/xpath/" class="external text" title="http://www.w3.org/TR/xpath/" rel="nofollow">XPath</a> expression is applied is the reverse of normal order e.g. as applied by an XSLT.  Smooks works backwards from the targeted fragment element, as opposed to forwards from the message root element.
</li><li> Not all of the <a href="http://www.w3.org/TR/xpath/" class="external text" title="http://www.w3.org/TR/xpath/" rel="nofollow">XPath</a> specification is supported.  Selector supports the following XPath syntax:
<ul><li> 'text()' and attribute (e.g. '@x') value selectors, with both Literal and Numeric e.g. "a/b[text() = 'abc']", "a/b[text() = 123]", "a/b[@id = 'abc']", "a/b[@id = 123]".
<ul><li> Note:  'text()' is only supported on the last selector step in an expression e.g. "a/b[text() = 'abc']" is legal while "a/b[text() = 'abc']/c" is illegal.
</li><li> Note:  'text()' is only supported on SAXVisitor implementations that implement the SAXVisitAfter interface <b>only</b>.  If the SAXVisitor implements the SAXVisitBefore or SAXVisitChildren interfaces, an error will result.
</li></ul>
</li><li> And and Or logical operations e.g. "a/b[text() = 'abc' and @id = 123]", "a/b[text() = 'abc' or @id = 123]"
</li><li> Namespaces on both the elements and attributes e.g. "a:order/b:address[@b:city = 'NY']".
<ul><li> Note:  This requires the namespace prefix-to-URI mappings to be defined.  If not defined, a configuration error will result.  See the <a href="#Namespace_Declaration" title="">Namespace Declaration</a> section for more details.
</li></ul>
</li><li> Supports "=" (equals), "!=" (not equals), "&lt;" (less than), "&gt;" (greater than).
</li><li> Index selectors e.g. "a/b[3]"
</li></ul>
</li></ol>
<a name="Namespace_Declaration"></a><h3> <span class="mw-headline">Namespace Declaration</span></h3>
<p>Namespace prefix-to-URI mappings are configured through the core configuration namespace.  These configurations are then available when resolving namespaced selectors.
</p><p>Example:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:namespaces<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:namespace</span> <span style="color: #000066;">prefix</span>=<span style="color: #ff0000;">"a"</span> <span style="color: #000066;">uri</span>=<span style="color: #ff0000;">"http://a"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:namespace</span> <span style="color: #000066;">prefix</span>=<span style="color: #ff0000;">"b"</span> <span style="color: #000066;">uri</span>=<span style="color: #ff0000;">"http://b"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:namespace</span> <span style="color: #000066;">prefix</span>=<span style="color: #ff0000;">"c"</span> <span style="color: #000066;">uri</span>=<span style="color: #ff0000;">"http://c"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:namespace</span> <span style="color: #000066;">prefix</span>=<span style="color: #ff0000;">"d"</span> <span style="color: #000066;">uri</span>=<span style="color: #ff0000;">"http://d"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/core:namespaces<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource-config</span> <span style="color: #000066;">selector</span>=<span style="color: #ff0000;">"c:item[@c:code = '8655']/d:units[text() = 1]"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.acme.visitors.MyCustomVisitorImpl<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Smooks_Cartridges"></a><h2> <span class="mw-headline">Smooks Cartridges</span></h2>
<p>The basic functionality of Smooks Core can be extended through the creation of what we call a "Smooks Cartridge". A Cartridge is simply a Java archive (jar) containing reusable Content Handlers (<a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> Logic). A Smooks Cartridge should provide "ready to use" support for a specific type of XML analysis or transformation.
</p><p>For a full list of the Cartridges supported by Smooks, see the <a href="http://www.smooks.org/cartri" class="external text" title="http://www.smooks.org/cartri" rel="nofollow">Cartridges list</a>.
</p>
<a name="Filtering_Process_Selection_.28DOM_or_SAX.3F.29"></a><h2> <span class="mw-headline">Filtering Process Selection (DOM or SAX?)</span></h2>
<p>This is done by Smooks based on the following criteria:
</p>
<ol><li> If all <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> resources* implement only the DOM <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> interfaces (DOMElementVisitor or SerializationUnit), then the DOM processing model is selected.
</li><li> If all <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> resources* implement only the SAX <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> interface (SAXElementVisitor), then the SAX processing model is selected.
</li><li> If all <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> resources* implement both the DOM and SAX <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> interfaces, then the SAX processing model is selected, unless the Smooks resource configuration contains the &lt;core:filterSettings type="DOM" /&gt; (see below).
</li></ol>
<p><b>*</b> not including non element <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> resources, like readers for example.
</p><p><br>
The following is an example of setting the filter type to DOM (SAX is the default):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> </span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:filterSettings</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"DOM"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>More information on global filtering settings can be found in the <a href="#Filter_Settings" title="">Filter Settings section</a>.
</p><p><br>
</p>
<a name="Mixing_DOM_and_SAX"></a><h3> <span class="mw-headline">Mixing DOM and SAX</span></h3>
<p>The DOM processing model has the obvious:
</p>
<ul><li> <b>Advantage</b> of being easier to work with on a code level, allowing node traversal etc. It also makes it a lot easier to take advantage of Scripting and Templating engines that have built in support for utilizing DOM structures (e.g. <a href="http://freemarker.org/" class="external text" title="http://freemarker.org" rel="nofollow">FreeMarker</a> and <a href="http://groovy.codehaus.org/" class="external text" title="http://groovy.codehaus.org" rel="nofollow">Groovy</a>).
</li><li> <b>Disadvantage</b> of being constrained by memory i.e. if you have huge messages, then you typically cannot use a DOM processing model.
</li></ul>
<p>Smooks v1.1 added support for mixing these 2 models through the <b>DomModelCreator</b> class. When used with SAX filtering, this <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> will construct a DOM Fragment of the visited element. This allows DOM utilities to be used in a Streaming environment.
</p><p>When 1+ models are nested inside each other, outer models will never contain data from the inner models i.e. the same fragments will never coexist inside two models.
</p><p>Take the following message as an example:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">"332"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customer</span> <span style="color: #000066;">number</span>=<span style="color: #ff0000;">"123"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Joe<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">'1'</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>8.80<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">'2'</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>8.80<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">'3'</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>3<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>8.80<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The DomModelCreator can be configured in Smooks to create models for the "order" and "order-item" message fragments:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource-config</span> <span style="color: #000066;">selector</span>=<span style="color: #ff0000;">"order,order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.milyn.delivery.DomModelCreator<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>In this case, the "order" model will never contain "order-item" model data (order-item elements are nested inside the order element). The in memory model for the "order" will simply be:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">'332'</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customer</span> <span style="color: #000066;">number</span>=<span style="color: #ff0000;">"123"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Joe<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-items</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Added to this is the fact that there will only ever be 0 or 1 "order-item" models in memory at any given time, with each new "order-item" model overwriting the previous "order-item" model. <b>All this ensures that the memory footprint is kept to a minimum</b>.
</p><p>Because the Smooks processing model is event driven via the message content (i.e. you can hook in <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic to be applied at different points while Smooks filters/streams the message), you can take advantage of this mixed DOM and SAX processing model.
</p><p>See the following examples that utilize this mixed DOM + SAX approach:
</p>
<ul><li> <a href="http://smooks.org/mediawiki/index.php?title=V1.2:groovy" title="V1.2:groovy">Groovy Scripting Example</a>
</li><li> <a href="http://smooks.org/mediawiki/index.php?title=V1.2:xml-to-xml" title="V1.2:xml-to-xml">FreeMarker Templating Example</a>
</li></ul>
<a name="The_Bean_Context"></a><h2> <span class="mw-headline">The Bean Context</span></h2>
<p>The <b>bean context</b> (also known as "bean map") is a container for Objects which can be accessed within the Smooks filter process. One bean context is created per execution context (i.e. per Smooks.filterSource operation). Every bean, created by the cartridge, is put into this context under its <b>beanId</b>. If you want the contents of the bean context to be returned at the end of the Smooks.filterSource process, supply a <b>org.milyn.delivery.java.JavaResult</b> object in the call to Smooks.filterSource method. The following example illustrates this principal:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//Get the data to filter</span><br>StreamSource source <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>getClass<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"data.xml"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">//Create a Smooks instance (cachable)</span><br>Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #0000ff;">"smooks-config.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">//Create the JavaResult, which will contain the filter result after filtering</span><br>JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">//Filter the data from the source, putting the result into the JavaResult</span><br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>source, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">//Getting the Order bean which was created by the JavaBean cartridge</span><br>Order order <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>Order<span style="color: #009900;">)</span>result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"order"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>If you need to access the bean context beans at runtime (e.g. from a customer <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementation), you do so via the <b>BeanContext</b> object. The "BeanContext" object can be retrieved from the <b>ExecutionContext</b> via the <b>getBeanContext()</b> method. When adding or retrieving objects from the BeanContext you should first retrieve a <b>BeanId</b> object from the <b>BeanIdStore</b>. The BeanId object is a special key that ensures higher performance then String keys, however String keys are also supported. The BeanIdStore must be retrieved from the <b>ApplicationContext</b> via the <b>getBeanIdStore()</b> method. A BeanId object can be created by calling the <b>register("beanId name")</b> method. If you know that the BeanId is already registered then you can retrieve it by calling the <b>getBeanId("beanId name")</b> method. BeanId objects are ApplicationContext scoped objects. You normally register them in the initialization method of your custom visitor implemention and then put them as properties in the visitor object. You can then use them in the 'visitBefore' and 'visitAfter' methods. The BeanId objects and the BeanIdStore are thread safe.
</p>
<a name="Pre_Installed_Beans"></a><h3> <span class="mw-headline">Pre Installed Beans</span></h3>
<p>A number of pre-installed beans are available in the Bean Context at runtime:
</p>
<ul><li> <b>PUUID</b>:  UniqueId bean.  This bean provides unique identifiers for the filtering ExecutionContext.  <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/javabean/context/preinstalled/UniqueID.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/javabean/context/preinstalled/UniqueID.html" rel="nofollow">See Javadoc</a>.
</li><li> <b>PTIME</b>:  Time bean.  This bean provides time based data for the filtering ExecutionContext.  <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/javabean/context/preinstalled/Time.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/javabean/context/preinstalled/Time.html" rel="nofollow">See Javadoc</a>.
</li></ul>
<p>The following are examples of how each of these would be used in a FreeMarker template.
</p><p>Unique ID of the ExecutionContext (message being filtered):
</p>
<pre class="text" style="font-family:monospace;">${PUUID.execContext}</pre>
<p>Random Unique ID:
</p>
<pre class="text" style="font-family:monospace;">${PUUID.random}</pre>
<p>Message Filtering start time (in milliseconds):
</p>
<pre class="text" style="font-family:monospace;">${PTIME.startMillis}</pre>
<p>Message Filtering start time (in nanoseconds):
</p>
<pre class="text" style="font-family:monospace;">${PTIME.startNanos}</pre>
<p>Message Filtering start time (Date):
</p>
<pre class="text" style="font-family:monospace;">${PTIME.startDate}</pre>
<p>Time now (in milliseconds):
</p>
<pre class="text" style="font-family:monospace;">${PTIME.nowMillis}</pre>
<p>Time now (in nanoSeconds):
</p>
<pre class="text" style="font-family:monospace;">${PTIME.nowNanos}</pre>
<p>Time now (Date):
</p>
<pre class="text" style="font-family:monospace;">${PTIME.nowDate}</pre>
<p><a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/javabean/context/preinstalled/package-summary.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/javabean/context/preinstalled/package-summary.html" rel="nofollow">See Javadoc</a>
</p>
<a name="Multiple_Outputs.2FResults"></a><h2> <span class="mw-headline">Multiple Outputs/Results</span></h2>
<p>This section looks at the different ways in which Smooks can produce "Output" from the Filtering process.
</p><p>Smooks can "present" output to the outside world in the following ways:
</p>
<ol><li> <b>"In-Result" Instances</b>:  Returned in the <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" rel="nofollow">Result</a> instances passed to the <a href="http://www.milyn.org/javadoc/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" class="external text" title="http://www.milyn.org/javadoc/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" rel="nofollow">Smooks.filterSource</a> method.
</li><li> <b>During the Filtering Process</b>:  Output generated and sent to external endpoints (ESB Services, Files, JMS Destinations, DBs etc) during the Filtering process.  This is where message fragment events are used to trigger routing of message fragments to external endpoints e.g. when <a href="http://smooks.org/mediawiki/index.php?title=V1.4:Smooks_v1.4_User_Guide#Splitting_.26_Routing" title="V1.4:Smooks v1.4 User Guide">Splitting and Routing</a> fragments of a message.
</li></ol>
<p><br>
A very important point to remember is that Smooks can generate output/results in either or both of the above ways, all in a single filtering pass of a message stream.  It doesn't need to filter a message stream multiple times in order to generate multiple outputs/results.  This is critical in terms of performance/efficiency.
</p>
<a name=".22In-Result.22_Instances"></a><h3> <span class="mw-headline">"In-Result" Instances</span></h3>
<p>A look at the Smooks API reveals that Smooks can be supplied with multiple <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" rel="nofollow">Result</a> instances:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> filterSource<span style="color: #009900;">(</span>Source source, Result... <span style="color: #006633;">results</span><span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException</pre>
<p>In terms of the types of <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" rel="nofollow">Result</a> that Smooks can work with, we're talking about the standard JDK <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a> and <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/dom/DOMResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/dom/DOMResult.html" rel="nofollow">DOMResult</a> types, as well as some Smooks "specializations":
</p>
<ol><li> <a href="http://www.milyn.org/javadoc/smooks/org/milyn/payload/JavaResult.html" class="external text" title="http://www.milyn.org/javadoc/smooks/org/milyn/payload/JavaResult.html" rel="nofollow">JavaResult</a>:  Result type for capturing the contents of the Smooks Java Bean context.
</li><li> <a href="http://www.milyn.org/javadoc/smooks-cartridges/validation/org/milyn/validation/ValidationResult.html" class="external text" title="http://www.milyn.org/javadoc/smooks-cartridges/validation/org/milyn/validation/ValidationResult.html" rel="nofollow">ValidationResult</a>:  Result type for capturing <a href="http://smooks.org/mediawiki/index.php?title=V1.4:Smooks_v1.4_User_Guide#Validation" title="V1.4:Smooks v1.4 User Guide">Validation</a> Results.
</li><li> <a href="http://www.milyn.org/javadoc/smooks/org/milyn/payload/StringResult.html" class="external text" title="http://www.milyn.org/javadoc/smooks/org/milyn/payload/StringResult.html" rel="nofollow">StringResult</a>:  Simple Result type used mainly when writing tests.  Simple <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a> extension wrapping a <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/io//StringWriter.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/java/io//StringWriter.html" rel="nofollow">StringWriter</a>.
</li></ol>
<p>This is obviously the most common method of capturing output from the Smooks filtering process.
</p><p><b>NOTE</b>:
</p>
<dl><dd><i>As yet, Smooks does not support capturing of <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" rel="nofollow">Result</a> data to multiple <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" rel="nofollow">Result</a> instances of the same type.  For example, you can specify multiple <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a> instances in the <a href="http://www.milyn.org/javadoc/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" class="external text" title="http://www.milyn.org/javadoc/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" rel="nofollow">Smooks.filterSource</a> method call, but Smooks will only output to one of these <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a> instances (the first one).</i>
</dd></dl>
<a name="StreamResults_.2F_DOMResults"></a><h4> <span class="mw-headline">StreamResults / DOMResults</span></h4>
<p>These <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Result.html" rel="nofollow">Result</a> types receive "special" attention from Smooks.  As Smooks process a message <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Source.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Source.html" rel="nofollow">Source</a>, it produces a stream of events.  If a <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a> or <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/dom/DOMResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/dom/DOMResult.html" rel="nofollow">DOMResult</a> is supplied in the <a href="http://www.milyn.org/javadoc/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" class="external text" title="http://www.milyn.org/javadoc/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" rel="nofollow">Smooks.filterSource</a> call, Smooks will (by default - see <a href="http://smooks.org/mediawiki/index.php?title=V1.4:Smooks_v1.4_User_Guide#Global_Filter_Setting_Parameters" title="V1.4:Smooks v1.4 User Guide">default.serialization.on</a> global parameter) serialize the event stream (produced from the <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Source.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Source.html" rel="nofollow">Source</a>) to the supplied <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a> or <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/dom/DOMResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/dom/DOMResult.html" rel="nofollow">DOMResult</a> as XML.  Obviously, <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic can be configured/applied to the event stream before serialization.
</p><p><br>
This is the mechanism used to perform a standard 1-input/1-xml-output character based transformation.
</p>
<a name="During_the_Filtering_Process"></a><h3> <span class="mw-headline">During the Filtering Process</span></h3>
<p>Smooks is also able to generate different types of output during the <a href="http://www.milyn.org/javadoc/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" class="external text" title="http://www.milyn.org/javadoc/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" rel="nofollow">Smooks.filterSource</a> process i.e. as it is filtering the message event stream and before it reaches the end of the message.  A classic example of this being when it is used to <a href="http://smooks.org/mediawiki/index.php?title=V1.4:Smooks_v1.4_User_Guide#Splitting_.26_Routing" title="V1.4:Smooks v1.4 User Guide">split and route</a> message fragments to different types of endpoints for processing by other processes.
</p><p>So one might wonder why Smooks doesn't "batch up" the message data and produce all the results/outputs after filtering the complete message.  Well the answer is straightforward enough:
</p>
<ol><li> Performance!!
</li><li> It's just easier this way because you can utilize the message event stream to trigger the fragment transform and routing operations.
</li></ol>
<p>Consider an Order message that has hundreds of thousands (or millions) of Order Items that need to be split out and routed to different departments in different formats, based on different criteria.  The only way of handing messages of this magnitude is by streaming the process.
</p><p><br>
</p>
<a name="Checking_the_Smooks_Execution_Process"></a><h2> <span class="mw-headline">Checking the Smooks Execution Process</span></h2>
<p>As Smooks performs the filtering process (processing the Event Stream generated from the Source), it publishes events that can be captured and programmatically analyzed during/after execution.? The easiest way to generate an execution report out of Smooks is to configure the ExecutionContext to generate a report. Smooks supports generation of a HTML report via the HtmlReportGenerator class.
</p><p>The following is an example of how to configure Smooks to generate a HTML report.
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #0000ff;">"/smooks/smooks-transform-x.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>ExecutionContext execContext <span style="color: #339933;">=</span> smooks.<span style="color: #006633;">createExecutionContext</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>execContext.<span style="color: #006633;">setEventListener</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> HtmlReportGenerator<span style="color: #009900;">(</span><span style="color: #0000ff;">"/tmp/smooks-report.html"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>execContext, <span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>inputStream<span style="color: #009900;">)</span>, <span style="color: #000000; font-weight: bold;">new</span> StreamResult<span style="color: #009900;">(</span>outputStream<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>The HtmlReportGenerator is a very useful tool during development with Smooks. It's the nearest thing Smooks currently has to an IDE based Debugger (which we hope to have in a future release). It can be very useful for diagnosing issues, or simply as a tool for comprehending a Smooks transformation.
</p><p>An example HtmlReportGenerator report can be seen <a href="http://www.milyn.org/docs/smooks-report/report.html" class="external text" title="http://www.milyn.org/docs/smooks-report/report.html" rel="nofollow">online here</a>.
</p><p>Of course you can also write and use your own <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/event/ExecutionEventListener.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/event/ExecutionEventListener.html" rel="nofollow">ExecutionEventListener</a> implementations.
</p>
<a name="Terminating_the_Filtering_Process"></a><h2> <span class="mw-headline">Terminating the Filtering Process</span></h2>
<p>Sometimes you want/need to terminate the Smooks filtering process before reaching the end of a message.  This can be done by using a &lt;core:terminate&gt; configuration in the Smooks configuration.  This configuration only works for the SAX filter - it doesn't really make sense to add it for DOM.
</p><p>The following is an example configuration that terminates filtering at the end of the customer fragment of the message:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> </span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Visitors... --&gt;</span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:terminate</span> <span style="color: #000066;">onElement</span>=<span style="color: #ff0000;">"customer"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The default behavior is to terminate at the end of the targeted fragment (i.e. on the "visitAfter" event).  To terminate at the start (on the "visitBefore" event):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> </span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Visitors... --&gt;</span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:terminate</span> <span style="color: #000066;">onElement</span>=<span style="color: #ff0000;">"customer"</span> <span style="color: #000066;">terminateBefore</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Global_Configurations"></a><h2> <span class="mw-headline"> Global Configurations </span></h2>
<p>Global configuration settings are, as the name implies, configuration options that can be set once and be applied to all resources in a configuration.
</p><p>Smooks supports two types of globals, default properties and global parameters:
</p>
<ul><li> <b>Global Configuration Parameters</b>:  Every &lt;resource-config&gt; in a Smooks configuration can specify &lt;param&gt; elements for configuration parameters.  These parameter values are available at runtime through the <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/cdr/SmooksResourceConfiguration.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/cdr/SmooksResourceConfiguration.html" rel="nofollow">SmooksResourceConfiguration</a>, or are reflectively injected through the <b>@ConfigParam</b> annotation.  Global Configuration Parameters are parameters that are defined centrally (see below) and are accessible to all runtime components via the <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/container/ExecutionContext.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/container/ExecutionContext.html" rel="nofollow">ExecutionContext</a> (Vs the <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/cdr/SmooksResourceConfiguration.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/cdr/SmooksResourceConfiguration.html" rel="nofollow">SmooksResourceConfiguration</a>).  More on this in the following sections.
</li><li> <b>Default Properties</b>:  Specify default values for &lt;resource-config&gt; attributes.  These defaults are automatically applied to <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/cdr/SmooksResourceConfiguration.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/cdr/SmooksResourceConfiguration.html" rel="nofollow">SmooksResourceConfigurations</a> when their corresponding &lt;resource-config&gt; does not specify the attribute.  More on this in the following section.
</li></ul>
<a name="Global_Configuration_Parameters"></a><h3> <span class="mw-headline"> Global Configuration Parameters </span></h3>
<p>Global properties differ from the default properties in that they are not specified on the root element and are not automatically applied to resources.
</p><p>Global parameters are specified in a <b>&lt;params&gt;</b> element:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"xyz.param1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>param1-val<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Global Configuration Parameters are accessible via the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/container/ExecutionContext.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/container/ExecutionContext.html" rel="nofollow">ExecutionContext</a> e.g.:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitAfter<span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">final</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aelement+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Element</span></a> element, <span style="color: #000000; font-weight: bold;">final</span> ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException <span style="color: #009900;">{</span><br>    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> param1 <span style="color: #339933;">=</span> executionContext.<span style="color: #006633;">getConfigParameter</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"xyz.param1"</span>, <span style="color: #0000ff;">"defaultValueABC"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    ....<br><span style="color: #009900;">}</span></pre>
<a name="Default_Properties"></a><h3> <span class="mw-headline"> Default Properties </span></h3>
<p>Default properties are properties that can be set on the root element of a Smooks configuration and have them applied to all resource configurations in smooks-conf.xml file. For example, if you have a resource configuration file in which all the resource configurations have the same selector value, you could specify a <i>default-selector=order</i> to save specifying the selector on on every resource configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:xsl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/xsl-1.1.xsd"</span> <span style="color: #000066;">default-selector</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.acme.VisitorA<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        ...<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.acme.VisitorB<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        ...<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The following default configuration options are available:
</p>
<ul><li> <b>default-selector</b>:  Selector that will be applied to all resource-config elements in the smooks configuration file, where a selector is not defined.
</li><li> <b>default-selector-namespace</b>:  The default selector namespace, where a namespace is not defined.
</li><li> <b>default-target-profile</b>:  Default target profile that will be applied to all resources in the smooks configuration file, where a target-profile is not defined.
</li><li> <b>default-condition-ref</b>:  Refers to a global condition by the conditions id.  This condition is applied to resources that define an empty "condition" element (i.e. &lt;condition/&gt;) that does not reference a globally defined condition.
</li></ul>
<a name="Filter_Settings"></a><h2> <span class="mw-headline">Filter Settings</span></h2>
<p>Filtering specific configurations are made through the <b>smooks-core</b> configuration namespace (<a href="http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd</a>) introduced in Smooks v1.3.  For configuring these options on earlier versions of Smooks, <a href="http://smooks.org/mediawiki/index.php?title=User_Documentation" title="User Documentation">see the User Guide for the version in question</a>.
</p><p>An example configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> </span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.3.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:filterSettings</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"SAX"</span> <span style="color: #000066;">defaultSerialization</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000066;">terminateOnException</span>=<span style="color: #ff0000;">"true"</span> </span><br><span style="color: #009900;">                         <span style="color: #000066;">readerPoolSize</span>=<span style="color: #ff0000;">"3"</span> <span style="color: #000066;">closeSource</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000066;">closeResult</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000066;">rewriteEntities</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Other visitor configs etc... --&gt;</span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<ul><li> <b>type</b> Determines the type of processing model that will be used. Either SAX or DOM. Please refer to <a href="#Filtering_Process_Selection_.28DOM_or_SAX.3F.29" title="">Filtering Process Selection</a> for more information about the processing models. Default is SAX (<a href="http://jira.codehaus.org/browse/MILYN-589" class="external text" title="http://jira.codehaus.org/browse/MILYN-589" rel="nofollow">default was DOM in Smooks v1.4 and before</a>).
</li><li> <b>defaultSerialization</b>: Determines if default serialization should be switched on (default "true").  Default serialization being turned on simply tells Smooks to locate a <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a> (or DOMResult) in the Result objects provided to the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" rel="nofollow">Smooks.filterSource</a> method and to, by default, serialize all events to that Result.  This behavior can be turned off using this global configuration parameter and can be overriden on a per fragment basis by targetting a <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementation at that fragment that takes ownership of the Result writer (in the case of SAX filtering), or simply modifies the DOM (in the case of DOM filtering).  As an example of this, see the <a href="http://www.milyn.org/javadoc/v1.3/smooks-cartridges/templating/org/milyn/templating/freemarker/FreeMarkerTemplateProcessor.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks-cartridges/templating/org/milyn/templating/freemarker/FreeMarkerTemplateProcessor.html" rel="nofollow">FreeMarkerTemplateProcessor</a>.
</li><li> <b>terminateOnException</b>: Determines whether an exception should terminate processing (default "true").
</li><li> <b>closeSource</b>:  Close Source instance streams passed to the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" rel="nofollow">Smooks.filterSource</a> method (default "true").  The exception here is System.in, which will never be closed.
</li><li> <b>closeResult</b>:  Close Result streams passed to the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/Smooks.html#filterSource(javax.xml.transform.Source,%20javax.xml.transform.Result...)" rel="nofollow">Smooks.filterSource</a> method (default "true").  The exception here is System.out and System.err, which will never be closed.
</li><li> <b>rewriteEntities</b>:  Rewrite XML entities when reading and writing (default serialization) XML.
</li><li> <b>readerPoolSize</b>: Reader Pool Size (default 0). Some Reader implementations are very expensive to create (e.g. Xerces). Pooling Reader instances (i.e. reusing) can result in a huge performance improvement, especially when processing lots of "small" messages. The default value for this setting is 0 (i.e. unpooled - a new Reader instance is created for each message). Configure in line with your applications threading model.
</li></ul>
<p><br>
</p>
<a name="Configuration_Modularization"></a><h2> <span class="mw-headline">Configuration Modularization</span></h2>
<p>Smooks configurations are easily modularized through use of the <i>&lt;import&gt;</i> element.  This allows you to split Smooks configurations into multiple reusable configuration files and then compose the top level configurations using the <i>&lt;import&gt;</i> element e.g.
</p><p><br>
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;import</span> <span style="color: #000066;">file</span>=<span style="color: #ff0000;">"bindings/order-binding.xml"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;import</span> <span style="color: #000066;">file</span>=<span style="color: #ff0000;">"templates/order-template.xml"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
You can also inject replacement tokens into the imported configuration by using <i>&lt;param&gt;</i> sub-elements on the <i>&lt;import&gt;</i>.  This allows you to make tweaks to the imported configuration.
</p><p><br>
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">&lt;!-- Top level configuration... --&gt;</span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;import</span> <span style="color: #000066;">file</span>=<span style="color: #ff0000;">"bindings/order-binding.xml"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"orderRootElement"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>order<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/import<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #808080; font-style: italic;">&lt;!-- Imported parameterized bindings/order-binding.xml configuration... --&gt;</span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.acme.Order"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"@orderRootElement@"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        .....<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
Note how the replacement token injection points are specified using <b>@tokenname@</b>.
</p>
<a name="Consuming_Input_Data"></a><h1> <span class="mw-headline">Consuming Input Data</span></h1>
<p>Smooks relies on a "Stream Reader" for generating a stream of SAX events from the Source message data stream. A Stream Reader is a class that implements the <a href="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/XMLReader.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/XMLReader.html" rel="nofollow">XMLReader interface</a> (or the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/xml/SmooksXMLReader.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/xml/SmooksXMLReader.html" rel="nofollow">SmooksXMLReader interface</a>).
</p><p>By default, Smooks uses the default XMLReader (<a href="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/helpers/XMLReaderFactory.html#createXMLReader%28%29" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/helpers/XMLReaderFactory.html#createXMLReader%28%29" rel="nofollow">XMLReaderFactory.createXMLReader()</a>), but can be easily configured to read non-XML data Sources by configuring a specialized XMLReader:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;reader</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.ZZZZReader"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- </span><br><span style="color: #808080; font-style: italic;">    Other Smooks resources, e.g. &lt;jb:bean&gt; configs for </span><br><span style="color: #808080; font-style: italic;">    binding data from the ZZZZ data stream into Java Objects....</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The reader can also be configured with a set of handlers, features and parameters. Here is a full example configuration.
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;reader</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.ZZZZReader"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;handlers<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;handler</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.X"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;handler</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.Y"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/handlers<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;features<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;setOn</span> <span style="color: #000066;">feature</span>=<span style="color: #ff0000;">"http://a"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;setOn</span> <span style="color: #000066;">feature</span>=<span style="color: #ff0000;">"http://b"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;setOff</span> <span style="color: #000066;">feature</span>=<span style="color: #ff0000;">"http://c"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;setOff</span> <span style="color: #000066;">feature</span>=<span style="color: #ff0000;">"http://d"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/features<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"param1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>val1<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"param2"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>val2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>As you can read in the subchapter of this chapter there are a number of non-XML Readers available with Smooks out of the box.
</p>
<a name="XML"></a><h2> <span class="mw-headline">XML</span></h2>
<p>By default Smooks reads XML data.
</p><p>To set features on the default XML reader, simply omit the class name from the configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;features<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;setOn</span> <span style="color: #000066;">feature</span>=<span style="color: #ff0000;">"http://a"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;setOn</span> <span style="color: #000066;">feature</span>=<span style="color: #ff0000;">"http://b"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;setOff</span> <span style="color: #000066;">feature</span>=<span style="color: #ff0000;">"http://c"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;setOff</span> <span style="color: #000066;">feature</span>=<span style="color: #ff0000;">"http://d"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/features<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="CSV"></a><h2> <span class="mw-headline">CSV</span></h2>
<p>CSV processing through the CSV Reader is configured through the <a href="http://www.milyn.org/xsd/smooks/csv-1.5.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/csv-1.5.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/csv-1.5.xsd</a> configuration namespace.
</p><p>A simple/basic configuration.
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:csv</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/csv-1.5.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Configure the CSV to parse the message into a stream of SAX events.</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname,lastname,gender,age,country"</span> <span style="color: #000066;">separator</span>=<span style="color: #ff0000;">"|"</span> <span style="color: #000066;">quote</span>=<span style="color: #ff0000;">"'"</span> <span style="color: #000066;">skipLines</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The above configuration will generate an event stream of the form:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv-set<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv-record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Tom<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Fennelly<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;gender<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Male<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/gender<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;age<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>21<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/age<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;country<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Ireland<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/country<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/csv-record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv-record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Tom<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Fennelly<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;gender<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Male<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/gender<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;age<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>21<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/age<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;country<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Ireland<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/country<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/csv-record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/csv-set<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Defining_fields"></a><h3> <span class="mw-headline">Defining fields</span></h3>
<p>Fields can be defined in either of 2 ways:
</p>
<ol><li> On the 'fields' attribute of the &lt;csv:reader&gt; configuration (as shown above).
</li><li> As the first record in the message after setting the 'fieldsInMessage' attribute of the &lt;csv:reader&gt; configuration to 'true'.
</li></ol>
<p>The field names must follow the same naming rules like XML element names:
</p>
<ul><li> Names can contain letters, numbers, and other characters
</li><li> Names cannot start with a number or punctuation character
</li><li> Names cannot start with the letters xml (or XML, or Xml, etc)
</li><li> Names cannot contain spaces
</li></ul>
<p>By setting the <b>rootElementName</b> and <b>recordElementName</b> attributes  you can modify the &lt;csv-set&gt; and &lt;csv-record&gt; element names. The same naming rules apply for these names.
</p>
<a name="Multi_Record_Field_Definitions"></a><h4> <span class="mw-headline">Multi Record Field Definitions</span></h4>
<p>All Flat File based reader configurations (including the CSV reader) support <b>Multi Record Field Definitions</b>, which means that the reader can support CSV message streams that contain varying (multiple different types) CSV record types.
</p><p>Take the following CSV message example:
</p>
<pre class="text" style="font-family:monospace;">book,22 Britannia Road,Amanda Hodgkinson<br>magazine,Time,April,2011<br>magazine,Irish Garden,Jan,2011<br>book,The Finkler Question,Howard Jacobson</pre>
<p>In this stream, we have 2 record types of "book" and "magazine".  We configure the CSV reader to process this stream as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"book[name,author] | magazine[*]"</span> <span style="color: #000066;">rootElementName</span>=<span style="color: #ff0000;">"sales"</span> <span style="color: #000066;">indent</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre>
<p>This reader configuration will generate the following output for the above sample message:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;sales<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;book</span> <span style="color: #000066;">number</span>=<span style="color: #ff0000;">"1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>22 Britannia Road<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;author<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Amanda Hodgkinson<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/author<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/book<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;magazine</span> <span style="color: #000066;">number</span>=<span style="color: #ff0000;">"2"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;field_0<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Time<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/field_0<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;field_1<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>April<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/field_1<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;field_2<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2011<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/field_2<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/magazine<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;magazine</span> <span style="color: #000066;">number</span>=<span style="color: #ff0000;">"3"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;field_0<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Irish Garden<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/field_0<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;field_1<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Jan<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/field_1<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;field_2<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2011<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/field_2<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/magazine<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;book</span> <span style="color: #000066;">number</span>=<span style="color: #ff0000;">"4"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>The Finkler Question<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;author<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Howard Jacobson<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/author<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/book<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/sales<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Note the sytax in the 'fields' attribute.  Each record definition is separated by the pipe character '|'.  Each record definition is constructed as <i>record-name[field-name,field-name]</i>.  <i>record-name</i> is matched against the first field in the incoming message and so used to select the appropriate recodr definition to be used for outputting that record.  Also note how you can use an astrix character ('*') when you don't want to name the record fields.  In this case (as when extra/unexpected fields are present in a record), the reader will generate the output field elements using a generated element name e.g. "field_0", "field_1" etc.  See the "magazine" record in the previous example.
</p><p><i><b>Note</b></i>: Multi Record Field Definitions are not supported when the fields are defined in the messase (fieldsInMessage="true").
</p>
<a name="String_manipulation_functions"></a><h3> <span class="mw-headline">String manipulation functions</span></h3>
<p>String manipulation functions can be defined per field. These functions are executed before that the data is converted into SAX events. The functions are defined after field name, separated with a question mark.
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:csv</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/csv-1.5.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"lastname?trim.capitalize,country?upper_case"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Take a look at the <a href="#String_manipulation_functions_for_readers" title="">#String manipulation functions for readers</a> chapter for the available functions and how the functions can be chained.
</p>
<a name="Ignoring_Fields"></a><h3> <span class="mw-headline">Ignoring Fields</span></h3>
<p>One or more fields of a CSV record can be ignored by specifying the <b>$ignore$</b> token in the fields configuration value.  You can specify the number of fields to be ignored simply by following the $ignore$ token with a number e.g. "$ignore$3" to ignore the next 3 fields.  "$ignore$+" ignores all fields to the end of the CSV record.
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:csv</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/csv-1.5.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname,$ignore$2,age,$ignore$+"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Binding_CSV_Records_to_Java"></a><h3> <span class="mw-headline">Binding CSV Records to Java</span></h3>
<p>Smooks v1.2 added support for making the binding of CSV records to Java Objects a very trivial task.  You no longer need to use the Javabean Cartridge directly (i.e. Smooks main Java binding functionality).
</p><p><i><b>Note</b></i>: This feature is not supported for Multi Record Field Definitions (see above), or when the fields are defined in the incoming message (fieldsInMessage="true").
</p><p>A Persons CSV record set such as:
</p>
<pre class="text" style="font-family:monospace;">Tom,Fennelly,Male,4,Ireland<br>Mike,Fennelly,Male,2,Ireland</pre>
<p>Can be bound to a Person of (no getters/setters):
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Person <span style="color: #009900;">{</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> firstname<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> lastname<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> country<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> Gender gender<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">int</span> age<span style="color: #339933;">;</span><br><span style="color: #009900;">}</span><br>&nbsp;<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">enum</span> Gender <span style="color: #009900;">{</span><br>    Male, <br>    Female<span style="color: #339933;">;</span><br><span style="color: #009900;">}</span></pre>
<p>Using a config of the form:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:csv</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/csv-1.5.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname,lastname,gender,age,country"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #808080; font-style: italic;">&lt;!-- Note how the field names match the property names on the Person class. --&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv:listBinding</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"people"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.milyn.csv.Person"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/csv:reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>To execute this configuration:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>configStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>csvStream<span style="color: #009900;">)</span>, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span><span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"people"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Smooks also supports creation of Maps from the CSV record set:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:csv</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/csv-1.5.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname,lastname,gender,age,country"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;csv:mapBinding</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"people"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.milyn.csv.Person"</span> <span style="color: #000066;">keyField</span>=<span style="color: #ff0000;">"firstname"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/csv:reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The above configuration would produce a Map of Person instances, keyed by the "firstname" value of each Person.  It would be executed as follows:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>configStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>csvStream<span style="color: #009900;">)</span>, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>Map<span style="color: #339933;">&lt;</span>String, Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>Map<span style="color: #339933;">&lt;</span>String, Person<span style="color: #339933;">&gt;</span><span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"people"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>Person tom <span style="color: #339933;">=</span> people.<span style="color: #006633;">get</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"Tom"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>Person mike <span style="color: #339933;">=</span> people.<span style="color: #006633;">get</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"Mike"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><a href="#Virtual_Object_Models_.28Maps_.26_Lists.29" title="">Virtual Models</a> are also supported, so you can define the <b>class</b> attribute as a java.util.Map and have the CSV field values bound into Map instances, which are in turn added to a List or a Map.
</p>
<a name="Programmatic_Configuration"></a><h3> <span class="mw-headline">Programmatic Configuration</span></h3>
<p>Programmatically configuring the CSV Reader on a Smooks instance is trivial (i.e. no XML required).  A number of options are available.
</p>
<a name="Configuring_Directly_on_the_Smooks_Instance"></a><h4> <span class="mw-headline">Configuring Directly on the Smooks Instance</span></h4>
<p>The following code configures a Smooks instance with a CSVReader for reading a people record set (see above), binding the record set into a List of Person instances:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">setReaderConfig</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> CSVReaderConfigurator<span style="color: #009900;">(</span><span style="color: #0000ff;">"firstname,lastname,gender,age,country"</span><span style="color: #009900;">)</span><br>                  .<span style="color: #006633;">setBinding</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> CSVBinding<span style="color: #009900;">(</span><span style="color: #0000ff;">"people"</span>, Person.<span style="color: #000000; font-weight: bold;">class</span>, CSVBindingType.<span style="color: #006633;">LIST</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>csvReader<span style="color: #009900;">)</span>, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span><span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"people"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Of course configuring the Java Binding is totally optional.  The Smooks instance could instead (or in conjunction with) be programmatically configured with other <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementations for carrying out other forms of processing on the CSV record set.
</p>
<a name="CSV_List_and_Map_Binders"></a><h4> <span class="mw-headline">CSV List and Map Binders</span></h4>
<p>If you're just interested in binding CSV Records directly onto a List or Map of a Java type that reflects the data in your CSV records, then you can use the CSVListBinder or CSVMapBinder classes.
</p><p><b>CSVListBinder:</b>
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Note: The binder instance should be cached and reused...</span><br>CSVListBinder binder <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> CSVListBinder<span style="color: #009900;">(</span><span style="color: #0000ff;">"firstname,lastname,gender,age,country"</span>, Person.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> binder.<span style="color: #006633;">bind</span><span style="color: #009900;">(</span>csvStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><b>CSVMapBinder:</b>
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Note: The binder instance should be cached and reused...</span><br>CSVMapBinder binder <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> CSVMapBinder<span style="color: #009900;">(</span><span style="color: #0000ff;">"firstname,lastname,gender,age,country"</span>, Person.<span style="color: #000000; font-weight: bold;">class</span>, <span style="color: #0000ff;">"firstname"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>Map<span style="color: #339933;">&lt;</span>String, Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> binder.<span style="color: #006633;">bind</span><span style="color: #009900;">(</span>csvStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>If you need more control over the binding process, revert back to the lower level APIs:
</p>
<ul><li> <a href="#Configuring_Directly_on_the_Smooks_Instance" title="">Configuring Directly on the Smooks Instance</a>
</li><li> <a href="#Java_Binding" title="">Java Binding</a>
</li></ul>
<a name="Fixed_Length_Values"></a><h2> <span class="mw-headline">Fixed Length Values</span></h2>
<p>Fixed Length processing through the Fixed Length Reader is configured through the <a href="http://www.milyn.org/xsd/smooks/fixed-length-1.3.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/fixed-length-1.3.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/fixed-length-1.3.xsd</a> configuration namespace.
</p><p>A simple/basic configuration.
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:fl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/fixed-length-1.3.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Configure the Fixed length to parse the message into a stream of SAX events.</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;fl:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname[10],lastname[10],gender[1],age[2],country[2]"</span> <span style="color: #000066;">skipLines</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Example input file.
</p>
<pre class="text" style="font-family:monospace;">#HEADER<br>Tom       Fennelly  M 21 IE<br>Maurice  Zeijen     M 27 NL</pre>
<p>The above configuration will generate an event stream of the form:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;set<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Tom       <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Fennelly  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;gender<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>M<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/gender<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;age<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> 21<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/age<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;country<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>IE<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/country<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Maurice  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Zeijen     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;gender<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>M<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/gender<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;age<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>27<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/age<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;country<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>NL<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/country<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/set<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Defining_fields_2"></a><h3> <span class="mw-headline">Defining fields</span></h3>
<p>Fields are defined in the 'fields' attribute as a comma separated list of names and field lengths. The field lengths must be defined between the brackets after the field name (see the example above).
</p><p>The field names must follow the same naming rules like XML element names:
</p>
<ul><li> Names can contain letters, numbers, and other characters
</li><li> Names cannot start with a number or punctuation character
</li><li> Names cannot start with the letters xml (or XML, or Xml, etc)
</li><li> Names cannot contain spaces
</li></ul>
<p>By setting the <b>rootElementName</b> and <b>recordElementName</b> attributes  you can modify the &lt;csv-set&gt; and &lt;csv-record&gt; element names. The same naming rules apply for these names.
</p>
<a name="String_manipulation_functions_2"></a><h3> <span class="mw-headline">String manipulation functions</span></h3>
<p>String manipulation functions can be defined per field. These functions are executed before that the data is converted into SAX events. The functions are defined after the field length definitiona and are optionally separated with a question mark.
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:fl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/fixed-length-1.3.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Configure the fixed length reader to parse the message into a stream of SAX events.</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;fl:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname[10]?trim,lastname[10]trim.capitalize,gender[1],age[2],country[2]"</span> <span style="color: #000066;">skipLines</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Take a look at the <a href="#String_manipulation_functions_for_readers" title="">#String manipulation functions for readers</a> chapter for the available functions and how the functions can be chained.
</p>
<a name="Ignoring_Fields_2"></a><h3> <span class="mw-headline">Ignoring Fields</span></h3>
<p>Characters ranges of a fixed length record can be ignored by specifying the <b>$ignore$[10]</b> token in the fields configuration value. You must specify the number of characters that need be ignored, just as a normal field.
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:fl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/fixed-length-1.3.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;fl:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname,$ignore$[2],age,$ignore$[10]"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Binding_fixed_length_Records_to_Java"></a><h3> <span class="mw-headline">Binding fixed length Records to Java</span></h3>
<p>Smooks v1.2 has added support for making the binding of fixed length records to Java Objects a very trivial task.  You don't need to use the Javabean Cartridge directly (i.e. Smooks main Java binding functionality).
</p><p>A Persons fixed length record set such as:
</p>
<pre class="text" style="font-family:monospace;">Tom       Fennelly  M 21 IE<br>Maurice  Zeijen     M 27 NL</pre>
<p>Can be bound to a Person of (no getters/setters):
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Person <span style="color: #009900;">{</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> firstname<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> lastname<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> country<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> gender<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">int</span> age<span style="color: #339933;">;</span><br><span style="color: #009900;">}</span></pre>
<p>Using a config of the form:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span>  <span style="color: #000066;">xmlns:fl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/fixed-length-1.3.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;fl:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname[10]?trim,lastname[10]?trim,gender[1],age[3]?trim,country[2]"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #808080; font-style: italic;">&lt;!-- Note how the field names match the property names on the Person class. --&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;fl:listBinding</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"people"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.milyn.fixedlength.Person"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/fl:reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>To execute this configuration:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>configStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>fixedLengthStream<span style="color: #009900;">)</span>, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span><span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"people"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Smooks also supports creation of Maps from the fixed length record set:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span>  <span style="color: #000066;">xmlns:fl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/fixed-length-1.3.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;fl:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname[10]?trim,lastname[10]?trim,gender[1],age[3]?trim,country[2]"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;fl:mapBinding</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"people"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.milyn.fixedlength.Person"</span> <span style="color: #000066;">keyField</span>=<span style="color: #ff0000;">"firstname"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/fl:reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The above configuration would produce a Map of Person instances, keyed by the "firstname" value of each Person.  It would be executed as follows:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>configStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>fixedLengthStream<span style="color: #009900;">)</span>, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>Map<span style="color: #339933;">&lt;</span>String, Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>Map<span style="color: #339933;">&lt;</span>String, Person<span style="color: #339933;">&gt;</span><span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"people"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>Person tom <span style="color: #339933;">=</span> people.<span style="color: #006633;">get</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"Tom"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>Person mike <span style="color: #339933;">=</span> people.<span style="color: #006633;">get</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"Maurice"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><a href="#Virtual_Object_Models_.28Maps_.26_Lists.29" title="">Virtual Models</a> are also supported, so you can define the <b>class</b> attribute as a java.util.Map and have the fixed length field values bound into Map instances, which are in turn added to a List or a Map.
</p>
<a name="Programmatic_Configuration_2"></a><h3> <span class="mw-headline">Programmatic Configuration</span></h3>
<p>Programmatically configuring the FixedLengthReader on a Smooks instance is trivial (i.e. no XML required).  A number of options are available.
</p>
<a name="Configuring_Directly_on_the_Smooks_Instance_2"></a><h4> <span class="mw-headline">Configuring Directly on the Smooks Instance</span></h4>
<p>The following code configures a Smooks instance with a FixedLengthReader for reading a people record set (see above), binding the record set into a List of Person instances:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">setReaderConfig</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> FixedLengthReaderConfigurator<span style="color: #009900;">(</span><span style="color: #0000ff;">"firstname[10]?trim,lastname[10]?trim,gender[1],age[3]?trim,country[2]"</span><span style="color: #009900;">)</span><br>                  .<span style="color: #006633;">setBinding</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> FixedLengthBinding<span style="color: #009900;">(</span><span style="color: #0000ff;">"people"</span>, Person.<span style="color: #000000; font-weight: bold;">class</span>, FixedLengthBindingType.<span style="color: #006633;">LIST</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>fixedLengthStream<span style="color: #009900;">)</span>, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span><span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"people"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Of course configuring the Java Binding is totally optional.  The Smooks instance could instead (or in conjunction with) be programmatically configured with other <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementations for carrying out other forms of processing on the fixed length record set.
</p>
<a name="Fixed_length_List_and_Map_Binders"></a><h4> <span class="mw-headline">Fixed length List and Map Binders</span></h4>
<p>If you're just interested in binding fixed length Records directly onto a List or Map of a Java type that reflects the data in your fixed length records, then you can use the FixedLengthListBinder or FixedLengthMapBinder classes.
</p><p><b>FixedLengthListBinder:</b>
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Note: The binder instance should be cached and reused...</span><br>FixedLengthListBinder binder <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> FixedLengthListBinder<span style="color: #009900;">(</span><span style="color: #0000ff;">"firstname[10]?trim,lastname[10]?trim,gender[1],age[3]?trim,country[2]"</span>, Person.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> binder.<span style="color: #006633;">bind</span><span style="color: #009900;">(</span>fixedLengthStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><b>FixedLengthMapBinder:</b>
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Note: The binder instance should be cached and reused...</span><br>FixedLengthMapBinder binder <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> FixedLengthMapBinder<span style="color: #009900;">(</span><span style="color: #0000ff;">"firstname[10]?trim,lastname[10]?trim,gender[1],age[3]?trim,country[2]"</span>, Person.<span style="color: #000000; font-weight: bold;">class</span>, <span style="color: #0000ff;">"firstname"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>Map<span style="color: #339933;">&lt;</span>String, Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> binder.<span style="color: #006633;">bind</span><span style="color: #009900;">(</span>fixedLengthStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>If you need more control over the binding process, revert back to the lower level APIs:
</p>
<ul><li> <a href="#Configuring_Directly_on_the_Smooks_Instance" title="">Configuring Directly on the Smooks Instance</a>
</li><li> <a href="#Java_Binding" title="">Java Binding</a>
</li></ul>
<a name="EDI"></a><h2> <span class="mw-headline">EDI</span></h2>
<p>EDI processing in Smooks supported through the <a href="http://www.milyn.org/xsd/smooks/edi-1.2.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/edi-1.2.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/edi-1.2.xsd</a> configuration namespace.
</p><p>The following is a simple/basic configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:edi</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/edi-1.2.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>    <br>	<span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Configure the EDI Reader to parse the message stream into a stream of SAX events.</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;edi:reader</span> <span style="color: #000066;">mappingModel</span>=<span style="color: #ff0000;">"edi-to-xml-order-mapping.xml"</span> <span style="color: #000066;">validate</span>=<span style="color: #ff0000;">"false"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<ul><li> <b>mappingModel</b>: Defines the EDI Mapping Model configuration for processing the EDI message stream to a stream of SAX events that can be processed by Smooks.
</li><li> <b>validate</b>: This attribute turns on/off datatype validation in the EDI Parser.  Validation is on by default.  It makes sense to turn datatype validation off on the EDI Reader if the EDI data is being bound into a Java Object model (using Java Bindings ala &lt;jb:bean&gt;).  This is because the validation will be happening anyway at the binding level.
</li></ul>
<a name="EDI_Mapping_Models"></a><h3> <span class="mw-headline">EDI Mapping Models</span></h3>
<p>The EDI to SAX Event mapping is performed based on an "Mapping Model" supplied to the EDI Reader. This model must be based on the <a href="http://www.milyn.org/xsd/smooks/edi-1.2.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/edi-1.2.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/edi-1.2.xsd</a> schema.  From this schema, you can see that segment groups are supported (nested segments), including groups within groups, repeating segments and repeating segment groups. Be sure to review the schema.
</p><p>The following illustration attempts to create a visualisation of the mapping process. The "input-message.edi" file specifies the EDI input, "edi-to-xml-order-mapping.xml" describes how to map that EDI message to SAX events and "expected.xml" illustrates the XML event stream that would result from applying the mapping.
</p><p><a href="http://smooks.org/mediawiki/index.php?title=Image:Edi-mapping.png" class="image" title="Image:Edi-mapping.png"><img alt="Image:Edi-mapping.png" src="./User-Guide_files/Edi-mapping.png" width="933" height="690" border="0"></a>
</p><p>So the above illustration attempts to highlight the following:
</p>
<ol><li> How the message delimiters (segment, field, component and sub-component) are specified in the mapping. In particular, how special characters like the linefeed character are specified using XML Character References.
</li><li> How segment groups (nested segments) are specified. In this case the first 2 segments are part of a group.
</li><li> How the actual field, component and sub-component values are specified and mapped to the target SAX events (to generate the XML).
</li></ol>
<a name="Segment_Cardinality"></a><h4> <span class="mw-headline">Segment Cardinality</span></h4>
<p>What's not shown above is how the &lt;medi:segment&gt; element supports the 2 optional attributes "minOccurs" and "maxOccurs" (default value of 1 in both cases). These attributes can be used to control the optional and required characteristics of a segment. A maxOccurs value of -1 indicates that the segment can repeat any number of times in that location of the EDI message (unbounded).
</p>
<a name="Segment_Groups"></a><h4> <span class="mw-headline">Segment Groups</span></h4>
<p>Segment groups can be added using the &lt;segmentGroup&gt; element. A Segment group is matched by the first segment in the group. A Segment Group can contain nested &lt;segmentGroup&gt; elements, but the first element in a &lt;segmentGroup&gt; must be a &lt;segment&gt;. &lt;segmentGroup&gt; elements support minOccurs/maxOccurs cardinality. They also support an optional "xmlTag" attribute, when if present will result in the XML generated by a matched segment group being inserted inside an element having the name of the xmlTag attribute value.
</p>
<a name="Segment_Matching"></a><h4> <span class="mw-headline">Segment Matching</span></h4>
<p>Segments are matched in one of 2 ways:
</p>
<ol><li> By an exact match on the segment code (segcode).
</li><li> By a <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/regex/package-summary.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/java/util/regex/package-summary.html" rel="nofollow">regex pattern match</a> on the full segment, where the segcode attribute defines the regex pattern (e.g. segcode="1A\*a.*").
</li></ol>
<a name="Required_Values_.26_Truncation"></a><h4> <span class="mw-headline">Required Values &amp; Truncation</span></h4>
<ul><li> <b>required</b>: &lt;field&gt;, &lt;component&gt; and &lt;sub-component&gt; configurations support a "required" attribute, which flags that &lt;field&gt;, &lt;component&gt; or &lt;sub-component&gt; as requiring a value.
</li></ul>
<dl><dd>By default, values are not required (fields, components and sub-components).
</dd></dl>
<ul><li> <b>truncatable</b>: &lt;segment&gt;, &lt;field&gt; and &lt;component&gt; configurations support a "truncatable" attribute. For a segment, this means that parser errors will not be generated when that segment does not specify trailing fields that are not "required" (see "required" attribute above). Likewise for fields/components and components/sub-components.
</li></ul>
<dl><dd>By default, segments, fields, and components are not truncatable.
</dd></dl>
<p>So, a &lt;field&gt;, &lt;component&gt; and &lt;sub-component&gt; can be present in a message in one of the following states:
</p>
<ol><li> Present with a value <i>(required="true")</i>
</li><li> Present without a value <i>(required="false")</i>
</li><li> Not Present <i>(required="false" and truncatable="true")</i>
</li></ol>
<a name="Imports"></a><h3> <span class="mw-headline">Imports </span></h3>
<p>Many message groups use the same segment definitions.  Being able to define these segments once and import them into a top level configuration saves on a lot of duplication.  A simple configuration demonstrating the import feature would be as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">"UTF-8"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:edimap</span> <span style="color: #000066;">xmlns:medi</span>=<span style="color: #ff0000;">"http://www.milyn.org/schema/edi-message-mapping-1.2.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:import</span> <span style="color: #000066;">truncatableSegments</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000066;">truncatableFields</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000066;">truncatableComponents</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000066;">resource</span>=<span style="color: #ff0000;">"example/edi-segment-definition.xml"</span> <span style="color: #000066;">namespace</span>=<span style="color: #ff0000;">"def"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:description</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"DVD Order"</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:delimiters</span> <span style="color: #000066;">segment</span>=<span style="color: #ff0000;">"&amp;#10;"</span> <span style="color: #000066;">field</span>=<span style="color: #ff0000;">"*"</span> <span style="color: #000066;">component</span>=<span style="color: #ff0000;">"^"</span> <span style="color: #000066;">sub-component</span>=<span style="color: #ff0000;">"~"</span> <span style="color: #000066;">escape</span>=<span style="color: #ff0000;">"?"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:segments</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"Order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:segment</span> <span style="color: #000066;">minOccurs</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">maxOccurs</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000066;">segref</span>=<span style="color: #ff0000;">"def:HDR"</span> <span style="color: #000066;">segcode</span>=<span style="color: #ff0000;">"HDR"</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"header"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:segment</span> <span style="color: #000066;">minOccurs</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">maxOccurs</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000066;">segref</span>=<span style="color: #ff0000;">"def:CUS"</span> <span style="color: #000066;">segcode</span>=<span style="color: #ff0000;">"CUS"</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"customer-details"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:segment</span> <span style="color: #000066;">minOccurs</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">maxOccurs</span>=<span style="color: #ff0000;">"-1"</span> <span style="color: #000066;">segref</span>=<span style="color: #ff0000;">"def:ORD"</span> <span style="color: #000066;">segcode</span>=<span style="color: #ff0000;">"ORD"</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/medi:segments<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/medi:edimap<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The configuration-example above demonstrates the use of import that were introduced in Smooks v1.1, where single segments or segments containing
childsegments can be separated into a separate file for better reuse in the future.
</p>
<ul><li> <b>segref</b>:  Contains a "namespace:name" referencing the segment to import.
</li><li> <b>truncatableSegments</b>: Overrides the 'truncatableSegments' specified in the imported resource mapping file.
</li><li> <b>truncatableFields</b>: Overrides the 'truncatableFields' specified in the imported resource mapping file.
</li><li> <b>truncatableComponents</b>: Overrides the 'truncatableComponets' specified in the imported resource mapping file.
</li></ul>
<a name="Type_Support"></a><h3> <span class="mw-headline">Type Support </span></h3>
<p>Since version 1.2, the &lt;field&gt;, &lt;component&gt; and &lt;sub-component&gt; elements support a "type" attribute that allows datatype specificaton.  It actually consists of 2 attributes:
</p>
<ol><li> <b>type</b>: The type attribute specifies the basic datatype.
</li><li> <b>typeParameters</b>: The typeParameters attribute specifies data decoding parameters for the <a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/package-summary.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/package-summary.html" rel="nofollow">DataDecoder</a> associated with the specified type.
</li></ol>
<p>The following example shows the type support:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">"UTF-8"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:edimap</span> <span style="color: #000066;">xmlns:medi</span>=<span style="color: #ff0000;">"http://www.milyn.org/schema/edi-message-mapping-1.2.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:description</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"Segment Definition DVD Order"</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:delimiters</span> <span style="color: #000066;">segment</span>=<span style="color: #ff0000;">"&amp;#10;"</span> <span style="color: #000066;">field</span>=<span style="color: #ff0000;">"*"</span> <span style="color: #000066;">component</span>=<span style="color: #ff0000;">"^"</span> <span style="color: #000066;">sub-component</span>=<span style="color: #ff0000;">"~"</span> <span style="color: #000066;">escape</span>=<span style="color: #ff0000;">"?"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:segments</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"Order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:segment</span> <span style="color: #000066;">segcode</span>=<span style="color: #ff0000;">"HDR"</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"header"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:field</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"order-id"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:field</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"status-code"</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"Integer"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:field</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"net-amount"</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"BigDecimal"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:field</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"total-amount"</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"BigDecimal"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:field</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"tax"</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"BigDecimal"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;medi:field</span> <span style="color: #000066;">xmltag</span>=<span style="color: #ff0000;">"date"</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"Date"</span> <span style="color: #000066;">typeParameters</span>=<span style="color: #ff0000;">"format=yyyyHHmm"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/medi:segment<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/medi:segments<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/medi:edimap<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>This type system has a number of uses:
</p>
<ul><li> Field Validation.
</li><li> <a href="#EJC_-_Edifact_Java_Compiler" title="">EJC - Edifact Java Compiler</a>
</li></ul>
<a name="Programmatic_Configuration_3"></a><h3> <span class="mw-headline">Programmatic Configuration</span></h3>
<p>Programmatically configuring the Smooks instance to use the EDIReader is done through the <a href="http://www.milyn.org/javadoc/v1.3/smooks-cartridges/edi/org/milyn/smooks/edi/EDIReaderConfigurator.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks-cartridges/edi/org/milyn/smooks/edi/EDIReaderConfigurator.html" rel="nofollow">EDIReaderConfigurator</a>:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Create and initialise the Smooks config for the parser...</span><br>smooks.<span style="color: #006633;">setReaderConfig</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> EDIReaderConfigurator<span style="color: #009900;">(</span><span style="color: #0000ff;">"/edi/models/invoice.xml"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Use the smooks as normal</span><br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>....<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<a name="EJC_-_Edifact_Java_Compiler"></a><h3> <span class="mw-headline">EJC - Edifact Java Compiler</span></h3>
<p>EJC makes the process of going from EDI to Java much simpler.  EJC is similar to <a href="http://jaxb.dev.java.net/" class="external text" title="http://jaxb.dev.java.net/" rel="nofollow">JAXBs</a> XJC, accept it is for EDI messages.
</p><p>EJC generates:
</p>
<ol><li> A Java Object model for a given EDI Mapping Model.
</li><li> A Smooks Java Binding config to populate the Java Object model from an instance of the EDI message described by the EDI Mapping Model (see #1 above).
</li><li> A Factory class that makes it very east to use EJC to bind EDI data to Java Object Model.
</li></ol>
<p>EJC allows you to write simple Java code such as the following:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Create an instance of the EJC generated Factory class.  This should normally be cached and reused...</span><br>OrderFactory orderFactory <span style="color: #339933;">=</span> OrderFactory.<span style="color: #006633;">getInstance</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Bind the EDI message stream data into the EJC generated Order model...</span><br>Order order <span style="color: #339933;">=</span> orderFactory.<span style="color: #006633;">fromEDI</span><span style="color: #009900;">(</span>ediStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Process the order data...</span><br>Header header <span style="color: #339933;">=</span> order.<span style="color: #006633;">getHeader</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aname+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Name</span></a> name <span style="color: #339933;">=</span> header.<span style="color: #006633;">getCustomerDetails</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">getName</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>List<span style="color: #339933;">&lt;</span>OrderItem<span style="color: #339933;">&gt;</span> orderItems <span style="color: #339933;">=</span> order.<span style="color: #006633;">getOrderItems</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>EJC can be executes through Maven or Ant.
</p>
<a name="EJC_Maven_Plugin"></a><h4> <span class="mw-headline">EJC Maven Plugin</span></h4>
<p>Executing the Maven Plugin for EJC is very simple.  You just need to install the plugin in your POM file as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;build<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;plugins<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;plugin<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.milyn<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>maven-ejc-plugin<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1.2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;configuration<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ediMappingFile<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>edi-model.xml<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ediMappingFile<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;packageName<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.acme.order.model<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/packageName<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/configuration<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;executions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;execution<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;goals<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;goal<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>generate<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/goal<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;/goals<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;/execution<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/executions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/plugin<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/plugins<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/build<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The plugin has 3 configuration parameters:
</p>
<ul><li> <b>ediMappingFile</b>:  The path to the <a href="#EDI_Mapping_Models" title="">EDI Mapping Model</a> File, within the maven project.  (<b>Optional</b> - default "src/main/resources/edi-model.xml").
</li><li> <b>packageName</b>:  The Java package into which the generated Java Artifacts are to be located (Java Object Model and Factory class).
</li><li> <b>destDir</b>:  The destination directory in which the generated artifacts are created and compiled from.  (<b>Optional</b> - default "target/ejc").
</li></ul>
<a name="EJC_Ant_Task"></a><h4> <span class="mw-headline">EJC Ant Task</span></h4>
<p>Executing EJC from an Ant script is trivial.  Just configure the EJC Ant task and execute it:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;target</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"ejc"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;taskdef</span> <span style="color: #000066;">resource</span>=<span style="color: #ff0000;">"org/milyn/ejc/ant/anttasks.properties"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;classpath<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;fileset</span> <span style="color: #000066;">dir</span>=<span style="color: #ff0000;">"/smooks-1.2/lib"</span> <span style="color: #000066;">includes</span>=<span style="color: #ff0000;">"*.jar"</span><span style="color: #000000; font-weight: bold;">/&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/classpath<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/taskdef<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ejc</span> <span style="color: #000066;">edimappingmodel</span>=<span style="color: #ff0000;">"src/main/resources/edi-model.xml"</span></span><br><span style="color: #009900;">         <span style="color: #000066;">destdir</span>=<span style="color: #ff0000;">"src/main/java"</span></span><br><span style="color: #009900;">         <span style="color: #000066;">packagename</span>=<span style="color: #ff0000;">"com.acme.order.model"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Ant as usual from here on... compile and jar the source... --&gt;</span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/target<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Using_EJC"></a><h4> <span class="mw-headline">Using EJC</span></h4>
<p>The easiest way to get going with EJC is to check out the <a href="http://smooks.org/mediawiki/index.php?title=V1.5:ejc" title="V1.5:ejc">EJC Example</a>.
</p>
<a name="UN.2FEDIFACT"></a><h3> <span class="mw-headline">UN/EDIFACT</span></h3>
<p>Smooks v1.5 provides comprehensive out-of-the-box support for UN/EDIFACT message interchanges:
</p><p><br>
</p>
<ul><li> Pre-generated EDI Mapping Models generated from the <a href="http://www.unece.org/trade/untdid/down_index.htm" class="external text" title="http://www.unece.org/trade/untdid/down_index.htm" rel="nofollow">official UN/EDIFACT message definition zip directories</a>.  This allows you to easily convert a UN/EDIFACT message interchange into a more consumable XML format.
</li><li> Pre-generated Java Bindings for easy reading and writing of UN/EDIFACT Interchanges using pure Java.
</li></ul>
<p><br>
The following sections provide more details on these UN/EDIFACT capabilities.
</p><p><br>
</p>
<a name="UNEdifactReader_Reader_Configuration"></a><h4> <span class="mw-headline">UNEdifactReader Reader Configuration</span></h4>
<p>UN/EDIFACT Interchanges are supported through a specialized variant of the base &lt;edi:reader&gt;.  This reader is configured through the <a href="http://www.milyn.org/xsd/smooks/unedifact-1.4.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/unedifact-1.4.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/unedifact-1.4.xsd</a> configuration namespace as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:unedifact</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/unedifact-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;unedifact:reader</span> <span style="color: #000066;">mappingModel</span>=<span style="color: #ff0000;">"urn:org.milyn.edi.unedifact:d03b-mapping:*"</span> <span style="color: #000066;">ignoreNewLines</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
The <i>mappingModel</i> attribute defines a URN that references the Maven artifact of the <a href="#Mapping_Model_Zip_Sets" title="">mapping model zip set</a> to be used by the reader.
</p><p><br>
It's also possible to programmatically configure a Smooks instance to consume a UN/EDIFACT Interchange (via a UNEdifactReaderConfigurator instance):
</p><p><br>
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">setReaderConfig</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> UNEdifactReaderConfigurator<span style="color: #009900;">(</span><span style="color: #0000ff;">"urn:org.milyn.edi.unedifact:d03b-mapping:*"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>etc....</pre>
<a name="Application_Classpath_Configuration"></a><h4> <span class="mw-headline">Application Classpath Configuration</span></h4>
<p>The containing application needs to include the following on its classpath:
</p><p><br>
</p>
<ol><li> The required EDI Mapping Models.
</li><li> Smooks EDI Cartridge
</li></ol>
<p><br>
An example Maven dependencies configuration might include the following:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">&lt;!-- Smooks EDI Cartridge --&gt;</span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.milyn<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>milyn-smooks-edi<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1.5-SNAPSHOT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #808080; font-style: italic;">&lt;!-- Required Mapping Models --&gt;</span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.milyn.edi.unedifact<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>d93a-mapping<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1.5-SNAPSHOT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.milyn.edi.unedifact<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>d03b-mapping<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1.5-SNAPSHOT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>See the <b>unedifact</b> <a href="http://smooks.org/mediawiki/index.php?title=Examples" title="Examples">Examples</a>.
</p><p><br>
</p>
<a name="Mapping_Model_Zip_Sets"></a><h4> <span class="mw-headline">Mapping Model Zip Sets</span></h4>
<p>In an effort to simplify the processing of UN/EDIFACT Interchanges, we have built tools (ECT) that allow us to construct EDI Mapping Model "Zip Sets" from <a href="http://www.unece.org/trade/untdid/down_index.htm" class="external text" title="http://www.unece.org/trade/untdid/down_index.htm" rel="nofollow">the official UN/EDIFACT message definition zip directories</a>.  We have built Zip Sets for all of the <a href="http://www.unece.org/trade/untdid/down_index.htm" class="external text" title="http://www.unece.org/trade/untdid/down_index.htm" rel="nofollow">official UN/EDIFACT message definition zip directories</a> and have deployed them to the maven repositories, from where users can easily access the EDI Mapping Models for the UN/EDIFACT message sets they need to process (using Maven, Ivy etc).
</p><p><br>
Once an application has added an EDI Mapping Model zip set to their application classpath, Smooks can be configured to use these Mapping Models by simply referencing the Maven artifact using a URN as the <i>mappingModel</i> attribute value on the &lt;unedifact:reader&gt; configuration (<b>urn:&lt;group-id&gt;:&lt;artifact-id&gt;:&lt;version&gt;</b>):
</p><p><br>
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:unedifact</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/unedifact-1.4.xsd"</span></span><br>&nbsp;<br><span style="color: #009900;">    <span style="color: #000000; font-weight: bold;">&lt;unedifact:reader</span> <span style="color: #000066;">mappingModel</span>=<span style="color: #ff0000;">"urn:org.milyn.edi.unedifact:d03b-mapping:*"</span> <span style="color: #000066;">ignoreNewLines</span>=<span style="color: #ff0000;">"true"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
Notes:
</p>
<ul><li> The <i>mappingModel</i> attribute can define multiple <a href="#EDI_Mapping_Models" title="">EDI Mapping Models</a> URNs (comma separated).  This allows the UN/EDIFACT Interchange Reader process interchanges that contain multiple UN/EDIFACT messages defined in different directories.
</li><li> See <a href="#UN.2FEDIFACT_Mapping_Model_URNs" title="">UN/EDIFACT Mapping Model URNs</a> for a list of the pre-generated models.
</li></ul>
<a name="UN.2FEDIFACT_Mapping_Model_URNs"></a><h4> <span class="mw-headline">UN/EDIFACT Mapping Model URNs</span></h4>
<p><a href="#Mapping_Model_Zip_Sets" title="">Mapping Model Zip Sets</a> are available for all of the <a href="http://www.unece.org/trade/untdid/down_index.htm" class="external text" title="http://www.unece.org/trade/untdid/down_index.htm" rel="nofollow">UN/EDIFACT Directories</a>.  These are available from the <a href="http://smooks.org/mediawiki/index.php?title=Maven_%26_Ant" title="Maven &amp; Ant">Maven SNAPSHOT and Central repositories</a> and can be added to your application using standard Maven dependency management.
</p><p><br>
As an example.  To add the D93A <a href="#Mapping_Model_Zip_Sets" title="">Mapping Model Zip Set</a> to your application classpath, simply add the following &lt;dependency&gt; to your applications POM (translate as appropriate for Ivy etc):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">&lt;!-- The mapping model sip set for the D93A directory... --&gt;</span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.milyn.edi.unedifact<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>d93a-mapping<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1.5-SNAPSHOT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
And then to configure Smooks to use that <a href="#Mapping_Model_Zip_Sets" title="">Mapping Model Zip Set</a>, simply add the &lt;unedifact:reader&gt; configuration to your Smooks configuration as follows:
</p><p><br>
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;unedifact:reader</span> <span style="color: #000066;">mappingModel</span>=<span style="color: #ff0000;">"urn:org.milyn.edi.unedifact:d93a-mapping:*"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre>
<p><br>
Note how you configure the reader using a URN constructed from the Maven artifact dependency information.  Also note that you can add multiple <a href="#Mapping_Model_Zip_Sets" title="">Mapping Model Zip Sets</a> to your application's classpath, adding all of them to your &lt;unedifact:reader&gt; configuration by comma separating the URNs.
</p>
<a name="Reading_and_Writing_UN.2FEDIFACT_with_Java"></a><h4> <span class="mw-headline">Reading and Writing UN/EDIFACT with Java</span></h4>
<p>As with the <a href="#Mapping_Model_Zip_Sets" title="">Mapping Model Zip Sets</a>, we have built tools (EJC) that help processing of UN/EDIFACT messages in Java.  These tools greatly simplify working with UN/EDIFACT in Java.
</p><p><br>
Using EJC, we have pre-generated Java Binding Model sets (one per <a href="#Mapping_Model_Zip_Sets" title="">Mapping Model Zip Set</a>) that allow you to process UN/EDIFACT Interchanges using a very simple (generated) Factory class.
</p><p><br>
As an example, the following code illustrates how to process a D03B UN/EDIFACT message interchange.
</p><p><br>
<b>Reading:</b>
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Create an instance of the EJC generated factory class... cache this and reuse&nbsp;!!!</span><br>D03BInterchangeFactory factory <span style="color: #339933;">=</span> D03BInterchangeFactory.<span style="color: #006633;">getInstance</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Deserialize the UN/EDIFACT interchange stream to Java...</span><br>UNEdifactInterchange interchange <span style="color: #339933;">=</span> factory.<span style="color: #006633;">fromUNEdifact</span><span style="color: #009900;">(</span>ediInStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Need to test which interchange syntax version.  Supports v4.1 at the moment...</span><br><span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">(</span>interchange <span style="color: #000000; font-weight: bold;">instanceof</span> UNEdifactInterchange41<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>    UNEdifactInterchange41 interchange41 <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>UNEdifactInterchange41<span style="color: #009900;">)</span> interchange<span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">for</span><span style="color: #009900;">(</span>UNEdifactMessage41 message <span style="color: #339933;">:</span> interchange41.<span style="color: #006633;">getMessages</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        <span style="color: #666666; font-style: italic;">// Process the messages...</span><br>&nbsp;<br>        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aobject+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Object</span></a> messageObj <span style="color: #339933;">=</span> message.<span style="color: #006633;">getMessage</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">(</span>messageObj <span style="color: #000000; font-weight: bold;">instanceof</span> Invoic<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>            <span style="color: #666666; font-style: italic;">// It's an INVOIC message....</span><br>            Invoic invoic <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>Invoic<span style="color: #009900;">)</span> messageObj<span style="color: #339933;">;</span><br>            ItemDescription itemDescription <span style="color: #339933;">=</span> invoic.<span style="color: #006633;">getItemDescription</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>            <span style="color: #666666; font-style: italic;">// etc etc....</span><br>        <span style="color: #009900;">}</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">(</span>messageObj <span style="color: #000000; font-weight: bold;">instanceof</span> Cuscar<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>            <span style="color: #666666; font-style: italic;">// It's a CUSCAR message...</span><br>        <span style="color: #009900;">}</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">(</span>etc etc etc...<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>            <span style="color: #666666; font-style: italic;">// etc etc etc...</span><br>        <span style="color: #009900;">}</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<p><br>
<b>Writing:</b>
</p>
<pre class="java" style="font-family:monospace;">factory.<span style="color: #006633;">toUNEdifact</span><span style="color: #009900;">(</span>interchange, ediOutStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><br>
See the following section for a list of the pre-generated models and their Maven artifact details.
</p>
<a name="UN.2FEDIFACT_Java_Binding_URNs"></a><h4> <span class="mw-headline">UN/EDIFACT Java Binding URNs</span></h4>
<p>As with the <a href="#UN.2FEDIFACT_Mapping_Model_URNs" title="">Mapping Model Zip Sets</a>, Smooks provides pre-generated UN/EDIFACT Java Object Models distributed via the <a href="http://smooks.org/mediawiki/index.php?title=Maven_%26_Ant" title="Maven &amp; Ant">Maven SNAPSHOT and Central repos</a>.
</p><p><br>
As an example using Maven, adding support for processing a D03B message interchange (see previous section) is simply a case of adding the binding dependency for that directory:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.milyn.edi.unedifact<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>d03b-binding<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1.5-SNAPSHOT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
Models have already been pre-generated and are available in the <a href="http://smooks.org/mediawiki/index.php?title=Maven_%26_Ant" title="Maven &amp; Ant">Maven SNAPSHOT and Central repos</a>.  All you need to do is add the appropriate Maven dependency, as outlined above (translate as appropriate for Ivy etc).
</p>
<a name="JSON"></a><h2> <span class="mw-headline">JSON</span></h2>
<p>Processing JSON with Smooks requires a JSON reader to be configured:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:json</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/json-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;json:reader</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The XML element name of the root element, the element name of document and the element name of array elements can be configured with the following configuration options:
</p>
<ul><li> <b>rootName</b>: The name of the root element. Default: <b>yaml</b>.
</li><li> <b>elementName</b>: The name of a sequence element. Default: <b>element</b>.
</li></ul>
<p>JSON allowes characters in the key name that aren't allowed in XML element name. To workaround that problem the reader offers multiple solutions.
The JSON reader can search and replace whitespaces, illegal characters and the number in key names that start with a number. It is also possible to replace
one key name with a completely different name. The following example demonstrates all these features:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:json</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/json-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;json:reader</span> <span style="color: #000066;">keyWhitspaceReplacement</span>=<span style="color: #ff0000;">"_"</span> <span style="color: #000066;">keyPrefixOnNumeric</span>=<span style="color: #ff0000;">"n"</span> <span style="color: #000066;">illegalElementNameCharReplacement</span>=<span style="color: #ff0000;">"."</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;json:keyMap<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;json:key</span> <span style="color: #000066;">from</span>=<span style="color: #ff0000;">"some key"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>someKey<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/json:key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;json:key</span> <span style="color: #000066;">from</span>=<span style="color: #ff0000;">"some&amp;amp;key"</span> <span style="color: #000066;">to</span>=<span style="color: #ff0000;">"someAndKey"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/json:keyMap<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/json:reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<ul><li> <b>keyWhitspaceReplacement</b>: The replacement character for whitespaces in a json map key. By default this not defined, so that the reader doesn't search for white spaces.
</li><li> <b>keyPrefixOnNumeric</b>: The prefix character to add if the JSON node name starts with a number. By default this is not defined, so that the reader doesn't search for element names that start with a number.
</li><li> <b>illegalElementNameCharReplacement</b>: If illegal characters are encountered in a JSON element name then they are replaced with this value.
</li></ul>
<p>The following options can also be configured on the JSON reader:
</p>
<ul><li> <b>nullValueReplacement</b>: The replacement string for JSON NULL values. Default is an empty string.
</li><li> <b>encoding</b>: The default encoding of any JSON message InputStream processed by this Reader. Default of 'UTF-8'. <b>NOTE</b>: You shouldn't need this configuration parameter and _it will be removed in a future realese_.  Instead, you should manage the JSON stream Source character encoding by supplying a <i>java.io.Reader</i> to the Smooks.filterSource() method.
</li></ul>
<a name="Programmatic_Configuration_4"></a><h3> <span class="mw-headline">Programmatic Configuration</span></h3>
<p>Smooks is programmatically configured to read a JSON configuration using the <a href="http://www.milyn.org/javadoc/v1.3/smooks-cartridges/json/org/milyn/json/JSONReaderConfigurator.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks-cartridges/json/org/milyn/json/JSONReaderConfigurator.html" rel="nofollow">JSONReaderConfigurator</a> class.
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">setReaderConfig</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> JSONReaderConfigurator<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">setRootName</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"root"</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">setArrayElementName</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"e"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Use Smooks as normal...</span></pre>
<a name="YAML"></a><h2> <span class="mw-headline">YAML</span></h2>
<p>Processing YAML with Smooks requires a YAML reader to be configured:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:yaml</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/yaml-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;yaml:reader</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>YAML stream can contain multiple documents. The reader handles this by adding a &lt;document&gt; element as a child of the root element. An XML serialized
YAML stream with one empty YAML document looks like this:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;yaml<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;document<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/document<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/yaml<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The XML element name of the root element, the element name of document and the element name of array elements can be configured with the following configuration options:
</p>
<ul><li> <b>rootName</b>: The name of the root element. Default: <b>yaml</b>.
</li><li> <b>documentName</b>: The name of the document element. Default: <b>document</b>.
</li><li> <b>elementName</b>: The name of a sequence element. Default: <b>element</b>.
</li></ul>
<p>YAML allowes characters in the key name that aren't allowed in XML element name. To workaround that problem the reader offers multiple solutions.
The YAML reader can search and replace white spaces, illegal characters and the number in key names that start with a number. It is also possible to replace
one key name with a completely different name. The following example demonstrates all these features:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:yaml</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/yaml-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;yaml:reader</span> <span style="color: #000066;">keyWhitspaceReplacement</span>=<span style="color: #ff0000;">"_"</span> <span style="color: #000066;">keyPrefixOnNumeric</span>=<span style="color: #ff0000;">"n"</span> <span style="color: #000066;">illegalElementNameCharReplacement</span>=<span style="color: #ff0000;">"."</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;yaml:keyMap<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;yaml:key</span> <span style="color: #000066;">from</span>=<span style="color: #ff0000;">"some key"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>someKey<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/yaml:key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;yaml:key</span> <span style="color: #000066;">from</span>=<span style="color: #ff0000;">"some&amp;amp;key"</span> <span style="color: #000066;">to</span>=<span style="color: #ff0000;">"someAndKey"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/yaml:keyMap<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/yaml:reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<ul><li> <b>keyWhitspaceReplacement</b>: The replacement character for whitespaces in a yaml map key. By default this not defined, so that the reader doesn't search for white spaces.
</li><li> <b>keyPrefixOnNumeric</b>: The prefix character to add if the YAML node name starts with a number. By default this is not defined, so that the reader doesn't search for element names that start with a number.
</li><li> <b>illegalElementNameCharReplacement</b>: If illegal characters are encountered in a YAML element name then they are replaced with this value. By default this is not defined, so that the reader doesn't search for element names with illegal characters.
</li></ul>
<p>YAML has the concept of anchors and aliasses. The YAML reader can handle anchors and aliasses with three different strategies. The strategy is defined via the <b>aliasStrategy</b> configuration option. This option can have the following values:
</p>
<ul><li> <b>REFER</b>: The reader creates reference attributes on the element that have an anchor or an alias. The element with the anchor gets the <b>id</b> attribute containing the name from the anchor as the attribute value. The element with the alias gets the <b>ref</b> attribute also containing the name of the anchor as the attribute value. The anchor and alias attribute names can be defined by the <b>anchorAttributeName</b> and <b>aliasAttributeName</b>.
</li><li> <b>RESOLVE</b>: The reader resolves the value or the data structure of an anchor when its alias is encountered. This means that the SAX events of the anchor are repeated as child events of the alias element. When a YAML document contains a lot of anchors or anchors with a huge data structure then this can lead to memory problems.
</li><li> <b>REFER_RESOLVE</b>: This is a combination of <b>REFER</b> and <b>RESOLVE</b>. The anchor and alias attributes are set but the anchor value or data structure is also resolved. This option is useful when the name of the anchor has a business meaning.
</li></ul>
<p>By the default the YAML reader uses the <b>REFER</b> strategy.
</p>
<a name="Programmatic_Configuration_5"></a><h3> <span class="mw-headline">Programmatic Configuration</span></h3>
<p>Smooks is programmatically configured to read a YAML configuration using the <a href="http://www.milyn.org/javadoc/v1.4/smooks-cartridges/yaml/org/milyn/yaml/YamlReaderConfigurator.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks-cartridges/yaml/org/milyn/yaml/YamlReaderConfigurator.html" rel="nofollow">YamlReaderConfigurator</a> class.
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">setReaderConfig</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> YamlReaderConfigurator<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">setRootName</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"root"</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">setDocumentName</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"doc"</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">setArrayElementName</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"e"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">setAliasStrategy</span><span style="color: #009900;">(</span>AliasStrategy.<span style="color: #006633;">REFER_RESOLVE</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">setAnchorAttributeName</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"anchor"</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">setAliasAttributeName</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"alias"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Use Smooks as normal...</span></pre>
<p><br>
</p>
<a name="Java_to_Java"></a><h2> <span class="mw-headline">Java to Java</span></h2>
<p>Smooks can transform one Java object graph to another Java object graph. For this transformation Smooks uses the SAX processing model, which means no intermediate object model is constructed for populating the target Java object graph. Instead, we go straight from the source Java object graph, to a stream of SAX events, which are used to populate the target Java object graph.
</p>
<a name="Source_and_Target_Object_Models"></a><h3> <span class="mw-headline">Source and Target Object Models</span></h3>
<p>The required mappings from the source to target Object models are as follows:
</p><p><a href="http://smooks.org/mediawiki/index.php?title=Image:Java-to-java3.gif" class="image" title="Image:java-to-java3.gif"><img alt="Image:java-to-java3.gif" src="./User-Guide_files/Java-to-java3.gif" width="653" height="309" border="0"></a>
</p>
<a name="Source_Model_Event_Stream"></a><h3> <span class="mw-headline">Source Model Event Stream</span></h3>
<p>Using the Html Smooks Report Generator tool, we can see that the Event Stream produced by the source Object Model is as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;example.srcmodel.Order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customerNumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customerNumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customerName<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customerName<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;orderItems<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;example.srcmodel.OrderItem<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;productId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/productId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/example.srcmodel.OrderItem<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/orderItems<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/example.srcmodel.Order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>So we need to target the Smooks Javabean resources at this event stream. This is shown in the Smooks Configuration.
</p>
<a name="Smooks_Configuration"></a><h4> <span class="mw-headline">Smooks Configuration</span></h4>
<p>The Smooks configuration for performing this transform ("smooks-config.xml") is as follows (see the Source Model Event Stream above):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"lineOrder"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"example.trgmodel.LineOrder"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"example.srcmodel.Order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"lineItems"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"lineItems"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerId"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customerNumber"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerName"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customerName"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"lineItems"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"example.trgmodel.LineItem[]"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"orderItems"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"lineItem"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"lineItem"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"example.trgmodel.LineItem"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"example.srcmodel.OrderItem"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"productCode"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"example.srcmodel.OrderItem/productId"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"unitQuantity"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"example.srcmodel.OrderItem/quantity"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"unitPrice"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"example.srcmodel.OrderItem/price"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Smooks_Execution"></a><h4> <span class="mw-headline">Smooks Execution</span></h4>
<p>The source object model is provided to Smooks via a <b>org.milyn.delivery.JavaSource</b> Object. This object is created by passing the constructor the root object of the source model. The resulting JavaSource object is used in the <b>Smooks#filter</b> method. The resulting code could look like as follows:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">protected</span> LineOrder runSmooksTransform<span style="color: #009900;">(</span>Order srcOrder<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a>, SAXException <span style="color: #009900;">{</span><br>    Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #0000ff;">"smooks-config.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    ExecutionContext executionContext <span style="color: #339933;">=</span> smooks.<span style="color: #006633;">createExecutionContext</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// Transform the source Order to the target LineOrder via a</span><br>    <span style="color: #666666; font-style: italic;">// JavaSource and JavaResult instance...</span><br>    JavaSource source <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaSource<span style="color: #009900;">(</span>srcOrder<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// Configure the execution context to generate a report...</span><br>    executionContext.<span style="color: #006633;">setEventListener</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> HtmlReportGenerator<span style="color: #009900;">(</span><span style="color: #0000ff;">"target/report/report.html"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>executionContext, source, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">(</span>LineOrder<span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"lineOrder"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br><span style="color: #009900;">}</span></pre>
<a name="Java_to_Text_.28XML.2C_CSV.2C_EDI_etc.29"></a><h2> <span class="mw-headline">Java to Text (XML, CSV, EDI etc)</span></h2>
<p>As stated in other parts of this guide, the Smooks core runtime works by processing a stream of SAX events produced by an input Source of some type (XML, EDI, Java etc) and using those events to trigger <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> logic.  In the case of a Java Source (see previous section on "Java to Java"), Smooks uses XStream to generate this stream of SAX events.
</p><p>Sometimes, however, you just want to apply a template (e.g. a FreeMarker template) to a Java Source object model and produce XML, CSV, EDI etc.  You don't want to incur the wasted overhead of generating a stream of SAX events that you are not going to use.  To do this, you need to tell the Smooks core runtime to not generate the stream of events.  This can be done in one of 2 ways.
</p><p>By calling <i>setEventStreamRequired(false)</i> on the <i>JavaSource</i> instance being supplied to <i>Smooks.filterSource</i>:
</p>
<pre class="java" style="font-family:monospace;">JavaSource javaSource <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaSource<span style="color: #009900;">(</span>orderBean<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Turn streaming off via the JavaSource...</span><br>javaSource.<span style="color: #006633;">setEventStreamRequired</span><span style="color: #009900;">(</span><span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>javaSource, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Or, by turning off the "<a href="http://www.smooks.org/sax/features/generate-java-event-stream" class="external free" title="http://www.smooks.org/sax/features/generate-java-event-stream" rel="nofollow">http://www.smooks.org/sax/features/generate-java-event-stream</a>" &lt;reader&gt; feature in the Smooks configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;features<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;setOff</span> <span style="color: #000066;">feature</span>=<span style="color: #ff0000;">"http://www.smooks.org/sax/features/generate-java-event-stream"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/features<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Other Smooks configurations e.g. a FreeMarker template... --&gt;</span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>When applying the FreeMarker template, the name of the templating context beans (i.e. the names used in your template) depends on the Object type in the JavaSource:
</p>
<ol><li> If the object is a <i>Map</i>, then that Map instance becomes the templating context and so you can just use the Map entry keys as the bean names in your template.
</li><li> For non-Map objects, the <i>JavaSource</i> class takes the Object Class SimpleName and creates a JavaBean property name from it.  This is the name of the context bean used for the templating.  So, if the bean class name is <i>com.acme.Order</i>, then the context bean name, for the purpose of templating, will be "order".
</li></ol>
<a name="String_manipulation_functions_for_readers"></a><h2> <span class="mw-headline">String manipulation functions for readers</span></h2>
<p>The CSV en Fixed Length readers support string manipulation functions that are executed on the input data before that the data is converted into SAX events. The following functions are available:
</p>
<ul><li> <b>upper_case</b>: Returns the upper case version of the string.
</li><li> <b>lower_case</b>: Returns the lower case version of the string.
</li><li> <b>cap_first</b>: Returns the string with the very first word of the string capitalized.
</li><li> <b>uncap_first</b>: Returns the string with the very first word of the string un-capitalized. The opposite to <b>cap_first</b>.
</li><li> <b>capitalize</b>: Returns the string with all words capitalized.
</li><li> <b>trim</b>: Returns the string without leading and trailing white-spaces.
</li><li> <b>left_trim</b>: Returns the string without leading white-spaces.
</li><li> <b>right_trim</b>: Returns the string without trailing white-spaces.
</li></ul>
<p>Functions can be chained via the point separator. Example: <b>trim.upper_case</b>
</p><p>It depends on the reader how the functions are defined per field. Please look at the individual chapters of the readers for that information.
</p>
<a name="Validating_Data"></a><h1> <span class="mw-headline">Validating Data</span></h1>
<a name="Rules"></a><h2> <span class="mw-headline">Rules</span></h2>
<p>Rules in Smooks refer to a general concept and is not specific to any cartridge. A RuleProvider can be configured and referenced from other components.  As of Smooks v1.2, the only Cartridge using Rules functionality is the <a href="#Validation" title="">Validation Cartridge</a>.
</p><p>So, lets start by looking at what rules in Smooks are, and how they are used.
</p>
<a name="Rule_Configuration"></a><h3> <span class="mw-headline"> Rule Configuration </span></h3>
<p>Rules are centrally defined through "ruleBase" definitions.  A single Smooks config can reference many "ruleBase" definitions.  A rulesBase configuration as a <b>name</b>, a rule <b>src</b> and a rule <b>provider</b>.  The format of the rule source ("src") is entirely dependent on the provider implementation.  The only requirement is that the individual rules be named (unique within the context of a single source) so as they can be referenced by their name.
</p><p>An example of a ruleBase configuration is as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span>  <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span>  <span style="color: #000066;">xmlns:rules</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/rules-1.0.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;rules:ruleBases<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;rules:ruleBase</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"regexAddressing"</span> <span style="color: #000066;">src</span>=<span style="color: #ff0000;">"/org/milyn/validation/address.properties"</span> <span style="color: #000066;">provider</span>=<span style="color: #ff0000;">"org.milyn.rules.regex.RegexProvider"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;rules:ruleBase</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">src</span>=<span style="color: #ff0000;">"/org/milyn/validation/order/rules/order-rules.csv"</span> <span style="color: #000066;">provider</span>=<span style="color: #ff0000;">"org.milyn.rules.mvel.MVELProvider"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/rules:ruleBases<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Rulebase_Configuration_Options"></a><h4> <span class="mw-headline">Rulebase Configuration Options</span></h4>
<p>The following are the configuration options for the &lt;rules:ruleBase&gt; configuration element.
</p>
<ul><li> <b>name</b>: Is used to reference this rule from other components, like from a validation configuration that we will look at shortly. Required.
</li><li> <b>src</b>: Is a file or anything meaningful to the RuleProvider. This could be a file containing rules for example. Required.
</li><li> <b>provider</b>: Is the actual provider implementation that you want to use. This is where the different technologies come into play. In the above configuration we have one RuleProvider that uses regular expression. As you might have guessed you can specify multiple ruleBase element and have as many RuleProviders you need. Required.
</li></ul>
<a name="RuleProvider_Implementations"></a><h3> <span class="mw-headline"> RuleProvider Implementations </span></h3>
<p>Rule Providers implement the <b>org.milyn.rules.RuleProvider</b> interface.
</p><p>Smooks v1.2 supports 2 RuleProvider implementations out of the box:
</p>
<ol><li> <a href="#RegexProvider" title="">RegexProvider</a>
</li><li> <a href="#MVELProvider" title="">MVELProvider </a>
</li></ol>
<p>You can easily create custom RuleProvider implementations.  Future versions of Smooks will probably include support for  e.g. a Drools RuleProvider.
</p>
<a name="RegexProvider"></a><h4> <span class="mw-headline"> RegexProvider </span></h4>
<p>As it's name suggests, the RegexProvider is based on regular expression.  It allows you to define low level rules specific to the format of specific fields of data in the message being filtered e.g. that a particular field is a valid email address.
</p><p>Configuration of a Regex ruleBase would look like this:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span>  <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span>  <span style="color: #000066;">xmlns:rules</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/rules-1.0.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;rules:ruleBases<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;rules:ruleBase</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"customer"</span> <span style="color: #000066;">src</span>=<span style="color: #ff0000;">"/org/milyn/validation/order/rules/customer.properties"</span> <span style="color: #000066;">provider</span>=<span style="color: #ff0000;">"org.milyn.rules.regex.RegexProvider"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/rules:ruleBases<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Regex expressions are defined in standard .properties file format.  An example of a "customer.properties" Regex rule definition file (from the above example) might be as follows:
</p>
<pre class="text" style="font-family:monospace;"># Customer data rules...<br>customerId=[A-Z][0-9]{5}<br>customerName=[A-Z][a-z]*, [A-Z][a-z]</pre>
<a name="Useful_Regular_Expressions"></a><h5> <span class="mw-headline">Useful Regular Expressions</span></h5>
<p>See <a href="http://smooks.org/mediawiki/index.php?title=Useful_Regular_Expressions" title="Useful Regular Expressions">Useful Regular Expressions</a>.
</p>
<a name="MVELProvider"></a><h4> <span class="mw-headline"> MVELProvider </span></h4>
<p>The <a href="http://mvel.codehaus.org/" class="external text" title="http://mvel.codehaus.org" rel="nofollow">MVEL</a> Provider allows rules to be defined as MVEL expressions.  These expressions are executed on the contents of the Smooks Javabean bean context.  That means they require Data to be bound (from the message being filtered) into Java objects in the Smooks bean context.  This allows you to define more complex (higher level) rules on message fragments, such as "is the product in the targeted order item fragment within the age eligibility constraints of the customer specified in the order header details".
</p><p><b>Note</b>: <i>Be sure to read the section on <a href="#Java_Binding" title="">Java Binding</a></i>.
</p><p>Configuration of an MVEL ruleBase would look like this:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span>  <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span>  <span style="color: #000066;">xmlns:rules</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/rules-1.0.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;rules:ruleBases<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;rules:ruleBase</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">src</span>=<span style="color: #ff0000;">"/org/milyn/validation/order/rules/order-rules.csv"</span> <span style="color: #000066;">provider</span>=<span style="color: #ff0000;">"org.milyn.rules.mvel.MVELProvider"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/rules:ruleBases<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>MVEL rules must be defined as Comma Separated Value (CSV) files.  The easiest way to edit these files is through a Spreadsheet Application (e.g. OpenOffice or Excel).  Each rule record contains 2 fields:
</p>
<ol><li> A Rule Name
</li><li> An MVEL Expression
</li></ol>
<p>Comment/header rows can be added by prefixing the first field with a hash ('#') character.
</p><p>An example of an MVEL rule CSV file as seen in OpenOffice is as follows:
</p><p><a href="http://smooks.org/mediawiki/index.php?title=Image:MVEL-csv-rulebase.png" class="image" title="Image:MVEL-csv-rulebase.png"><img alt="Image:MVEL-csv-rulebase.png" src="./User-Guide_files/MVEL-csv-rulebase.png" width="778" height="201" border="0"></a>
</p>
<a name="Rule_Based_Validation"></a><h2> <span class="mw-headline">Rule Based Validation</span></h2>
<p>The Smooks Validation Cartridge builds on the functionality provided by the <a href="#Rules" title="">Rules</a> Cartridge, to provide Rules based fragment validation.
</p><p>The type of validation provided by the components of the Smooks Validation Cartridge allows you to perform more detailed validation (over the likes of XSD/Relax) on message fragments.  As with everything in Smooks, the Validation functionality is supported across all supported data formats.  This means you can perform strong validation on not just XML data, but also on EDI, JSON, CSV etc.
</p><p>Validation configurations are defined by the <a href="http://www.milyn.org/xsd/smooks/validation-1.0.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/validation-1.0.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/validation-1.0.xsd</a> configuration namespace.
</p>
<a name="Validation_Configuration"></a><h3> <span class="mw-headline"> Validation Configuration </span></h3>
<p>Smooks supports a number of different Rule Provider types that can be used by the Validation Cartridge.  They provide different levels of validation.  These different forms of Validation are configured in exactly the same way.  The Smooks Validation Cartridge sees a Rule Provider as an abstract resource that it can target at message fragments in order to perform validation on the data in that message fragment.
</p><p>A Validation rule configuration is very simple.  You simply need to specify:
</p>
<ul><li> <b>executeOn</b>: The fragment on which the rule is to be executed.
</li><li> <b>excecuteOnNS</b>: The fragment namespace (NS) that that 'executeOn' belongs to.
</li><li> <b>name</b>: The name of the rule to be applied.  This is a <a href="#Composite_Rule_Name" title="">Composite Rule Name</a> that references a ruleBase and ruleName combination in a dot delimited format i.e. "ruleBaseName.ruleName".
</li><li> <b>onFail</b>: The severity of a failed match for the Validation rule. See <a href="#onFail" title="">onFail</a> section for details.
</li></ul>
<p><br>
An example of a Validation rule configuratio0n would be as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;validation:rule</span> <span style="color: #000066;">executeOn</span>=<span style="color: #ff0000;">"order/header/email"</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"regexAddressing.email"</span> <span style="color: #000066;">onFail</span>=<span style="color: #ff0000;">"ERROR"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre>
<a name="Configuring_Max_Failures"></a><h4> <span class="mw-headline"> Configuring Max Failures </span></h4>
<p>One can set a maximum number of validation failures per Smooks filter operation.  An exception will be thrown if this max value is exceeded.  Note that validations configured with <b>OnFail.FATAL</b> will always throw an exception and stop processing.
</p><p>To configure the maximum validation failures add this following to you Smooks configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"validation.maxFails"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>5<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="onFail"></a><h4> <span class="mw-headline"> onFail </span></h4>
<p>The onFail attribute in the validation configuration specified what action should be taken when a rule matches. This is all about reporting back valdiation failures.
</p><p>The following options are available:
</p>
<ul><li> <b>OK'</b>: Save the validation as an ok validation. Calling ValidationResults.getOks will return all validation warnings. This can be useful for content based routing.
</li><li> <b>WARN</b>: Save the validation as a warning. Calling ValidationResults.getWarnings will return all validation warnings.
</li><li> <b>ERROR</b>: Save the validation as an error. Calling ValidationResults.getErrors will return all validation errors.
</li><li> <b>FATAL</b>: Will throw a ValidationException as soon as a validation failure occurs. Calling ValidationResults.getFatal will return the fatal validation failure.
</li></ul>
<a name="Composite_Rule_Name"></a><h4> <span class="mw-headline"> Composite Rule Name </span></h4>
<p>When a RuleBase is references in Smooks you use a composite rule name in the following format:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ruleProviderName<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>.<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ruleName<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<dl><dd> '<b>ruleProviderName'</b> Identifies the rule provider and maps to the 'name' attribute in the 'ruleBase' element.
</dd><dd> '<b>ruleName'</b> Identifies a specific rule the rule provider knows about. This could be a rule defined in the 'src' file/resource.
</dd></dl>
<a name="Validation_Results"></a><h3> <span class="mw-headline"> Validation Results </span></h3>
<p>Validation results are captured by the Smooks.filterSource by specifying a ValidationResult instance in the filterSource method call.  When the filterSource method returns, the ValidationResult instance will contain all validation data.
</p><p>An example of executing Smooks in order to perform message fragment validation is as follows:
</p>
<pre class="java" style="font-family:monospace;">ValidationResult validationResult <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ValidationResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>messageInStream<span style="color: #009900;">)</span>, <span style="color: #000000; font-weight: bold;">new</span> StreamResult<span style="color: #009900;">(</span>messageOutStream<span style="color: #009900;">)</span>, validationResult<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>List<span style="color: #339933;">&lt;</span>OnFailResult<span style="color: #339933;">&gt;</span> errors <span style="color: #339933;">=</span> validationResult.<span style="color: #006633;">getErrors</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>List<span style="color: #339933;">&lt;</span>OnFailResult<span style="color: #339933;">&gt;</span> warnings <span style="color: #339933;">=</span> validationResult.<span style="color: #006633;">getWarnings</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>As you can see from the above code, individual warning, error etc validation results are made available from the ValidationResult object in the form of <b>OnFailResult</b> instances.  The OnFailResult object provides details about an individual failure.
</p>
<a name="Localized_Validation_Messages"></a><h3> <span class="mw-headline"> Localized Validation Messages </span></h3>
<p>The Validation Cartridge provides support for specifying localized messages relating to Validation failures.  These messages can be defined in standard Java ResourceBundle files (.properties format).  A convention is used here, based on the rule source name ("src").  The validation message bundle base name is derived from the rule source ("src") by dropping the rule source file extension and adding an extra folder named "i18n" e.g. for an MVEL ruleBase source of "/org/milyn/validation/order/rules/order-rules.csv", the corresponding validation message bundle base name would be "/org/milyn/validation/order/rules/i18n/order-rules".
</p><p>The validation cartridge supports application of <b>FreeMarker templates</b> on the localized messages, allowing the messages to contain contextual data from the bean context, as well as data about the actual
rule failure.  FreeMarker based messages must be prefixed with "ftl:" and the contextual data is references using the normal FreeMarker notation.  The beans from the bean context can be referenced directly, while the RuleEvalResult and rule failure path can be referenced through the "ruleResult" and "path" beans.
</p><p>Example message using RegexProvider rules:<br>
</p>
<pre class="text" style="font-family:monospace;">customerId=ftl:Invalid customer number '${ruleResult.text}' at '${path}'.  Customer number must match pattern '${ruleResult.pattern}'.</pre>
<a name="Example"></a><h3> <span class="mw-headline"> Example </span></h3>
<p><a href="http://smooks.org/mediawiki/index.php?title=V1.2:validation-basic" title="V1.2:validation-basic">See the Validation Example</a>.
</p>
<a name="Producing_Output_Data"></a><h1> <span class="mw-headline">Producing Output Data</span></h1>
<a name="Java_Binding"></a><h2> <span class="mw-headline">Java Binding</span></h2>
<p>The Smooks JavaBean Cartridge allows you to create and populate Java objects from your message data (i.e. bind data to).
</p>
<a name="Java_Binding_Overview"></a><h3> <span class="mw-headline">Java Binding Overview</span></h3>
<p>This feature of Smooks can be used in its own right purely as a Java binding framework for XML, EDI, CSV etc.  However, it is very important to remember that the Java Binding capabilities in Smooks are the cornerstone of many other capabilities provided by Smooks.  This is because Smooks makes the Java Objects it creates (and binds data into) available through the <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/javabean/context/BeanContext.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/javabean/context/BeanContext.html" rel="nofollow">BeanContext</a> class.  This is essentially a java bean context that is made available to any Smooks <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementation via the Smooks <a href="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/container/ExecutionContext.html" class="external text" title="http://www.milyn.org/javadoc/v1.4/smooks/org/milyn/container/ExecutionContext.html" rel="nofollow">ExecutionContext</a>.
</p><p>Some of the existing features that build on the functionality provided in the Javabean Cartridge include:
</p>
<ul><li> <a href="#Templating" title="">Templating</a>:  Templating typically involves applying a template (FreeMarker or other) to the objects in the BeanContext.
</li><li> <a href="#Validation" title="">Validation</a>:  Business Rules Validation (e.g. via MVEL) typically involves applying a rule (expression etc) to the objects in the BeanContext.
</li><li> <a href="#Message_Splitting_.26_Routing" title="">Message Splitting &amp; Routing</a>:  Message Splitting typically works by generating split messages from the Objects in the BeanContext, either by using the objects themselved and routing them, or by applying a template to them and routing the result of that templating operation (e.g. a new XML, CSV etc).
</li><li> <a href="#Persistence_.28Database_Reading_and_Writing_.29" title="">Persistence (Database Reading and Writing )</a>:  The Persistence features depend on the Java Binding functions for creating and populating the Java Objects (Entities etc) to be persisted.  Data read from a database is typically bound into the BeanContext.
</li><li> <a href="#Message_Enrichment" title="">Message Enrichment</a>: As stated above, enrichment data (e.g. read from a DB) is typically bound into the BeanContext, from where it is available to all other features, including the Java Binding functionality itself e.g. for expression based bindings.  This allows messages generated by Smooks to be enriched.
</li></ul>
<a name="When_to_use_Smooks_Java_Binding"></a><h3> <span class="mw-headline">When to use Smooks Java Binding</span></h3>
<p>A question that often comes to peoples minds is "<i>Why would I use Smooks (instead of JAXB/<a href="http://jibx.sourceforge.net/" class="external text" title="http://jibx.sourceforge.net/" rel="nofollow">JiBX</a> etc) to perform binding to a Java Objects model?</i>".  Well there are a number of reasons why you would use Smooks and there are a number of reasons why you would not use Smooks.
</p><p><i>When Smooks makes sense</i>:
</p>
<ol><li> Binding non-XML data to a Java Object model e.g. EDI, CSV, JSON etc
</li><li> Binding data (XML or other) whose data model (hierarchical structure) does not match that of the target Java Object model.  <a href="http://jibx.sourceforge.net/" class="external text" title="http://jibx.sourceforge.net/" rel="nofollow">JiBX</a> also supports this, but only for XML (AFAIK!!).
</li><li> When you are binding data from an XML data structure for which there is no defined schema (XSD).  Some frameworks effectively require a well defined XML data model via schema.
</li><li> When binding data from multiple existing and different data formats into a single pre-existing Java Object model.  Related to the above points.
</li><li> When binding data into existing 3rd Party Object Models that you cannot modify e.g. through a post-compile step.
</li><li> In situations where the Data (XML or other) and Java Object models may vary in isolation from each other.  Because of #2 above, Smooks can handle this by simply modifying the binding configuration.  Other frameworks often require binding/schema regeneration, redeployment etc (see #3 above).
</li><li> Where you need to execute additional logic in parallel to the binding process e.g. Validation, Split Message Generation (via Templates), Split Message Routing, Fragment Persistence, or any custom logic that you may wish to implement.  This is often a very powerful capability e.g. when processing huge message streams.
</li><li> Processing huge message streams by splitting them into a series of many small Object models and routing them to other systems for processing.
</li><li> When using other Smooks features that rely on the Smooks Java Binding capabilities.
</li></ol>
<p><i>When Smooks may not make sense</i>:
</p>
<ol><li> When you have a well defined data model (via schema/XSD) and all you need to do is bind data into an Object model (no validation, persistence etc required).
</li><li> When the object model is isolated from other systems and so can change without impacting such systems.
</li><li> Where processing XML and performance is paramount over all other considerations (where nanoseconds matter), frameworks such as <a href="http://jibx.sourceforge.net/" class="external text" title="http://jibx.sourceforge.net/" rel="nofollow">JiBX</a> are definitely worth considering over Smooks.  This is not to imply that the performance of Smooks Java Binding is poor in any way, but it does acknowledge the fact that frameworks that utilise post-compile optimizations targeted at a specific data format (e.g. XML) will always have the edge under the right conditions.
</li></ol>
<a name="Basics_Of_Java_Binding"></a><h3> <span class="mw-headline">Basics Of Java Binding</span></h3>
<p>As you know, Smooks supports a range of source data formats (XML, EDI, CSV, Java etc), but for the purposes of this topic, we will always refer to the message data in terms of an XML format.  In the examples, we will continuously refer to the following XML message:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;date<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Wed Nov 15 13:45:28 EST 2006<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/date<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customer</span> <span style="color: #000066;">number</span>=<span style="color: #ff0000;">"123123"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Joe<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>111<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>8.90<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>222<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>7<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>5.20<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>In some examples we will use different XML message data. Where this happens, the data is explicitly defined there then.
</p><p>The JavaBean Cartridge is used via the <a href="http://www.milyn.org/xsd/smooks/javabean-1.4.xsd" class="external text" title="http://www.milyn.org/xsd/smooks/javabean-1.4.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/javabean-1.4.xsd</a> configuration namespace. Install the schema in your IDE and avail of autocompletion.
</p><p>An example configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"example.model.Order"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"#document"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>This configuration simply creates an instance of the example.model.Order class and binds it into the <b>bean context</b> under the beanId "order". The instance is created at the very start of the message on the #document element (i.e. the start of the root &lt;order&gt; element).
</p>
<ul><li> <b>beanId</b>: The id of this bean. Please see <a href="#The_Bean_Context" title=""> The Bean Context</a> for more details.
</li><li> <b>class</b>: The fully qualified class name of the bean.
</li><li> <b>createOnElement</b>: attribute controls when the bean instance is created. Population of the bean properties is controlled through the binding configurations (child elements of the &lt;jb:bean&gt; element).
</li><li> <b>createOnElementNS</b>: The namespace of the createOnElement can be specified via the <b>createOnElementNS</b> attribute.
</li></ul>
<p>The Javabean cartridge has the following conditions for javabeans:
</p>
<ol><li> A public no-argument constructor
</li><li> Public property setter methods. The don't need to follow any specific name formats, but it would be better if they do follow the standard property setter method names.
</li><li> Setting javabean properties directly is not supported.
</li></ol>
<a name="Java_Binding_Configuration_Details"></a><h3> <span class="mw-headline">Java Binding Configuration Details</span></h3>
<p>The configuration shown above simply created the <i>example.model.Order</i> bean instance and bound it into the bean context. This section will describe how to bind data into that bean instance.
</p><p>The Javabean Cartridge provides support for 3 types of data bindings, which are added as child elements of the <b>&lt;jb:bean&gt;</b> element:
</p>
<ul><li> <b>&lt;jb:value&gt;</b>: This is used to bind data values from the Source message event stream into the target bean.
</li><li> <b>&lt;jb:wiring&gt;</b>: This is used to "wire" another bean instance from the bean context into a bean property on the target bean. This is the configuration that allows you to construct an object graph (Vs just a loose bag of Java object instances).  Beans can be wired in based on their "beanId", their Java class type, or by Annotation (by being annotated with a specific Annotation).
</li><li> <b>&lt;jb:expression&gt;</b>: As it's name suggests, this configuration is used to bind in a value calculated from an expression (in the <a href="http://mvel.codehaus.org/" class="external text" title="http://mvel.codehaus.org/" rel="nofollow">MVEL</a> language), a simple example being the binding of an order item total value into an OrderItem bean based on the result of an expression that calculates the value from the items price and quantity (e.g. "price * quantity"). The 'execOnElement' attribute he expression defines the element on which the expression is to be evaluated and the result bound. If not defined, the expression is executed based on the value of the parent &lt;jb:bean createOnElement&gt;. The value of the targeted element is available in the expression as a String variable under the name '_VALUE' (notice the underscore).
</li></ul>
<p>Taking the Order XML message (previous section), lets see what the full XML to Java binding configuration might be. We've seen the order XML (above). Now lets look at the Java Objects that we want to populate from that XML message (getters and setters not shown):
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Order <span style="color: #009900;">{</span><br>    <span style="color: #000000; font-weight: bold;">private</span> Header header<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> List<span style="color: #339933;">&lt;</span>OrderItem<span style="color: #339933;">&gt;</span> orderItems<span style="color: #339933;">;</span><br><span style="color: #009900;">}</span><br>&nbsp;<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Header <span style="color: #009900;">{</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adate+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Date</span></a> date<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Along+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Long</span></a> customerNumber<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> customerName<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">double</span> total<span style="color: #339933;">;</span><br><span style="color: #009900;">}</span><br>&nbsp;<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> OrderItem <span style="color: #009900;">{</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">long</span> productId<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Ainteger+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Integer</span></a> quantity<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">double</span> price<span style="color: #339933;">;</span><br><span style="color: #009900;">}</span></pre>
<p>The Smooks config required to bind the data from the order XML and into this object model is as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>(1)   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.Order"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>(1.a)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"header"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"header"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>(1.b)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>(2)   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"header"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.Header"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>(2.a)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"date"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Date"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/date"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"format"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>EEE MMM dd HH:mm:ss z yyyy<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>(2.b)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerNumber"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer/@number"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>(2.c)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerName"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>(2.d)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:expression</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"total"</span> <span style="color: #000066;">execOnElement</span>=<span style="color: #ff0000;">"order-item"</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span><br>              += (orderItem.price * orderItem.quantity);<br>          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:expression<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>(3)   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.ArrayList"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>(3.a)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">beanType</span>=<span style="color: #ff0000;">"com.acme.OrderItem"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span> <span style="color: #808080; font-style: italic;">&lt;!-- Could also wire using beanIdRef="orderItem" --&gt;</span><br>      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>(4)   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.OrderItem"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>(4.a)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"productId"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/product"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>(4.b)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/quantity"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>(4.c)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/price"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<table border="1" cellspacing="0" cellpadding="3" style="border: 1px solid; background-color: rgb(238, 238, 238)" width="100%">
<tbody><tr>
<td width="15%" align="center"> <i>(1)</i>
</td><td width="85%"> Configuration <b>(1)</b> defines the creation rules for the <i>com.acme.Order</i> bean instance (top level bean). We create this bean instance at the very start of the message i.e. on the &lt;order&gt; element . In fact, we create each of the beans instances (<b>(1)</b>, <b>(2)</b>, <b>(3)</b> - all accepts <b>(4)</b>) at the very start of the message (on the &lt;order&gt; element). We do this because there will only ever be a single instance of these beans in the populated model.
<p>Configurations <b>(1.a)</b> and <b>(1.b)</b> define the <b>wiring</b> configuration for wiring the <i>Header</i> and <i>List&lt;OrderItem&gt;</i> bean instances (<b>(2)</b> and <b>(3)</b>) into the Order bean instance (see the <b>beanIdRef</b> attribute values and how the reference the <b>beanId</b> values defined on <b>(2)</b> and <b>(3)</b>). The <b>property</b> attributes on <b>(1.a)</b> and <b>(1.b)</b> define the <i>Order</i> bean properties on which the wirings are to be made.  Note also that beans can also be wired into an object based on their Java class type (<b>beanType</b>), or by being annotated with a specific Annotation (<b>beanAnnotation</b>).
</p>
</td></tr>
<tr>
<td width="15%" align="center"> <i>(2)</i>
</td><td width="85%"> Configuration <b>(2)</b> creates the <i>com.acme.Header</i> bean instance.
<p>Configuration <b>(2.a)</b> defines a <b>value</b> binding onto the <i>Header.date</i> property. Note that the <b>data</b> attribute defines where the binding value is selected from the source message; in this case it is coming from the header/date element. Also note how it defines a <b>decodeParam</b> sub-element. This configures the DateDecoder.
</p><p>Configuration <b>(2.b)</b> defines a <b>value</b> binding configuration onto <i>Header.customerNumber</i> property. What should be noted here is how to configure the <b>data</b> attribute to select a binding value from an element attribute on the source message. Configuration <b>(2.b)</b> also defines an <b>expression</b> binding where the order total is calculated and set on the <i>Header.total</i> property. The <b>execOnElement</b> attribute tells Smooks that this expression needs to be evaluated (and bound/rebound) on the order-item element. So, if there are multiple &lt;order-item&gt; elements in the source message, this expression will be executed for each &lt;order-item&gt; and the new total value rebound into the <i>Header.total</i> property. Note how the expression adds the current orderItem total to the current order total (header.total).
</p><p>Configuration <b>(2.d)</b> defines an expression binding, where a running total is calculated by adding the total for each order item (quantity * price) to the current total.
</p>
</td></tr>
<tr>
<td width="15%" align="center"> <i>(3)</i>
</td><td width="85%"> Configuration <b>(3)</b> creates the <i>List&lt;OrderItem&gt;</i> bean instance for holding the <i>OrderItem</i> instances.
<p>Configuration <b>(3.a)</b> wires all beans of type com.acme.OrderItem ( i.e. <b>(4)</b>) into the list. Note how this wiring does not define a <b>property</b> attribute. This is because it wires into a Collection (same applies if wiring into an array).  Also note that we could have performed this wiring using the <b>beanIdRef</b> attribute instead of the <b>beanType</b> attribute.
</p>
</td></tr>
<tr>
<td width="15%" align="center"> <i>(4)</i>
</td><td width="85%"> Configuration <b>(4)</b> creates the <i>OrderItem</i> bean instances. Note how the <b>createOnElement</b> is set to the &lt;order-item&gt; element. This is because we want a new instance of this bean to be created for every &lt;order-item&gt; element (and wired into the <i>List&lt;OrderItem&gt;</i> <b>(3.a)</b>).
<p>If the <b>createOnElement</b> attribute for this configuration was not set to the &lt;order-item&gt; element (e.g. if it was set to one of the &lt;order&gt;, &lt;header&gt; or &lt;order-items&gt; elements), then only a single <i>OrderItem</i> bean instance would be created and the binding configurations (<b>(4.a)</b> etc) would overwrite the bean instance property bindings for every &lt;order-item&gt; element in the source message i.e. you would be left with a <i>List&lt;OrderItem&gt;</i> with just a single <i>OrderItem</i> instance containing the &lt;order-item&gt; data from the last &lt;order-item&gt; encountered in the source message.
</p>
</td></tr></tbody></table>
<p><b>Binding Tips</b>
</p>
<ul><li> <b>&lt;jb:bean createOnElement&gt;</b>
<ol><li> Set it to the root element (or "#document"): For bean instances where only a single instance will exist in the model.
</li><li> Set it to the recurring element: For Collection bean instances. If you don't specify the correct element in this case, you could loose data.
</li></ol>
</li><li> <b>&lt;jb:value decoder&gt;</b>
<ol><li> In most cases, Smooks will automatically detect the datatype decoder to be used for a &lt;jb:value&gt; binding.  However, some decoders require configuration e.g. the DateDecoder (decoder="Date").  In these cases, the decoder attribute should be defined on the binding, as well as the &lt;jb:decodeParam&gt; child elements for specifying the decode parameters for that decoder.  <a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/package-summary.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/package-summary.html" rel="nofollow">See the full list of DataDecoder available out of the box</a>.
</li></ol>
</li><li> <b>&lt;jb:wiring property&gt;</b>
<ol><li> Not required when binding into Collections.
</li></ol>
</li><li> <b>Collections</b>
<ol><li> Just define the &lt;jb:bean class&gt; to be the required Collection type and wire in the Collection entries.
</li><li> For arrays, just postfix the &lt;jb:bean class&gt; attribute value with square brackets e.g. <b>class="com.acme.OrderItem[]"</b>.
</li></ol>
</li></ul>
<a name="Data_Decoders.2FEncoders"></a><h4> <span class="mw-headline">Data Decoders/Encoders</span></h4>
<p>In most cases, Smooks will automatically detect the datatype decoder to be used for a given &lt;jb:value&gt; binding.  However, some decoders require configuration e.g. the DateDecoder (decoder="Date").  In these cases, the decoder attribute should be defined on the binding, as well as the &lt;jb:decodeParam&gt; child elements for specifying the decode parameters for that decoder.
</p><p><br>
DataDecoder implementations can also implement the DataEncoder interface (new in Smooks v1.4).  As it's name might suggest, a DataEncoder implements methods for encoding/formatting an object value to a String.  <a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/package-summary.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/package-summary.html" rel="nofollow">See the full list of DataDecoder/DataEncoder implementations available out of the box</a>.
</p><p><br>
</p>
<a name="Date_Decoding"></a><h5> <span class="mw-headline">Date Decoding</span></h5>
<p>A number of Date based DataDecoder/DataEncoder implementations are available:
</p><p><br>
</p>
<ul><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/DateDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/DateDecoder.html" rel="nofollow">Date</a></b>: Decode/Encode a String to a <i>java.util.Date</i> instance.
</li><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/CalendarDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/CalendarDecoder.html" rel="nofollow">Calendar</a></b>: Decode/Encode a String to a <i>java.util.Calendar</i> instance.
</li><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/SqlDateDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/SqlDateDecoder.html" rel="nofollow">SqlDate</a></b>: Decode/Encode a String to a <i>java.sql.Date</i> instance.
</li><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/SqlTimeDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/SqlTimeDecoder.html" rel="nofollow">SqlTime</a></b>: Decode/Encode a String to a <i>java.sql.Time</i> instance.
</li><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/SqlTimestampDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/SqlTimestampDecoder.html" rel="nofollow">SqlTimestamp</a></b>: Decode/Encode a String to a <i>java.sql.Timestamp</i> instance.
</li></ul>
<p><br>
All of these Date based Decoder/Encoder implementations are configured in the same way.
</p><p><br>
<b>Date</b> Example:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"date"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Date"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order/@date"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"format"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>EEE MMM dd HH:mm:ss z yyyy<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"locale"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>sv_SE<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
<b>SqlTimestamp</b> Example:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"date"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"SqlTimestamp"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order/@date"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"format"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>EEE MMM dd HH:mm:ss z yyyy<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"locale"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>sv<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
The <i>format</i> decodeParam is based on the <a href="http://www.w3.org/TR/NOTE-datetime" class="external text" title="http://www.w3.org/TR/NOTE-datetime" rel="nofollow">ISO 8601</a> standard for Date formatting.  See <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/text/SimpleDateFormat.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/java/text/SimpleDateFormat.html" rel="nofollow">SimpleDateFormat</a> Javadoc and <a href="http://en.wikipedia.org/wiki/ISO_8601" class="external text" title="http://en.wikipedia.org/wiki/ISO_8601" rel="nofollow">Wikipedia</a> for more information.
</p><p><br>
The <i>locale</i> decodeParam value is an underscore separated string, with the first token being the <a href="http://www.loc.gov/standards/iso639-2/php/English_list.php" class="external text" title="http://www.loc.gov/standards/iso639-2/php/English_list.php" rel="nofollow">ISO Language Code</a> for the Locale and the second token being the <a href="http://www.iso.ch/iso/en/prods-services/iso3166ma/02iso-3166-code-lists/list-en1.html" class="external text" title="http://www.iso.ch/iso/en/prods-services/iso3166ma/02iso-3166-code-lists/list-en1.html" rel="nofollow">ISO Country Code</a>.  This decodeParam can also be specified as 2 separate parameters for language and country e.g.:
</p><p><br>
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"date"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Date"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order/@date"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"format"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>EEE MMM dd HH:mm:ss z yyyy<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"locale-language"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>sv<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"locale-country"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>SE<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
</p>
<a name="Number_Decoding"></a><h5> <span class="mw-headline">Number Decoding</span></h5>
<p>A number of Number based DataDecoder/DataEncoder implementations are available:
</p><p><br>
</p>
<ul><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/BigDecimalDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/BigDecimalDecoder.html" rel="nofollow">BigDecimalDecoder</a></b>: Decode/Encode a String to a <i>java.math. BigDecimal</i> instance.
</li><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/BigIntegerDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/BigIntegerDecoder.html" rel="nofollow">BigIntegerDecoder</a></b>: Decode/Encode a String to a <i>java.math. BigInteger</i> instance.
</li><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/DoubleDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/DoubleDecoder.html" rel="nofollow">DoubleDecoder</a></b>: Decode/Encode a String to a <i>java.lang.Double</i> instance (including primitive).
</li><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/FloatDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/FloatDecoder.html" rel="nofollow">FloatDecoder</a></b>: Decode/Encode a String to a <i>java.lang.Float</i> instance (including primitive).
</li><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/IntegerDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/IntegerDecoder.html" rel="nofollow">IntegerDecoder</a></b>: Decode/Encode a String to a <i>java.lang.Integer</i> instance (including primitive).
</li><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/LongDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/LongDecoder.html" rel="nofollow">LongDecoder</a></b>: Decode/Encode a String to a <i>java.lang.Long' instance (including primitive).</i>
</li><li> <b><a href="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/ShortDecoder.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/commons/org/milyn/javabean/decoders/ShortDecoder.html" rel="nofollow">ShortDecoder</a></b>: Decode/Encode a String to a <i>java.lang.Short</i> instance (including primitive).
</li></ul>
<p><br>
All of these Number based Decoder/Encoder implementations are configured in the same way.
</p><p><br>
<b>BigDecimal</b> Example:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"BigDecimal"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"orderItem/price"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"format"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>#,###.##<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"locale"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>en_IE<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
<b>Integer</b> Example:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"percentage"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"vote/percentage"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"format"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>#%<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
The <i>format</i> decodeParam is based on the <a href="http://java.sun.com/docs/books/tutorial/i18n/format/decimalFormat.html" class="external text" title="http://java.sun.com/docs/books/tutorial/i18n/format/decimalFormat.html" rel="nofollow">NumberFormat</a> pattern syntax.
</p><p><br>
The <i>locale</i> decodeParam value is an underscore separated string, with the first token being the <a href="http://www.loc.gov/standards/iso639-2/php/English_list.php" class="external text" title="http://www.loc.gov/standards/iso639-2/php/English_list.php" rel="nofollow">ISO Language Code</a> for the Locale and the second token being the <a href="http://www.iso.ch/iso/en/prods-services/iso3166ma/02iso-3166-code-lists/list-en1.html" class="external text" title="http://www.iso.ch/iso/en/prods-services/iso3166ma/02iso-3166-code-lists/list-en1.html" rel="nofollow">ISO Country Code</a>.  This decodeParam can also be specified as 2 separate parameters for language and country e.g.:
</p><p><br>
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Double"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"orderItem/price"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"format"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>#,###.##<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"locale-language"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>sv<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"locale-country"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>SE<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Mapping_Decoding"></a><h5> <span class="mw-headline">Mapping Decoding</span></h5>
<p>Sometimes you want to bind a different value into your object model, based on the data in your input message.  You could use an expression based binding to do this, but you could also use a Mapping Decoder as follows:
</p><p><br>
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"name"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Mapping"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"history/@warehouse"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Dublin<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"2"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Belfast<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"3"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Cork<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
In the above example, an input data value of "1" is mapped onto the "name" property as a value of "Dublin".  Likewise for values "2" and "3".
</p>
<a name="Enum_Decoding"></a><h5> <span class="mw-headline">Enum Decoding</span></h5>
<p>The Enum Decoder is a specialized version of the <a href="#Mapping_Decoding" title="">Mapping Decoder</a>.  Decoding of enumerations will typically happen automatically (without any specific configuration) if the data input values map exactly to the enum values/names.  However when this is not the case, you need to define mappings from the input data value to the enum value/name.
</p><p><br>
In the following example, the <b>header/priority</b> field in the input message contains values of "LOW", "MEDIUM" and "HIGH".  This need to be mapped the <i>LineOrderPriority</i> enum values of "NOT_IMPORTANT", "IMPORTANT" and "VERY_IMPORTANT" respectfully:
</p><p><br>
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"priority"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/priority"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Enum"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"enumType"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>example.trgmodel.LineOrderPriority<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"LOW"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>NOT_IMPORTANT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"MEDIUM"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>IMPORTANT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"HIGH"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>VERY_IMPORTANT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
Note that if mappings are required, you must also explicitly specify the enumeration type using the <b>enumType</b> decodeParam.
</p>
<a name="Bean_Retention"></a><h4> <span class="mw-headline">Bean Retention</span></h4>
<p>By default, all but the first bean configured in the Smooks configuration are removed from the BeanContext after the fragment that created the bean (createOnElement) is processed i.e. the bean is added to the BeanContext on the start/visitBefore of the createOnElement fragment, and is removed from the BeanContext at the end/visitAfter.  By default, this rule applies to all but the first bean configured in the Smooks configuration i.e. <b>by default, the first bean is the only bean that is retained</b> in the BeanContext, and so can be accessed after the message has been processed.
</p><p><br>
To change this default behavior, use the <b>retain</b> configuration attribute on the &lt;jb:bean&gt; element.  This attribute allows you to manually control bean retention within the Smooks BeanContext.
</p>
<a name="Preprocessing_Binding_Values"></a><h4> <span class="mw-headline">Preprocessing Binding Values</span></h4>
<p>The Java Bean cartridge works by:
</p><p><br>
</p>
<ol><li> Extracting String values from the source/input message stream.
</li><li> Decoding the String value based on the "decoder" and "decodeParam" configurations (note that, if not defined, an attempt is made to reflectively resolve the decoder).
</li><li> The decoded value is set on the target bean.
</li></ol>
<p><br>
Sometimes it is necessary to perform some rudimentary "preprocessing" on the String data value before the decode step (between steps #1 and #2 above).  An example of this might be where the source data has some characters not supported by the <b>locale</b> configuration on <a href="#Number_Decoding" title="">Numeric Decoding</a> e.g. the numeric value 876592.00 might be represented as "876_592!00" (who knows why).  In order to decode this value as (for example) a double value, we need to eliminate the underscore and exclamation mark characters, replacing the exclamation mark with a period i.e. we need to convert it to "876592.00" before decoding.
</p><p><br>
One way of doing this is to write a custom <b>DataDecoder</b> implementation (which is recommended if it's a recurring decoding operation), but if you need a quick-n-dirty solution, you can specify a "valuePreprocess" &lt;decodeParam&gt;, which is a simple expression to be applied to the Sting value before decoding.
</p><p><br>
As an example for solving the numeric decoding issue described above:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">&lt;!-- A bean property binding example: --&gt;</span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.milyn.javabean.OrderItem"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"price"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Double"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"valuePreprocess"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>value.replace("_", "").replace("!", ".")<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>&nbsp;<br><span style="color: #808080; font-style: italic;">&lt;!-- A direct value binding example: --&gt;</span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"BigDecimal"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"valuePreprocess"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>value.replace("_", "").replace("!", ".")<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
Note in the above example how the String data value is referenced in the expression using the <i>value</i> variable name.  The expression can be any valid <a href="http://mvel.codehaus.org/" class="external text" title="http://mvel.codehaus.org" rel="nofollow">MVEL</a> expression that operates on the <i>value</i> String and returns a String.
</p>
<a name="Creating_Beans_Using_a_Factory"></a><h4> <span class="mw-headline">Creating Beans Using a Factory</span></h4>
<p>The Java Bean cartridge supports factories for creating the beans. In that case you don’t need a public parameterless constructor. You don’t even have to define the actual class name in the class attribute. Any of the interfaces of the object suffices. However only the methods of that interface are available for binding to. So even if you define a factory, you must always set the class attribute in the bean definition.
</p><p>The factory definition is set in the <b>factory</b> attribute of the bean element. The default factory definition language looks like this:
</p><p>The default factory definition language looks like this:
</p>
<pre class="text" style="font-family:monospace;">some.package.FactoryClass#staticMethod{.instanceMethod}</pre>
<p>This basic definition language enables you to define a static public parameterless method that Smooks should call to create the bean. The '<i>instanceMethod</i> part is optional. If it is set it defines the method that will be called on the object that is returned from static method, which should create the bean (The { } chars only illustrates the part that is optional and should be left out of the actual definition!).
</p><p>Here is an example where we instantiate an ArrayList object using a static factory method:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span></span><br><span style="color: #009900;">   <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orders"</span></span><br><span style="color: #009900;">   <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.List"</span></span><br><span style="color: #009900;">   <span style="color: #000066;">factory</span>=<span style="color: #ff0000;">"some.package.ListFactory#newList"</span></span><br><span style="color: #009900;">   <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"orders"</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>     <span style="color: #808080; font-style: italic;">&lt;!-- ... bindings --&gt;</span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The factory definition "some.package.ListFactory#newList" defines that the newList method must be called on the "some.package.ListFactory" class for creating the bean. The class attributes defines that the bean is a List object. What kind of List object (ArrayList, LinkedList) is up to the ListFactory to decide. Here is another example:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span></span><br><span style="color: #009900;">   <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orders"</span></span><br><span style="color: #009900;">   <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.List"</span></span><br><span style="color: #009900;">   <span style="color: #000066;">factory</span>=<span style="color: #ff0000;">"some.package.ListFactory#getInstance.newList"</span></span><br><span style="color: #009900;">   <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"orders"</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>     <span style="color: #808080; font-style: italic;">&lt;!-- ... bindings --&gt;</span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Here we defined that an instance of the ListFactory needs to be retrieved using the static method getInstance and that then the newList method needs to be called on the ListFactory object to create the List object. This construct makes it possible to easily use Singleton Factories.
</p>
<a name="Other_Definition_Languages"></a><h5> <span class="mw-headline">Other Definition Languages</span></h5>
<p>You can use a different definition language then the default basic language. For instance you can use MVEL as the factory definition language.
</p><p>There are three methods to declare which definition language you want to use:
</p>
<ol><li> Each definition language can have an alias. For instance MVEL has the alias 'mvel'. To define that you want to use MVEL for a specific factory definition you put 'mvel:' in front of the definition. e.g. 'mvel:some.package.ListFactory.getInstance().newList()'. The alias of the default basic language is 'basic'.
</li><li> To set a language as a global default you need to set the ‘factory.definition.parser.class’ global parameter to the full class path of the class that implements the FactoryDefinitionParser interface for the language that you want to use.<br><b>Note:</b>If you have a definition with your default language that includes a ':' then you must prefix that definition with 'default:' else you will run into an Exception.
</li><li> Instead of using an alias you can also set the full class path of the class that implements the FactoryDefinitionParser interface for the language that you want to use. e.g. 'org.milyn.javabean.factory.MVELFactoryDefinitionParser:some.package.ListFactory.getInstance().newList()'. You probably only should use this for test purposes only. It is much better to define an alias for your language.
</li></ol>
<p>If you want to define your own language then you need to implement the 'org.milyn.javabean.factory.FactoryDefinitionParser' interface. Take a look at the 'org.milyn.javabean.factory.MVELFactoryDefinitionParser' or 'org.milyn.javabean.factory.BasicFactoryDefinitionParser' for a good example.
</p><p>To define the alias for a definition language you need to add the 'org.milyn.javabean.factory.Alias' annotation with the alias name to your FactoryDefinitionParser class.
</p><p>For Smooks to find your alias you need create the file 'META-INF/smooks-javabean-factory-definition-parsers.inf' on the root of your classpath. This file must contain the full class path of all the files that implement the FactoryDefinitionParser interface having the Alias annotation (separated by new lines).
</p>
<a name="MVEL_as_factory_definition_language"></a><h6> <span class="mw-headline">MVEL as factory definition language</span></h6>
<p>MVEL has some advantages over the basic default definition language, for example you can use objects from the bean context as the factory object or you can call factory methods with parameters. These parameters can be defined within the definition or they can be objects from the bean context. To be able to use MVEL use the alias 'mvel' or you can set the ‘factory.definition.parser.class’ global parameter to ‘org.milyn.javabean.factory.MVELFactoryDefinitionParser’.
</p><p>Here is an example with the same use case as before but then with MVEL:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span></span><br><span style="color: #009900;">   <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">   <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span></span><br><span style="color: #009900;">        <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orders"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.List"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">factory</span>=<span style="color: #ff0000;">"mvel:some.package.ListFactory.getInstance().newList()"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"orders"</span></span><br><span style="color: #009900;">    <span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #808080; font-style: italic;">&lt;!-- ... bindings --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
In the next example we use MVEL to extract a List object from an existing bean in the bean context. The Order object in this example has method
that returns a list which we must use to add the order lines to:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span></span><br><span style="color: #009900;">   <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">   <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span></span><br><span style="color: #009900;">        <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"some.package.Order"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span></span><br><span style="color: #009900;">    <span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #808080; font-style: italic;">&lt;!-- ... bindings --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- </span><br><span style="color: #808080; font-style: italic;">           The factory attribute uses MVEL to access the order </span><br><span style="color: #808080; font-style: italic;">           object in the bean context and calls its getOrderLines() </span><br><span style="color: #808080; font-style: italic;">           method to get the List. This list is then added to the bean </span><br><span style="color: #808080; font-style: italic;">           context under the beanId 'orderLines' </span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span></span><br><span style="color: #009900;">        <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderLines"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.List"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">factory</span>=<span style="color: #ff0000;">"mvel:order.getOrderLines()"</span> </span><br><span style="color: #009900;">        <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span></span><br><span style="color: #009900;">    <span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderLine"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span></span><br><span style="color: #009900;">        <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderLine"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.List"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order-line"</span></span><br><span style="color: #009900;">    <span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #808080; font-style: italic;">&lt;!-- ... bindings --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Maybe you wonder why we don’t use MVEL as the default factory definition language? Currently the performance of the basic definition language and MVEL are about equal. The reason that the basic definition language isn’t faster is because it currently uses reflection to call the factory methods. However there are plans to use byte code generation instead of reflection. This should improve the performance dramatically. If MVEL where the default language then we couldn’t do anything to improve the performance for those people who don’t need any thing more then the basic features that the basic definition language offers.
</p>
<a name="Restrictions"></a><h5> <span class="mw-headline">Restrictions</span></h5>
<p>Array objects are not supported. If a factory return an array then Smooks will throw an exception at some point.
</p>
<a name="Binding_Key_Value_Pairs_into_Maps"></a><h4> <span class="mw-headline">Binding Key Value Pairs into Maps</span></h4>
<p>If the &lt;jb:value property&gt; attribute of a binding is not defined (or is empty), then the name of the selected node will be used as the map entry key (where the beanClass is a Map).
</p><p>There is one other way to define the map key. The value of the &lt;jb:value property&gt; attribute can start with the <b>@</b> character. The rest of the value then defines the attribute name of the selected node, from which the map key is selected. The following example demonstrates this:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;root<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"key1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>value1<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"key2"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>value2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"key3"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>value3<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/root<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>An the config:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"keyValuePairs"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.HashMap"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"root"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"@name"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"root/property"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>This would create a HashMap with three entries with the keys set [<b>key1</b>, <b>key2</b>, <b>key3</b>].
</p><p>Of course the @ character notation doesn't work for bean wiring. The cartridge will simply use the value of the <b>property</b> attribute, including the @ character, as the map entry key.
</p>
<a name="Virtual_Object_Models_.28Maps_.26_Lists.29"></a><h4> <span class="mw-headline">Virtual Object Models (Maps &amp; Lists)</span></h4>
<p>It is possible to create a complete object model without writing your own Bean classes. This virtual model is created using only maps and lists . This is very convenient if you use the javabean cartridge between two processing steps. For example, as part of a model driven transform e.g. xml-&gt;java-&gt;xml or xml-&gt;java-&gt;edi.
</p><p>The following example demonstrates the principle:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> </span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:ftl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Bind data from the message into a Virtual Object model in the bean context....</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span>    <br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.HashMap"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"header"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"header"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>    <br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"header"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.HashMap"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"date"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Date"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/date"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"format"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>EEE MMM dd HH:mm:ss z yyyy<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerNumber"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer/@number"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerName"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:expression</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"total"</span> <span style="color: #000066;">execOnElement</span>=<span style="color: #ff0000;">"order-item"</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            header.total + (orderItem.price * orderItem.quantity);<br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:expression<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>    <br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.ArrayList"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>    <br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.HashMap"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"productId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/product"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/quantity"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Double"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/price"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Use a FreeMarker template to perform the model driven transformation on the Virtual Object Model...</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>/templates/orderA-to-orderB.ftl<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Note above how we always define the <b>decoder</b> attribute for a Virtual Model (Map).  This is because Smooks has no way of auto-detecting the decode type for data binding to a Map.  So, if you need typed values bound into your Virtual Model, you need to specify an appropriate decoder.  If the decoder is not specified in this case, Smooks will simply bind the data into the Virtual Model as a String.
</p><p>Take a look at the <a href="http://smooks.org/mediawiki/index.php?title=Smooks_v1.2_Examples" title="Smooks v1.2 Examples">model-driven-basic and model-driven-basic-virtual examples</a>.
</p>
<a name="Wildcard_Bindings"></a><h5> <span class="mw-headline">Wildcard Bindings</span></h5>
<p>Virtual models also support "wildcard" &lt;jb:value&gt; bindings.  That is, you can bind all the child elements of an element into a Map using a single configuration, where the child element names act as the Map entry key and the child element text value acts as the Map entry value.  To do this, you simply omit the <i>property</i> attribute from the the &lt;jb:value&gt; configuration and use a wildcard in the <i>data</i> attribute.
</p><p>In the following example, we have a &lt;order-item&gt; element containing some values that we wish to populate into a Map.
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>111<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>8.90<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The wildcard binding config for doing this would be:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.HashMap"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order-items/orderItem"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-items/orderItem/*"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>This will result in the creation of an "orderItem" Map bean instance containing entries [product=111], [quantity=2] and [price=8.90].
</p>
<a name="Merging_Multiple_Data_Entities_Into_a_Single_Binding"></a><h4> <span class="mw-headline">Merging Multiple Data Entities Into a Single Binding</span></h4>
<p>This can be achieved using Expression Based Bindings (&lt;jb:expression&gt;).
</p>
<a name="Direct_Value_Binding"></a><h4> <span class="mw-headline">Direct Value Binding</span></h4>
<p>As of Smooks 1.3 the Javabean Cartridge has an new feature called direct value binding. Direct value binding uses the Smooks DataDecoder to create an Object from a selected data element/attribute and add it directly to the bean context.
</p><p>The <b>ValueBinder</b> class is the visitor that does the value binding.
</p>
<a name="Configuration"></a><h5> <span class="mw-headline">Configuration</span></h5>
<p>The value binding XML configuration is part of the JavaBean schema from Smooks 1.3 on: &lt;a href="<a href="http://www.milyn.org/xsd/smooks/javabean-1.4.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/javabean-1.4.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/javabean-1.4.xsd</a>"&gt;<a href="http://www.milyn.org/xsd/smooks/javabean--1.3.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/javabean--1.3.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/javabean--1.3.xsd</a>&lt;/a&gt;
The element for the value binding is <b>&lt;value&gt;</b>.
</p><p>The  <b>&lt;value&gt;</b> has the following attributes:
</p>
<ul><li><b>beanId</b>: The ID under which the created object is to be bound in the bean context.
</li><li><b>data</b>:  The data selector for the data value to be bound. e.g. "order/orderid" or "order/header/@date"
</li><li><b>dataNS</b>: The namespace for the "data" selector
</li><li><b>decoder</b>: The DataDecoder name for converting the value from a String into a different type. The DataDecoder can be configured with the &lt;decodeParam&gt; elements.
</li><li><b>default</b>&nbsp;: The default value for if the selected data is null or an empty string.
</li></ul>
<a name="Example_2"></a><h5> <span class="mw-headline">Example</span></h5>
<p>Taking the "classic" Order message as an example and getting the order number, name and date as Value Objects in the form of an Integer and String.
</p>
<a name="The_Message"></a><h6> <span class="mw-headline">The Message</span></h6>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://x"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;y:date</span> <span style="color: #000066;">xmlns:y</span>=<span style="color: #ff0000;">"http://y"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Wed Nov 15 13:45:28 EST 2006<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/y:date<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customer</span> <span style="color: #000066;">number</span>=<span style="color: #ff0000;">"123123"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Joe<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;privatePerson<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;/privatePerson<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>         <span style="color: #808080; font-style: italic;">&lt;!-- .... --&gt;</span><br>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="The_Configuration"></a><h6> <span class="mw-headline">The Configuration</span></h6>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span></span><br><span style="color: #009900;">       <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"customerName"</span></span><br><span style="color: #009900;">       <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"customer"</span></span><br><span style="color: #009900;">       <span style="color: #000066;">default</span>=<span style="color: #ff0000;">"unknown"</span></span><br><span style="color: #009900;">    <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span></span><br><span style="color: #009900;">       <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"customerNumber"</span></span><br><span style="color: #009900;">       <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"customer/@number"</span></span><br><span style="color: #009900;">       <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span></span><br><span style="color: #009900;">    <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span></span><br><span style="color: #009900;">       <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderDate"</span></span><br><span style="color: #009900;">       <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"date"</span></span><br><span style="color: #009900;">       <span style="color: #000066;">dateNS</span>=<span style="color: #ff0000;">"http://y"</span></span><br><span style="color: #009900;">       <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Date"</span></span><br><span style="color: #009900;">    <span style="color: #000000; font-weight: bold;">&gt;</span></span><br>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"format"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>EEE MMM dd HH:mm:ss z yyyy<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"locale-language"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>en<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:decodeParam</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"locale-country"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>IE<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:decodeParam<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Programmatic_Configuration_6"></a><h5> <span class="mw-headline">Programmatic Configuration</span></h5>
<p>The value binder can be programmatic configured using the <b>org.milyn.javabean.Value</b> Object.
</p>
<a name="Example_3"></a><h6> <span class="mw-headline">Example</span></h6>
<p>We use the same example message as the xml configuration example.
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//Create Smooks. normally done globally!</span><br>Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">//Create the Value visitors</span><br>Value customerNumberValue <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Value<span style="color: #009900;">(</span> <span style="color: #0000ff;">"customerNumber"</span>, <span style="color: #0000ff;">"customer/@number"</span><span style="color: #009900;">)</span>.<span style="color: #006633;">setDecoder</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"Integer"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>Value customerNameValue <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Value<span style="color: #009900;">(</span> <span style="color: #0000ff;">"customerName"</span>, <span style="color: #0000ff;">"customer"</span><span style="color: #009900;">)</span>.<span style="color: #006633;">setDefault</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"Unknown"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">//Add the Value visitors</span><br>smooks.<span style="color: #006633;">addVisitors</span><span style="color: #009900;">(</span>customerNumberValue<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>smooks.<span style="color: #006633;">addVisitors</span><span style="color: #009900;">(</span>customerNameValue<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">//And the execution code: </span><br>JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>orderMessageStream<span style="color: #009900;">)</span>, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Ainteger+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Integer</span></a> customerNumber <span style="color: #339933;">=</span> <span style="color: #009900;">(</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Ainteger+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Integer</span></a><span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"customerNumber"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> customerName <span style="color: #339933;">=</span> <span style="color: #009900;">(</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a><span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"customerName"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<a name="Programmatic_Configuration_7"></a><h3> <span class="mw-headline">Programmatic Configuration</span></h3>
<p>Java Binding Configuratons can be programmatically added to a Smooks using the <a href="http://www.milyn.org/javadoc/v1.3/smooks-cartridges/javabean/org/milyn/javabean/Bean.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks-cartridges/javabean/org/milyn/javabean/Bean.html" rel="nofollow">Bean</a> configuration class.
</p><p>This class can be used to programmatically configure a Smooks instance for performing a Java Bindings on a specific class. To populate a graph, you simply create a graph of Bean instances by binding Beans onto Beans.  The Bean class uses a Fluent API (all methods return the Bean instance), making it easy to string configurations together to build up a graph of Bean configuration.
</p>
<a name="Example_4"></a><h4> <span class="mw-headline">Example</span></h4>
<p>Taking the "classic" Order message as an example and binding it into a corresponding Java Object model.
</p><p><b>The Message</b>:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://x"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;y:date</span> <span style="color: #000066;">xmlns:y</span>=<span style="color: #ff0000;">"http://y"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Wed Nov 15 13:45:28 EST 2006<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/y:date<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customer</span> <span style="color: #000066;">number</span>=<span style="color: #ff0000;">"123123"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Joe<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;privatePerson<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;/privatePerson<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/header<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>111<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>8.90<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>222<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>7<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>5.20<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><b>The Java Model</b> (not including getters/setters):
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Order <span style="color: #009900;">{</span><br>    <span style="color: #000000; font-weight: bold;">private</span> Header header<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> List<span style="color: #339933;">&lt;</span>OrderItem<span style="color: #339933;">&gt;</span> orderItems<span style="color: #339933;">;</span><br><span style="color: #009900;">}</span><br>&nbsp;<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Header <span style="color: #009900;">{</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Along+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Long</span></a> customerNumber<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> customerName<span style="color: #339933;">;</span><br><span style="color: #009900;">}</span><br>&nbsp;<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> OrderItem <span style="color: #009900;">{</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">long</span> productId<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Ainteger+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Integer</span></a> quantity<span style="color: #339933;">;</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">double</span> price<span style="color: #339933;">;</span><br><span style="color: #009900;">}</span></pre>
<p><b>The Configuration Code</b>:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>Bean orderBean <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Bean<span style="color: #009900;">(</span>Order.<span style="color: #000000; font-weight: bold;">class</span>, <span style="color: #0000ff;">"order"</span>, <span style="color: #0000ff;">"/order"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>orderBean.<span style="color: #006633;">bindTo</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"header"</span>,<br>    orderBean.<span style="color: #006633;">newBean</span><span style="color: #009900;">(</span>Header.<span style="color: #000000; font-weight: bold;">class</span>, <span style="color: #0000ff;">"/order"</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">bindTo</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"customerNumber"</span>, <span style="color: #0000ff;">"header/customer/@number"</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">bindTo</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"customerName"</span>, <span style="color: #0000ff;">"header/customer"</span><span style="color: #009900;">)</span><br>    <span style="color: #009900;">)</span>.<span style="color: #006633;">bindTo</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"orderItems"</span>,<br>    orderBean.<span style="color: #006633;">newBean</span><span style="color: #009900;">(</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aarraylist+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">ArrayList</span></a>.<span style="color: #000000; font-weight: bold;">class</span>, <span style="color: #0000ff;">"/order"</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">bindTo</span><span style="color: #009900;">(</span>orderBean.<span style="color: #006633;">newBean</span><span style="color: #009900;">(</span>OrderItem.<span style="color: #000000; font-weight: bold;">class</span>, <span style="color: #0000ff;">"order-item"</span><span style="color: #009900;">)</span><br>            .<span style="color: #006633;">bindTo</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"productId"</span>, <span style="color: #0000ff;">"order-item/product"</span><span style="color: #009900;">)</span><br>            .<span style="color: #006633;">bindTo</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"quantity"</span>, <span style="color: #0000ff;">"order-item/quantity"</span><span style="color: #009900;">)</span><br>            .<span style="color: #006633;">bindTo</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"price"</span>, <span style="color: #0000ff;">"order-item/price"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br>    <span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">addVisitors</span><span style="color: #009900;">(</span>orderBean<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><b>The Execution Code</b>:
</p>
<pre class="java" style="font-family:monospace;">JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>orderMessageStream<span style="color: #009900;">)</span>, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>Order order <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>Order<span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"order"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>The API supports factories. You can provide a factory object of the type org.milyn.javabean.factory.Factory, that will be called when a new bean instance needs to be created.
</p><p>Here is an example where an anonymous Factory class is defined and used:
</p>
<pre class="java" style="font-family:monospace;">Bean orderBean <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Bean<span style="color: #009900;">(</span>Order.<span style="color: #000000; font-weight: bold;">class</span>, <span style="color: #0000ff;">"order"</span>, <span style="color: #0000ff;">"/order"</span>, <span style="color: #000000; font-weight: bold;">new</span> Factory<span style="color: #339933;">&lt;</span>Order<span style="color: #339933;">&gt;</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>&nbsp;<br>	<span style="color: #000000; font-weight: bold;">public</span> Order create<span style="color: #009900;">(</span>ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>		<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">new</span> Order<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>	<span style="color: #009900;">}</span><br>&nbsp;<br><span style="color: #009900;">}</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<a name="XML_to_Java_Reading_and_Writing"></a><h3> <span class="mw-headline">XML to Java Reading and Writing</span></h3>
<p>The XMLBinding class is a special utility wrapper class around the Smooks runtime. It was introduced in Smooks v1.5 and it is designed specifically for reading and writing XML data to and from Java Object models using nothing more than standard &lt;jb:bean&gt; configurations i.e. no need to write a template for serializing the Java Objects to an output character based format, as with Smooks v1.4 and before.
</p><p><br>
So basically, this functionality allows you to do what you can do with frameworks like JAXB or JiBX i.e. read <i><b>and write</b></i> between Java and XML using a single configuration, but with the added advantage of being able to easily handle multiple versions of an XML schema/model in a single Java model.  You can read and write multiple versions of an XML message into a single/common Java object model.  This is very useful in itself, but also means you can easily transform messages from one version to another by reading the XML into the common Java Object model using an XMLBinding instance configured for one version of the XML, and then writing those Java Objects back out using an XMLBinding instance configured for the other version of the XML.
</p><p><br>
</p>
<a name="Simple_XMLBinding_Use_Case"></a><h4> <span class="mw-headline">Simple XMLBinding Use Case</span></h4>
<p>Using the XMLBinding class is really easy.  You:
</p>
<ol><li> write a standard <a href="#Java_Binding_Configuration_Details" title="">Smooks Java Binding Configuration</a>,
</li><li> <b>add</b> it to the XMLBinding instance,
</li><li> <b>initialize</b> the XMLBinding instance,
</li><li> call the <b>fromXML</b> and <b>toXML</b> methods on the XMLBinding instance.
</li></ol>
<p><br>
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Create and initilize the XMLBinding instance...</span><br>XMLBinding xmlBinding <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> XMLBinding<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">add</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"/smooks-configs/order-xml-binding.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>xmlBinding.<span style="color: #006633;">intiailize</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Read the order XML into the Order Object model...</span><br>Order order <span style="color: #339933;">=</span> xmlBinding.<span style="color: #006633;">fromXML</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>inputReader<span style="color: #009900;">)</span>, Order.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Do something with the order....</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Write the Order object model instance back out to XML...</span><br>xmlBinding.<span style="color: #006633;">toXML</span><span style="color: #009900;">(</span>order, outputWriter<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><br>
See the <a href="http://smooks.org/mediawiki/index.php?title=V1.5:xml-read-write" title="V1.5:xml-read-write">xml-read-write</a> example.
</p><p><br>
</p>
<a name="Transforming_XML_Messages_Using_XMLBinding"></a><h4> <span class="mw-headline">Transforming XML Messages Using XMLBinding</span></h4>
<p>As stated above, one of the more powerful capabilities of the XMLBinding class is its ability to read and write multiple versions/formats of a given message into a single common Java Object model.  By extensions, this means that you can use it to transform messages from one version to another by reading the XML into the common Java Object model using an XMLBinding instance configured for one version of the XML, and then writing those Java Objects back out using an XMLBinding instance configured for the other version of the XML.
</p><p><br>
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Create and initilise the XMLBinding instances for v1 and v2 of the XMLs...</span><br>XMLBinding xmlBindingV1 <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> XMLBinding<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">add</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"v1-binding-config.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>XMLBinding xmlBindingV2 <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> XMLBinding<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">add</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"v2-binding-config.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>xmlBindingV1.<span style="color: #006633;">intiailize</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>xmlBindingV2.<span style="color: #006633;">intiailize</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Read the v1 order XML into the Order Object model...</span><br>Order order <span style="color: #339933;">=</span> xmlBindingV1.<span style="color: #006633;">fromXML</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>inputReader<span style="color: #009900;">)</span>, Order.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Write the Order object model instance back out to XML using the v2 XMLBinding instance...</span><br>xmlBindingV2.<span style="color: #006633;">toXML</span><span style="color: #009900;">(</span>order, outputWriter<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><br>
See the <a href="http://smooks.org/mediawiki/index.php?title=V1.5:xml-read-write-transform" title="V1.5:xml-read-write-transform">xml-read-write-transform</a> example.
</p>
<a name="Generating_the_Smooks_Binding_Configuration"></a><h3> <span class="mw-headline">Generating the Smooks Binding Configuration</span></h3>
<p>The Javabean Cartridge contains the <b>org.milyn.javabean.gen.ConfigGenerator</b> utility class that can be used to generate a binding configuration template. This template can then be used as the basis for defining a binding.
</p><p>From the commandline:
</p>
<pre class="text" style="font-family:monospace;">$JAVA_HOME/bin/java -classpath &lt;classpath&gt; org.milyn.javabean.gen.ConfigGenerator -c &lt;rootBeanClass&gt; -o &lt;outputFilePath&gt; [-p &lt;propertiesFilePath&gt;]</pre>
<ul><li> The "<b>-c'</b>" commandline arg specifies the root class of the model whose binding config is to be generated.
</li><li> The "<b>-o</b>" commandline arg specifies the path and filename for the generated config output.
</li><li> The "<b>-p</b>" commandline arg specifies the path and filename optional binding configuration file that specifies aditional binding parameters.
</li></ul>
<p>The optional "-p" properties file parameter allows specification of additional config parameters:
</p>
<ul><li> <b>packages.included</b>: Semi-colon separated list of packages. Any fields in the class matching these packages will be included in the binding configuration generated.
</li><li> <b>packages.excluded</b>: Semi-colon separated list of packages. Any fields in the class matching these packages will be excluded from the binding configuration generated.
</li></ul>
<p>After running this utility against the target class, you typically need to perform the following follow-up tasks in order to make the binding configuration work for your Source data model.
</p>
<ol><li> For each <b>&lt;jb:bean&gt;</b> element, set the <b>createOnElement</b> attribute to the event element that should be used to create the bean instance.
</li><li> Update the <b>&lt;jb:value data&gt;</b> attributes to select the event element/attribute supplying the binding data for that bean property.
</li><li> Check the <b>&lt;jb:value decoder&gt;</b> attributes. Not all will be set, depending on the actual property type. These must be configured by hand e.g. you may need to configure <b>&lt;jb:decodeParam&gt;</b> sub-elements for the decoder on some of the bindings. E.g. for a date field.
</li><li> Double-check the binding config elements (<b>&lt;jb:value&gt;</b> and <b>&lt;jb:wiring&gt;</b>), making sure all Java properties have been covered in the generated configuration.
</li></ol>
<p>Determining the selector values can sometimes be difficult, especially for non XML Sources (Java etc). The Html Reporting tool can be a great help here because it helps you visualise the input message model (against which the selectors will be applied) as seen by Smooks. So, first off, generate a report using your Source data, but with an empty transformation configuration. In the report, you can see the model against which you need to add your configurations. Add the configurations one at a time, rerunning the report to check they are being applied.
</p><p>The following is an example of a generated configuration. Note the "$TODO$" tokens.
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.milyn.javabean.Order"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"$TODO$"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"header"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"header"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderItemsArray"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItemsArray"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"header"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.milyn.javabean.Header"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"$TODO$"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"date"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerNumber"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerName"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"String"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"privatePerson"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Boolean"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.ArrayList"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"$TODO$"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItems_entry"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItems_entry"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.milyn.javabean.OrderItem"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"$TODO$"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"productId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Double"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItemsArray"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.milyn.javabean.OrderItem[]"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"$TODO$"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItemsArray_entry"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItemsArray_entry"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"org.milyn.javabean.OrderItem"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"$TODO$"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"productId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Double"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"$TODO$"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Notes_on_JavaResult"></a><h3> <span class="mw-headline">Notes on JavaResult</span></h3>
<p>Users should note that there is <b>no guarantee</b> as to the exact contents of a <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/payload/JavaResult.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/payload/JavaResult.html" rel="nofollow">JavaResult</a> instance after calling the Smooks.filterSource method.  After calling this method, the JavaResult instance will contain the final contents of the bean context, which can be added to by any <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementation.
</p><p>You can restrict the Bean set returned in a JavaResult by using a <b>&lt;jb:result&gt;</b> configuration in the Smooks configuration.  In the following example configuration, we tell Smooks to only retain the "order" bean in the ResultSet:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Capture some data from the message into the bean context... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.Order"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderId"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order/@id"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerNumber"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer/@number"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerName"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItems"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItems"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.ArrayList"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItem"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.OrderItem"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"itemId"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/@id"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"productId"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/product"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/quantity"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/price"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Only retain the "order" bean in the root of any final JavaResult. --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:result</span> <span style="color: #000066;">retainBeans</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>So after applying this configuration, calls to the JavaResult.getBean(String) method for anything other than the "order" bean will return null.  This will work fine in cases such as the above example, because the other bean instances are wired into the "order" graph.
</p><p>Note that as of Smooks v1.2, if a <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/payload/JavaSource.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/payload/JavaSource.html" rel="nofollow">JavaSource</a> instance is supplied to the Smooks.filterSource method (as the filter Source instance),  Smooks will use the JavaSource to construct the bean context associated with the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/container/ExecutionContext.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/container/ExecutionContext.html" rel="nofollow">ExecutionContect</a> for that Smooks.filterSource invocation.  This will mean that some of the JavaSource bean instances may be visible in the JavaResult.
</p>
<a name="Templating"></a><h2> <span class="mw-headline">Templating</span></h2>
<p>Smooks provides two main Templating options:
</p>
<ol><li> <a href="http://freemarker.org/" class="external text" title="http://freemarker.org" rel="nofollow">FreeMarker Templating</a>
</li><li> <a href="http://www.w3.org/Style/XSL/" class="external text" title="http://www.w3.org/Style/XSL/" rel="nofollow">XSL Templating</a>
</li></ol>
<p>What Smooks adds here is the ability to use these Templating technologies within the context of a Smooks filtering process. This means that these technologies:
</p>
<ol><li> Can be applied to a source message on a per fragment basis Vs the whole message i.e. "Fragment Based Transforms". This is useful in situations where (for example) you only wish to insert a piece of data into a message at a specific point (e.g. add headers to a SOAP message), but you don't wish to interfere with the rest of the message stream. In this case you can "target" (apply) the template to the fragment of interest.
</li><li> Can take advantage of other Smooks technologies (Cartridges) such as the <a href="#Java_Binding" title="">Javabean Cartridge</a>. In this scenario, you can use the Javabean Cartridge to decode and bind data from the message into the Smooks bean context and then use (reference) that decoded data from inside your FreeMarker template (Smooks makes this data available to FreeMarker).
</li><li> Can be used to process huge message streams (GBs), while at the same time maintain a relatively simple processing model, with a low memory footprint. See <a href="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Processing_Huge_Messages_.28GBs.29" class="external text" title="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Processing_Huge_Messages_.28GBs.29" rel="nofollow">Processing Huge Messages</a>.
</li><li> Can be used for generating "Split Message Fragments" that can then be routed (using <a href="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Splitting_.26_Routing" class="external text" title="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Splitting_.26_Routing" rel="nofollow">Smooks Routing components</a>) to physical endpoints (File, JMS), or logical endpoints on an ESB (a "Service").
</li></ol>
<p><br>
Smooks can also be extended (and will) to add support for other templating technologies.
</p><p><b>Note</b>: <i>Be sure to read the section on <a href="#Java_Binding" title="">Java Binding</a></i>.
</p>
<a name="FreeMarker_Templating"></a><h3> <span class="mw-headline">FreeMarker Templating</span></h3>
<p><a href="http://freemarker.org/" class="external text" title="http://freemarker.org" rel="nofollow">FreeMarker</a> is a very powerful Templating Engine. Smooks allows FreeMarker to be used as a means of generating text based content that can then be inserted into a message stream (aka a "Fragment Transform"), or used as a "Split Message Fragment" for <a href="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Splitting_.26_Routing" class="external text" title="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Splitting_.26_Routing" rel="nofollow">routing to another process</a>.
</p><p>Configuring FreeMarker templates in Smooks is done through the <a href="http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd</a> configuration namespace. Just configure this XSD into your IDE and you're in business!
</p><p><b>Example - Inline Template</b>:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:ftl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><span style="color: #808080; font-style: italic;">&lt;!--&lt;orderId&gt;${order.id}&lt;/orderId&gt;--&gt;</span><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><b>Example - External Template Reference</b>:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:ftl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>/templates/shop/ordergen.ftl<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Smooks allows you to perform a number of operations with the Templating result. This is controlled by the <b>&lt;use&gt;</b> element, which is added to the &lt;ftl:freemarker&gt; configuration.
</p><p><b>Example - Inlining the Templating Result</b>:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>/templates/shop/ordergen.ftl<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:use<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:inline</span> <span style="color: #000066;">directive</span>=<span style="color: #ff0000;">"insertbefore"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:use<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Inlining allows you to inline the templating result into a <b>Smooks.filterSource</b> Result object. A number of <b>directives</b> are supported:
</p>
<ul><li> <b>addto</b>: Add the templating result to the targeted element.
</li><li> <b>replace</b> (default): Use the templating result to replace the targeted element. This is the default behavior for the &lt;ftl:freemarker&gt; configuration when the <b>&lt;use&gt;</b> element is not configured.
</li><li> <b>insertbefore</b>: Add the templating result before to the targeted element.
</li><li> <b>insertafter</b>: Add the templating result after to the targeted element.
</li></ul>
<p>Using <b>&lt;ftl:bindTo&gt;</b>, you can bind the Templating result to the Smooks <b>bean context</b>. The templating result can then be accessed by other Smooks components, such as the routing components. This can be especially useful for <a href="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Splitting_.26_Routing" class="external text" title="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Splitting_.26_Routing" rel="nofollow">splitting</a> huge messages into smaller (more consumable) messages that can then be <a href="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Splitting_.26_Routing" class="external text" title="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Splitting_.26_Routing" rel="nofollow">routed</a> to another process for handling.
</p><p><b>Example - Binding the Templating Result to the Smooks bean context</b>:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jms</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/jms-routing-1.2.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:ftl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jms:router</span> <span style="color: #000066;">routeOnElement</span>=<span style="color: #ff0000;">"order-item"</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem_xml"</span> <span style="color: #000066;">destination</span>=<span style="color: #ff0000;">"queue.orderItems"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>/orderitem-split.ftl<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:use<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #808080; font-style: italic;">&lt;!-- Bind the templating result into the bean context, from where</span><br><span style="color: #808080; font-style: italic;">                 it can be accessed by the JMSRouter (configured above). --&gt;</span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:bindTo</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">"orderItem_xml"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:use<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>(<i>See full example in the <a href="http://smooks.org/mediawiki/index.php?title=Smooks_v1.2_Examples" title="Smooks v1.2 Examples">split-transform-route-jms</a> tutorial</i>)
</p><p>Using <b>&lt;ftl:outputTo&gt;</b>, you can direct Smooks to write the templating result directly to an <b>OutputStreamResource</b>. This is another useful mechanism for <a href="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Splitting_.26_Routing" class="external text" title="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Splitting_.26_Routing" rel="nofollow">splitting</a> huge messages into smaller (more consumable) messages that can then be processed individually.
</p><p><b>Example - Writing the Template Result to an OutputStreamSource</b>:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:file</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/file-routing-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:ftl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Create/open a file output stream. This is written to by the freemarker template (below).. --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;file:outputStream</span> <span style="color: #000066;">openOnElement</span>=<span style="color: #ff0000;">"order-item"</span> <span style="color: #000066;">resourceName</span>=<span style="color: #ff0000;">"orderItemSplitStream"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;file:fileNamePattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>order-${order.orderId}-${order.orderItem.itemId}.xml<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/file:fileNamePattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;file:destinationDirectoryPattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>target/orders<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/file:destinationDirectoryPattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;file:listFileNamePattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>order-${order.orderId}.lst<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/file:listFileNamePattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;file:highWaterMark</span> <span style="color: #000066;">mark</span>=<span style="color: #ff0000;">"3"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/file:outputStream<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Every time we hit the end of an &lt;order-item&gt; element, apply this freemarker template,</span><br><span style="color: #808080; font-style: italic;">    outputting the result to the "orderItemSplitStream" OutputStream, which is the file</span><br><span style="color: #808080; font-style: italic;">    output stream configured above.</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>target/classes/orderitem-split.ftl<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:use<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #808080; font-style: italic;">&lt;!-- Output the templating result to the "orderItemSplitStream" file output stream... --&gt;</span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:outputTo</span> <span style="color: #000066;">outputStreamResource</span>=<span style="color: #ff0000;">"orderItemSplitStream"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:use<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>(<i>See full example in the <a href="http://smooks.org/mediawiki/index.php?title=Smooks_v1.2_Examples" title="Smooks v1.2 Examples">split-transform-route-jms</a> tutorial</i>)
</p>
<a name="FreeMarker_Transforms_using_NodeModels"></a><h4> <span class="mw-headline">FreeMarker Transforms using NodeModels</span></h4>
<p>The easiest way to construct message transforms in FreeMarker is to use FreeMarker's <a href="http://freemarker.org/docs/xgui_expose_dom.html" class="external text" title="http://freemarker.org/docs/xgui_expose_dom.html" rel="nofollow">NodeModel</a> facility. This is where FreeMarker uses a W3C DOM as the Templating model, referencing the DOM nodes directly from inside the FreeMarker template.
</p><p>Smooks adds two additional capabilities here:
</p>
<ol><li> The ability to perform this on a fragment basis i.e. you don't have to use the full message as the DOM model, just the targeted fragment.
</li><li> The ability to use <a href="http://freemarker.org/docs/xgui_expose_dom.html" class="external text" title="http://freemarker.org/docs/xgui_expose_dom.html" rel="nofollow">NodeModel</a> in a streaming filter process (see <a href="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Mixing_DOM_and_SAX" class="external text" title="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Mixing_DOM_and_SAX" rel="nofollow">Mixing DOM and SAX Models with Smooks</a>).
</li><li> The ability to use it on non XML messages (CSV, EDI etc).
</li></ol>
<p>To use this facility in Smooks, you need to define an additional resource that defines/declares the NodeModels to be captured (created in the case of SAX streaming):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:ftl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Create 2 NodeModels. One high level model for the "order"</span><br><span style="color: #808080; font-style: italic;">    (header etc) and then one per "order-item".</span><br>&nbsp;<br><span style="color: #808080; font-style: italic;">    These models are used in the FreeMarker templating resources</span><br><span style="color: #808080; font-style: italic;">    defined below. You need to make sure you set the selector such</span><br><span style="color: #808080; font-style: italic;">    that the total memory footprint is as low as possible. In this</span><br><span style="color: #808080; font-style: italic;">    example, the "order" model will contain everything accept the</span><br><span style="color: #808080; font-style: italic;">    &lt;order-item&gt; data (the main bulk of data in the message). The</span><br><span style="color: #808080; font-style: italic;">    "order-item" model only contains the current &lt;order-item&gt; data</span><br><span style="color: #808080; font-style: italic;">    (i.e. there's max 1 order-item in memory at any one time).</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource-config</span> <span style="color: #000066;">selector</span>=<span style="color: #ff0000;">"order,order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.milyn.delivery.DomModelCreator<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Apply the first part of the template when we reach the start</span><br><span style="color: #808080; font-style: italic;">    of the &lt;order-items&gt; element. Apply the second part when we</span><br><span style="color: #808080; font-style: italic;">    reach the end.</span><br>&nbsp;<br><span style="color: #808080; font-style: italic;">    Note the &lt;?TEMPLATE-SPLIT-PI?&gt; Processing Instruction in the</span><br><span style="color: #808080; font-style: italic;">    template. This tells Smooks where to split the template,</span><br><span style="color: #808080; font-style: italic;">    resulting in the order-items being inserted at this point.</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span>    <br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order-items"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><span style="color: #808080; font-style: italic;">&lt;!--&lt;salesorder&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;details&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;orderid&gt;${order.@id}&lt;/orderid&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;customer&gt;</span><br><span style="color: #808080; font-style: italic;">            &lt;id&gt;${order.header.customer.@number}&lt;/id&gt;</span><br><span style="color: #808080; font-style: italic;">            &lt;name&gt;${order.header.customer}&lt;/name&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;/customer&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;details&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;itemList&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;?TEMPLATE-SPLIT-PI?&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;/itemList&gt;</span><br><span style="color: #808080; font-style: italic;">&lt;/salesorder&gt;--&gt;</span><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Output the &lt;order-items&gt; elements. This will appear in the</span><br><span style="color: #808080; font-style: italic;">    output message where the &lt;?TEMPLATE-SPLIT-PI?&gt; token appears in the</span><br><span style="color: #808080; font-style: italic;">    order-items template.</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><span style="color: #808080; font-style: italic;">&lt;!-- &lt;item&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;id&gt;${.vars["order-item"].@id}&lt;/id&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;productId&gt;${.vars["order-item"].product}&lt;/productId&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;quantity&gt;${.vars["order-item"].quantity}&lt;/quantity&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;price&gt;${.vars["order-item"].price}&lt;/price&gt;</span><br><span style="color: #808080; font-style: italic;">&lt;item&gt;--&gt;</span><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>(<i>See full example in the <a href="http://smooks.org/mediawiki/index.php?title=V1.2:xml-to-xml" title="V1.2:xml-to-xml">xml-to-xml</a> tutorial</i>)
</p>
<a name="FreeMarker_and_the_Javabean_Cartridge"></a><h4> <span class="mw-headline">FreeMarker and the Javabean Cartridge</span></h4>
<p>FreeMarker NodeModel is very powerful and easy to use. The tradeoff is obviously that of performance. Constructing W3C DOMs is not cheap. It also may be the case that the required data has already been extracted and populated into a Java Object model anyway e.g. where the data also needs to be routed to a a JMS endpoint as Java Objects.
</p><p>In situations where using the NodeModel is not practical, Smooks allows you to use the Javabean Cartridge to populate a proper Java Object Model (or a Virtual Model). This model can then be used in the FreeMarker Templating process. See the docs on the <a href="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Java_Binding" class="external text" title="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#Java_Binding" rel="nofollow">Javabean Cartridge</a> for more details.
</p><p><b>Example (using a Virtual Model)</b>:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:ftl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Extract and decode data from the message. Used in the freemarker template (below). --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.Hashtable"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order/@id"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerNumber"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer/@number"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerName"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItem"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.Hashtable"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"itemId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/@id"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"productId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/product"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/quantity"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Double"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/price"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><span style="color: #808080; font-style: italic;">&lt;!--&lt;orderitem id="${order.orderItem.itemId}" order="${order.orderId}"&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;customer&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;name&gt;${order.customerName}&lt;/name&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;number&gt;${order.customerNumber?c}&lt;/number&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;/customer&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;details&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;productId&gt;${order.orderItem.productId}&lt;/productId&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;quantity&gt;${order.orderItem.quantity}&lt;/quantity&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;price&gt;${order.orderItem.price}&lt;/price&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;/details&gt;</span><br><span style="color: #808080; font-style: italic;">&lt;/orderitem&gt;--&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>(<i>See full example in the <a href="http://smooks.org/mediawiki/index.php?title=Smooks_v1.2_Examples" title="Smooks v1.2 Examples">split-transform-route-file</a> example</i>)
</p>
<a name="Programmatic_Configuration_8"></a><h4> <span class="mw-headline">Programmatic Configuration</span></h4>
<p>FreeMarker templating configurations can be programmatically added to a Smooks instance simply by configuring and adding a <a href="http://www.milyn.org/javadoc/v1.3/smooks-cartridges/templating/org/milyn/templating/freemarker/FreeMarkerTemplateProcessor.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks-cartridges/templating/org/milyn/templating/freemarker/FreeMarkerTemplateProcessor.html" rel="nofollow">FreeMarkerTemplateProcessor</a> instance to the Smooks instance.  The following example configures a Smooks instance with a Java Binding configuration and a FreeMarker templating configuration:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">addVisitor</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> Bean<span style="color: #009900;">(</span>OrderItem.<span style="color: #000000; font-weight: bold;">class</span>, <span style="color: #0000ff;">"orderItem"</span>, <span style="color: #0000ff;">"order-item"</span><span style="color: #009900;">)</span>.<span style="color: #006633;">bindTo</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"productId"</span>, <span style="color: #0000ff;">"order-item/product/@id"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>smooks.<span style="color: #006633;">addVisitor</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> FreeMarkerTemplateProcessor<span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> TemplatingConfiguration<span style="color: #009900;">(</span><span style="color: #0000ff;">"/templates/order-tem.ftl"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>, <span style="color: #0000ff;">"order-item"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// And then just use Smooks as normal... filter a Source to a Result etc...</span></pre>
<a name="XSL_Templating"></a><h3> <span class="mw-headline">XSL Templating</span></h3>
<p>Configuring XSL templates in Smooks is almost identical to that of configuring <a href="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#FreeMarker_Templating" class="external text" title="http://www.smooks.org/mediawiki/index.php?title=V1.2:Smooks_v1.2_User_Guide#FreeMarker_Templating" rel="nofollow">FreeMarker templates</a>. It is done through the <a href="http://www.milyn.org/xsd/smooks/xsl-1.1.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/xsl-1.1.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/xsl-1.1.xsd</a> configuration namespace. Just configure this XSD into your IDE and you're in business!
</p><p><b>Example</b>:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:xsl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/xsl-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsl:xsl</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"#document"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><span style="color: #808080; font-style: italic;">&lt;!--&lt;xxxxxx/&gt;--&gt;</span><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsl:xsl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>As with FreeMarker, external templates can be configured via URI reference in the &lt;xsl:template&gt; element.
</p><p>As already stated, configuring XSL templates in Smooks is almost identical to that of configuring FreeMarker templates (See above). For this reason, please consult the FreeMarker configuration docs. Translating to XSL equivalents is simply a matter of changing the configuration namepace. Please read the following sections however.
</p>
<a name="Points_to_Note_Regarding_XSL_Support"></a><h4> <span class="mw-headline">Points to Note Regarding XSL Support</span></h4>
<ol><li> It does not make sense to use Smooks for executing XSLT, unless:
<ul><li> You need to perform a fragment transform i.e. you are not transforming the whole message.
</li><li> You need to use other Smooks functionality to perform other operations on the message, such as message splitting, persistence etc.
</li></ul>
</li><li> XSL Templating is only supported through the DOM Filter. It is not supported through the SAX Filter. This can (depending on the XSL being applied) result in lower performance when compared to SAX based application of XSL.
</li><li> Smooks applies XSLs on a message fragment basis (i.e. DOM Element Nodes) Vs to the whole document (i.e. DOM Document Node). This can be very useful for fragmenting/modularizing your XSLs, but don't assume that an XSL written and working standalone (externally to Smooks and on the whole document) will automatically work through Smooks without modification. For this reason, Smooks does handle XSLs targeted at the document root node differently in that it applies the XSL to the DOM Document Node (Vs the root DOM Element). The basic point here is that if you already have XSLs and are porting them to Smooks, you may need to make some tweaks to the Stylesheet.
</li><li> XSLs typically contain a template matched to the root element. Because Smooks applies XSLs on a fragment basis, matching against the "root element" is no longer valid. You need to make sure the Stylesheet contains a template that matches against the context node (i.e. the targeted fragment).
</li></ol>
<a name="My_XSLT_Works_Outside_Smooks.2C_but_not_Inside.3F"></a><h4> <span class="mw-headline">My XSLT Works Outside Smooks, but not Inside?</span></h4>
<p>This can happen and is most likely going to be a a result of one of the following:
</p>
<ol><li> The Fragment based Processing Model: Your Stylesheet contains a template that's using an absolute path reference to the document root node. This will cause issues in the Smooks Fragment based Processing Model because the element being targeted by Smooks is not the document root node. Your XSLT needs to contain a template that matches against the context node being targeted by Smooks.
</li><li> SAX Vs DOM Processing: You are not comparing like with like. Smooks currently only supports a DOM based processing for XSL. In order to do an accurate comparison, you need to use a DOMSource (namespace aware) when executing the XSLT outside Smooks. It has been noticed that a given XSL Processor does not always produce the same output when applying a given XSLT using SAX or DOM.
</li></ol>
<a name="Simple_Stream_Manipulations"></a><h2> <span class="mw-headline">Simple Stream Manipulations</span></h2>
<p>Sometimes all you need to do is make a small modification to the message event stream e.g. renaming or removing an element, changing an attribute value etc.  Having to write a template to do this is obviously overkill.  What you can do is use the following core configurations (available since v1.4 only):
</p><p><br>
</p>
<ul><li> <b>&lt;core:setElementData&gt;</b>:  Set data (name and/or attribites) on the targeted element.
</li><li> <b>&lt;core:remove&gt;</b>:  Remove an element (i.e. do not serialize it to a StreamResult, if defined).
</li><li> <b>&lt;core:removeAttribute&gt;</b>:  Remove an attribute (i.e. do not serialize it to a StreamResult, if defined).
</li></ul>
<p><br>
Example:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Other configs, e.g. bean bindings etc --&gt;</span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Remove an element... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:remove</span> <span style="color: #000066;">element</span>=<span style="color: #ff0000;">"order/header"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Remove an attribute... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:removeAttribute</span> <span style="color: #000066;">onElement</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"orderStatus"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Rename an element... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:setElementData</span> <span style="color: #000066;">onElement</span>=<span style="color: #ff0000;">"order/order-items"</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"items"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Rename an element and set/change some of its attribute... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:setElementData</span> <span style="color: #000066;">onElement</span>=<span style="color: #ff0000;">"order/order-item"</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #808080; font-style: italic;">&lt;!-- Note you can use templating to inject data from the Bean Context into attribute values... --&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:attribute</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"status"</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">"${items.item.state}"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/core:setElementData<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Exporting_Results"></a><h2> <span class="mw-headline">Exporting Results</span></h2>
<p>When using Smooks standalone you are in full control of the type of output that Smooks produces since you specify it by passing a certain Result to the filter method. But when integrating Smooks with other frameworks (JBossESB, Mule, Camel, and others) this needs to be specified inside the framework's configuration. Starting with version 1.4 of Smooks you can now declare the data types that Smooks produces and you can use the Smooks api to retrieve the Result(s) that Smooks exports.
</p><p>To declare the type of result that Smooks produces you use the 'exports' element as shown below:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:exports<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:result</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"org.milyn.payload.JavaResult"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/core:exports<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The newly added exports element declares the results that are produced by this Smooks configuration. A exports element can contain one or more result elements. A framework that uses Smooks could then perform filtering like this:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Get the Exported types that were configured.</span><br>Exports exports <span style="color: #339933;">=</span> Exports.<span style="color: #006633;">getExports</span><span style="color: #009900;">(</span>smooks.<span style="color: #006633;">getApplicationContext</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br><span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">(</span>exports.<span style="color: #006633;">hasExports</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br><span style="color: #009900;">{</span><br>    <span style="color: #666666; font-style: italic;">// Create the instances of the Result types.</span><br>    <span style="color: #666666; font-style: italic;">// (Only the types, i.e the Class type are declared in the 'type' attribute.</span><br>    Result<span style="color: #009900;">[</span><span style="color: #009900;">]</span> results <span style="color: #339933;">=</span> exports.<span style="color: #006633;">createResults</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>executionContext, getSource<span style="color: #009900;">(</span>exchange<span style="color: #009900;">)</span>, results<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #666666; font-style: italic;">// The Results(s) will now be populate by Smooks filtering process and</span><br>    <span style="color: #666666; font-style: italic;">// available to the framework in question.</span><br><span style="color: #009900;">}</span></pre>
<p>There might also be cases where you only want a portion of the result extracted and returned. You can use the ‘extract’ attribute to specify this:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:exports<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:result</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"org.milyn.payload.JavaResult"</span> <span style="color: #000066;">extract</span>=<span style="color: #ff0000;">"orderBean"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/core:exports<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>he extract attribute is intended to be used when you are only interested in a sub-section of a produced result. In the example above we are saying that we only want the object named orderBean to be exported. The other contents of the JavaResult will be ignored. Another example where you might want to use this kind of extracting could be when you only want a ValidationResult of a certain type, for example to only return validation errors.
</p><p>Below is an example of using the extracts option from an embedded framework:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Get the Exported types that were configured.</span><br>Exports exports <span style="color: #339933;">=</span> Exports.<span style="color: #006633;">getExports</span><span style="color: #009900;">(</span>smooks.<span style="color: #006633;">getApplicationContext</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br><span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">(</span>exports.<span style="color: #006633;">hasExports</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br><span style="color: #009900;">{</span><br>    <span style="color: #666666; font-style: italic;">// Create the instances of the Result types.</span><br>    <span style="color: #666666; font-style: italic;">// (Only the types, i.e the Class type are declared in the 'type' attribute.</span><br>    Result<span style="color: #009900;">[</span><span style="color: #009900;">]</span> results <span style="color: #339933;">=</span> exports.<span style="color: #006633;">createResults</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>executionContext, getSource<span style="color: #009900;">(</span>exchange<span style="color: #009900;">)</span>, results<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    List<span style="color: #339933;">&lt;</span>object<span style="color: #339933;">&gt;</span> objects <span style="color: #339933;">=</span> Exports.<span style="color: #006633;">extractResults</span><span style="color: #009900;">(</span>results, exports<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #666666; font-style: italic;">// Now make the object available to the framework that this code is running:</span><br>    <span style="color: #666666; font-style: italic;">// Camel, JBossESB, Mule etc.</span><br><span style="color: #009900;">}</span></pre>
<a name="Enriching_Output_Data"></a><h1> <span class="mw-headline">Enriching Output Data</span></h1>
<p>There are three out of the box methods for enriching your output data:
</p>
<ul><li> Use a JDBC Datasource to access a database and use SQL statements to read from and write to the Database.  This capability is provided through the Smooks Routing Cartridge.  See the section on <a href="#Routing_to_a_Database_using_SQL" title="">Routing to a Database using SQL</a>.
</li><li> Use an entity persistence framework (like Ibatis, Hibernate or any JPA compatible framework) to  access a database and use it's query language or CRUD methods to read from it or write to it.  See the section on <a href="#Entity_Persistence_Frameworks" title="">Entity Persistence Frameworks</a>.
</li><li> Use custom Data Access Objects (DAO's) to  access a database and use it's CRUD methods to read from it or write to it.  Again, see <a href="#DAO_Support" title="">DAO Support</a>.
</li></ul>
<p><b>Note</b>: <i>Be sure to read the section on <a href="#Java_Binding" title="">Java Binding</a></i>.
</p><p>TODO: Rewrite / restructure this chapter
</p>
<a name="SQL_Support"></a><h2> <span class="mw-headline"> SQL Support </span></h2>
<p>See the <a href="#Routing_to_a_Database_using_SQL" title="">Routing to a Database using SQL</a> chapter for more information.
</p><p>TODO: Write this chapter
</p>
<a name="Entity_Persistence_Frameworks"></a><h2> <span class="mw-headline">Entity Persistence Frameworks</span></h2>
<p>With the new Smooks Persistence cartridge in Smooks 1.2, you can directly use several entity persistence frameworks from within Smooks (Hibernate, JPA etc).
</p><p>Lets take a look at a Hibernate example.  The same principals follow for any JPA compliant framework.
</p><p>The data we are going to process is an XML order message.  It should be noted however, that the input data could also be CSV, JSON, EDI, Java or any other structured/hierarchical data format.  The same principals apply, no matter what the data format is!
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ordernumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ordernumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>123456<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>11<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>22<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>7<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The Hibernate entities are:
</p>
<pre class="java" style="font-family:monospace;">@<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aentity+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Entity</span></a><br>@Table<span style="color: #009900;">(</span>name<span style="color: #339933;">=</span><span style="color: #0000ff;">"orders"</span><span style="color: #009900;">)</span><br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Order <span style="color: #009900;">{</span><br>&nbsp;<br>    @Id<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Ainteger+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Integer</span></a> ordernumber<span style="color: #339933;">;</span><br>&nbsp;<br>    @Basic<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> customerId<span style="color: #339933;">;</span><br>&nbsp;<br>    @OneToMany<span style="color: #009900;">(</span>mappedBy <span style="color: #339933;">=</span> <span style="color: #0000ff;">"order"</span>, cascade <span style="color: #339933;">=</span> CascadeType.<span style="color: #006633;">ALL</span><span style="color: #009900;">)</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Alist+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">List</span></a> orderItems <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aarraylist+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">ArrayList</span></a><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> addOrderLine<span style="color: #009900;">(</span>OrderLine orderLine<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        orderItems.<span style="color: #006633;">add</span><span style="color: #009900;">(</span>orderLine<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// Getters and Setters....</span><br><span style="color: #009900;">}</span><br>&nbsp;<br>@<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aentity+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Entity</span></a><br>@Table<span style="color: #009900;">(</span>name<span style="color: #339933;">=</span><span style="color: #0000ff;">"orderlines"</span><span style="color: #009900;">)</span><br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> OrderLine <span style="color: #009900;">{</span><br>&nbsp;<br>    @Id<br>    @GeneratedValue<span style="color: #009900;">(</span>strategy<span style="color: #339933;">=</span>GenerationType.<span style="color: #006633;">IDENTITY</span><span style="color: #009900;">)</span><br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Ainteger+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Integer</span></a> id<span style="color: #339933;">;</span><br>&nbsp;<br>    @ManyToOne<br>    @JoinColumn<span style="color: #009900;">(</span>name<span style="color: #339933;">=</span><span style="color: #0000ff;">"orderid"</span><span style="color: #009900;">)</span><br>    <span style="color: #000000; font-weight: bold;">private</span> Order order<span style="color: #339933;">;</span><br>&nbsp;<br>    @Basic<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Ainteger+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Integer</span></a> quantity<span style="color: #339933;">;</span><br>&nbsp;<br>    @ManyToOne<br>    @JoinColumn<span style="color: #009900;">(</span>name<span style="color: #339933;">=</span><span style="color: #0000ff;">"productid"</span><span style="color: #009900;">)</span><br>    <span style="color: #000000; font-weight: bold;">private</span> Product product<span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// Getters and Setters....</span><br><span style="color: #009900;">}</span><br>&nbsp;<br>@<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aentity+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Entity</span></a><br>@Table<span style="color: #009900;">(</span>name <span style="color: #339933;">=</span> <span style="color: #0000ff;">"products"</span><span style="color: #009900;">)</span><br>@NamedQuery<span style="color: #009900;">(</span>name<span style="color: #339933;">=</span><span style="color: #0000ff;">"product.byId"</span>, query<span style="color: #339933;">=</span><span style="color: #0000ff;">"from Product p where p.id =&nbsp;:id"</span><span style="color: #009900;">)</span><br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Product <span style="color: #009900;">{</span><br>&nbsp;<br>    @Id<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Ainteger+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Integer</span></a> id<span style="color: #339933;">;</span><br>&nbsp;<br>    @Basic<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> name<span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// Getters and Setters....</span><br><span style="color: #009900;">}</span></pre>
<p>What we want to do here is to process and persist the &lt;order&gt;.  First thing we need to do is to bind the order data into the Order entities (Order, OrderLine and Product).  To do this we need to:
</p>
<ol><li> <b>Create</b> and populate the Order and OrderLine entities using the <a href="#Java_Binding" title="">Java Binding</a> framework.
</li><li> <b>Wire</b> each OrderLine instance into the Order instance.
</li><li> Into each OrderLine instance, we need to <b>lookup and wire</b> in the associated order line Product entity.
</li><li> And finally, we need to <b>insert</b> (persist) the Order instance.
</li></ol>
<p>To do this, we need the following Smooks configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> </span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span> </span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:dao</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/persistence-1.2.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"example.entity.Order"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"ordernumber"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"ordernumber"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerId"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"customer"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">setterMethod</span>=<span style="color: #ff0000;">"addOrderLine"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderLine"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderLine"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"example.entity.OrderLine"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"product"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"product"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:locator</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"product"</span> <span style="color: #000066;">lookupOnElement</span>=<span style="color: #ff0000;">"order-item"</span> <span style="color: #000066;">onNoResult</span>=<span style="color: #ff0000;">"EXCEPTION"</span> <span style="color: #000066;">uniqueResult</span>=<span style="color: #ff0000;">"true"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:query<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>from Product p where p.id =&nbsp;:id<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dao:query<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:value</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"id"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"product"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dao:params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dao:locator<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:inserter</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">insertOnElement</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>If we want to use the named query "productById" instead of the query string then the DAO locator configuration will look like this:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:locator</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"product"</span> <span style="color: #000066;">lookupOnElement</span>=<span style="color: #ff0000;">"order-item"</span> <span style="color: #000066;">lookup</span>=<span style="color: #ff0000;">"product.byId"</span> <span style="color: #000066;">onNoResult</span>=<span style="color: #ff0000;">"EXCEPTION"</span> <span style="color: #000066;">uniqueResult</span>=<span style="color: #ff0000;">"true"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:value</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"id"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"product"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dao:params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dao:locator<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The following code executes Smooks. Note that we use a SessionRegister object so that we can access the Hibernate Session from within Smooks.
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #0000ff;">"smooks-config.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>ExecutionContext executionContext <span style="color: #339933;">=</span> smooks.<span style="color: #006633;">createExecutionContext</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// The SessionRegister provides the bridge between Hibernate and the</span><br><span style="color: #666666; font-style: italic;">// Persistence Cartridge. We provide it with the Hibernate session.</span><br><span style="color: #666666; font-style: italic;">// The Hibernate Session is set as default Session.</span><br>DaoRegister register <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SessionRegister<span style="color: #009900;">(</span>session<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// This sets the DAO Register in the executionContext for Smooks</span><br><span style="color: #666666; font-style: italic;">// to access it.</span><br>PersistenceUtil.<span style="color: #006633;">setDAORegister</span><span style="color: #009900;">(</span>executionContext, register<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>Transaction transaction <span style="color: #339933;">=</span> session.<span style="color: #006633;">beginTransaction</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>executionContext, source<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>transaction.<span style="color: #006633;">commit</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<a name="Data_Access_Object_Support"></a><h2> <span class="mw-headline">Data Access Object Support</span></h2>
<p>Now let’s take a look at a DAO based example.  The example will read an XML file containing order information (note that this works just the same for EDI, CSV etc).  Using the javabean cartridge, it will bind the XML data into a set of entity beans.  Using the id of the products within the order items (the &lt;product&gt; element) it will locate the product entities and bind them to the order entity bean.  Finally, the order bean will be persisted.
</p><p>The order XML message looks like this:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ordernumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ordernumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>123456<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>11<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>22<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/product<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>7<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order-items<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The following custom DAO will be used to persist the Order entity:
</p>
<pre class="java" style="font-family:monospace;">@Dao<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> OrderDao <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">final</span> EntityManager em<span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> OrderDao<span style="color: #009900;">(</span>EntityManager em<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">em</span> <span style="color: #339933;">=</span> em<span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    @Insert<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> insertOrder<span style="color: #009900;">(</span>Order order<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        em.<span style="color: #006633;">persist</span><span style="color: #009900;">(</span>order<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<p>When looking at this class you should notice the @Dao and @Insert annotations. The @Dao annotation declares that the OrderDao is a DAO object. The @Insert annotation declares that the insertOrder method should be used to insert Order entities.
</p><p>The following custom DAO will be used to lookup the Product entities:
</p>
<pre class="java" style="font-family:monospace;">@Dao<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> ProductDao <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">final</span> EntityManager em<span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> ProductDao<span style="color: #009900;">(</span>EntityManager em<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">em</span> <span style="color: #339933;">=</span> em<span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    @Lookup<span style="color: #009900;">(</span>name <span style="color: #339933;">=</span> <span style="color: #0000ff;">"id"</span><span style="color: #009900;">)</span><br>    <span style="color: #000000; font-weight: bold;">public</span> Product findProductById<span style="color: #009900;">(</span>@Param<span style="color: #009900;">(</span><span style="color: #0000ff;">"id"</span><span style="color: #009900;">)</span><span style="color: #000066; font-weight: bold;">int</span> id<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        <span style="color: #000000; font-weight: bold;">return</span> em.<span style="color: #006633;">find</span><span style="color: #009900;">(</span>Product.<span style="color: #000000; font-weight: bold;">class</span>, id<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<p>When looking at this class, you should notice the @Lookup and @Param annotation. The @Lookup annotation declares that the ProductDao#findByProductId method is used to lookup Product entities. The name parameter in the @Lookup annotation sets the lookup name reference for that method. When the name isn’t declared, the method name will be used. The optional @Param annotation let’s you name the parameters. This creates a better  abstraction between Smooks and the DAO. If you don’t declare the @Param annotation the parameters are resolved by there position.
</p><p>The Smooks configuration look likes this:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:dao</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/persistence-1.2.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"example.entity.Order"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"ordernumber"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"ordernumber"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerId"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"customer"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">setterMethod</span>=<span style="color: #ff0000;">"addOrderLine"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderLine"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderLine"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"example.entity.OrderLine"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"quantity"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"product"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"product"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:locator</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"product"</span> <span style="color: #000066;">dao</span>=<span style="color: #ff0000;">"product"</span> <span style="color: #000066;">lookup</span>=<span style="color: #ff0000;">"id"</span> <span style="color: #000066;">lookupOnElement</span>=<span style="color: #ff0000;">"order-item"</span> <span style="color: #000066;">onNoResult</span>=<span style="color: #ff0000;">"EXCEPTION"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:value</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"id"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"product"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dao:params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dao:locator<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dao:inserter</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">dao</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">insertOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The following code executes Smooks:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks<span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #0000ff;">"./smooks-configs/smooks-dao-config.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>ExecutionContext executionContext<span style="color: #339933;">=</span>smooks.<span style="color: #006633;">createExecutionContext</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// The register is used to map the DAO's to a DAO name. The DAO name isbe used in</span><br><span style="color: #666666; font-style: italic;">// the configuration.</span><br><span style="color: #666666; font-style: italic;">// The MapRegister is a simple Map like implementation of the DaoRegister.</span><br>DaoRegister<span style="color: #339933;">&lt;</span>object<span style="color: #339933;">&gt;</span>register <span style="color: #339933;">=</span> MapRegister.<span style="color: #006633;">builder</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">put</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"product"</span>,<span style="color: #000000; font-weight: bold;">new</span> ProductDao<span style="color: #009900;">(</span>em<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">put</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"order"</span>,<span style="color: #000000; font-weight: bold;">new</span> OrderDao<span style="color: #009900;">(</span>em<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br>        .<span style="color: #006633;">build</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>PersistenceUtil.<span style="color: #006633;">setDAORegister</span><span style="color: #009900;">(</span>executionContext,mapRegister<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #666666; font-style: italic;">// Transaction management from within Smooks isn't supported yet,</span><br><span style="color: #666666; font-style: italic;">// so we need to do it outside the filter execution</span><br>EntityTransaction tx<span style="color: #339933;">=</span>em.<span style="color: #006633;">getTransaction</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>tx.<span style="color: #006633;">begin</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filter</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>messageIn<span style="color: #009900;">)</span>,<span style="color: #000066; font-weight: bold;">null</span>,executionContext<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>tx.<span style="color: #006633;">commit</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<a name="Scripting"></a><h1> <span class="mw-headline">Scripting</span></h1>
<a name="Groovy"></a><h2> <span class="mw-headline">Groovy</span></h2>
<p>Support for <a href="http://groovy.codehaus.org/" class="external text" title="http://groovy.codehaus.org" rel="nofollow">Groovy</a> based scripting is made available through the <a href="http://www.milyn.org/xsd/smooks/groovy-1.1.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/groovy-1.1.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/groovy-1.1.xsd</a> configuration namespace. This adds support for DOM or SAX based Groovy scripting.
</p><p>Example configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:g</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/groovy-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;g:groovy</span> <span style="color: #000066;">executeOnElement</span>=<span style="color: #ff0000;">"xxx"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;g:script<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">        //Rename the target fragment element from "xxx" to "yyy"...</span><br><span style="color: #808080; font-style: italic;">        DomUtils.renameElement(element, "yyy", true, true);</span><br><span style="color: #808080; font-style: italic;">        --&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/g:script<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/g:groovy<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><b>Usage Tips</b>
</p>
<ol><li> <b>Imports</b>: Imports can be added via the "imports" element. A number of classes are automatically imported:
<ul><li> org.milyn.xml.DomUtils
</li><li> org.milyn.javabean.context.BeanContext
</li><li> org.milyn.javabean.repository.BeanRepository
</li><li> org.w3c.dom.*
</li><li> groovy.xml.dom.DOMCategory, groovy.xml.dom.DOMUtil, groovy.xml.DOMBuilder
</li></ul>
</li><li> <b>Visited Element</b>: The visited element is available to the script through the variable "<b>element</b>". It is also available under a variable name equal to the element name, but only if the element name contains alpha-numeric characters only.
</li><li> <b>Execute Before/After</b>: By default, the script is executed on the visitAfter event. You can direct it to be executed on the visitBefore by setting the "<b>executeBefore</b>" attribute to "true".
</li><li> <b>Comment/CDATA Script Wrapping</b>: If the script contains special XML characters, it can be wrapped in an XML Comment or CDATA section.
</li></ol>
<a name="Groovy_Scriptlet_Variables_and_Methods"></a><h3> <span class="mw-headline">Groovy Scriptlet Variables and Methods</span></h3>
<p>A number of variables and methods are made directly available to groovy scriptlet code i.e. you can references them directly in your scriptlet.
</p><p><i><b>Variables</b></i>:
</p>
<ul><li> <b>element</b>:  The DOM/SAX Element (depending on which filter type is in use) i.e. <i>org.w3c.dom.Element</i> or <i>org.milyn.delivery.sax.SAXElement</i>.
</li><li> <b>executionContext</b>: The Smooks <i>ExecutionContext</i> instance associated with the Smooks filtering operation.
</li><li> <b>nodeModels</b>:  A Map containing all the DOM NodeModels currently available (i.e. Map&lt;String, Element&gt;).
</li></ul>
<p><i><b>Methods</b></i>:
</p>
<ul><li> <b>Object getBean(String beanId)</b>: Get a bean from the <i>BeanContext</i>.
</li></ul>
<a name="Adding_Beans_to_the_BeanContext"></a><h3> <span class="mw-headline">Adding Beans to the BeanContext</span></h3>
<p>As shown above, all scriptlet code can access the beans in the <i>BeanContext</i> by calling the <i>getBean</i> method from inside the scriptlet code.  One oversight when implementing this feature was that we didn't provide an <i>addBean</i> method for adding beans to the bean context.  However, it is still possible to do so in a slightly more longwinded method via the <i>executionContext</i> e.g.:
</p>
<pre class="java" style="font-family:monospace;">executionContext.<span style="color: #006633;">getBeanContext</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">addBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"myBean"</span>, myBeanInstance<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<a name="Mixed_DOM_and_SAX_with_Groovy"></a><h3> <span class="mw-headline">Mixed DOM and SAX with Groovy</span></h3>
<p>Because <a href="http://groovy.codehaus.org/" class="external text" title="http://groovy.codehaus.org" rel="nofollow">Groovy</a> has a number of very useful DOM processing features, we added support for the mixed DOM and SAX processing models.
</p><p>What this means is that you can use Groovy's DOM utilities to process the targeted message fragment. The "<b>element</b>" received by the Groovy script will be a DOM Element, even when using the SAX filter. This makes Groovy scripting via the SAX filter a lot easier, while at the same time maintaining the ability to process huge messages in a streamed fashion.
</p><p><b>Mixed SAX and DOM Gotchas</b>
</p>
<ul><li> Only available in default mode i.e. when "<b>executeBefore</b>" equals "<b>false</b>". If "<b>executeBefore</b>" is configured "<b>true</b>", this facility is not available and the Groovy script will only have access to the element as a SAXElement.
</li><li> To write the DOM fragment to a Smooks.filterSource StreamResult, "writeFragment" must be called. See example below.
</li><li> There is an obvious performance overhead incurred using this facility (DOM construction). That said, it can still be used to process huge messages because of how the <a href="http://smooks.org/mediawiki/index.php?title=Smooks_v1.2_User_Guide#Mixing_DOM_and_SAX" class="mw-redirect" title="Smooks v1.2 User Guide">DomModelCreator</a> works for SAX. So, it can still process huge message, but it might take a little longer. The tradeoff is usability Vs performance.
</li></ul>
<a name="Mixed_DOM_and_SAX_Example"></a><h3> <span class="mw-headline">Mixed DOM and SAX Example</span></h3>
<p>Take an XML message such as:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;shopping<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;category</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"groceries"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Chocolate<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Coffee<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/category<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;category</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"supplies"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Paper<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;item</span> <span style="color: #000066;">quantity</span>=<span style="color: #ff0000;">"4"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Pens<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/category<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;category</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"present"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;item</span> <span style="color: #000066;">when</span>=<span style="color: #ff0000;">"Aug 10"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>Kathryn's Birthday<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/item<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/category<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/shopping<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Using Groovy, we want to modify the "supplies" category in the shopping list, adding 2 to the quantity, where the item is "Pens". To do this, we write a simple little Groovy script and target it at the &lt;category&gt; elements in the message. The script simple iterates over the &lt;item&gt; elements in the category and increments the quantity by 2, where the category type is "supplies" and the item is "Pens":
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> </span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.3.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:g</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/groovy-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:filterSettings</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"SAX"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;g:groovy</span> <span style="color: #000066;">executeOnElement</span>=<span style="color: #ff0000;">"category"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;g:script<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">        use(DOMCategory) {</span><br><span style="color: #808080; font-style: italic;">            // Modify "supplies": we need an extra 2 pens...</span><br><span style="color: #808080; font-style: italic;">            if (category.'@type' == 'supplies') {</span><br><span style="color: #808080; font-style: italic;">                category.item.each { item -&gt;</span><br><span style="color: #808080; font-style: italic;">                    if (item.text() == 'Pens') {</span><br><span style="color: #808080; font-style: italic;">                        item['@quantity'] = item.'@quantity'.toInteger() + 2;</span><br><span style="color: #808080; font-style: italic;">                    }</span><br><span style="color: #808080; font-style: italic;">                }</span><br><span style="color: #808080; font-style: italic;">            }</span><br><span style="color: #808080; font-style: italic;">        }</span><br>&nbsp;<br><span style="color: #808080; font-style: italic;">        // When using the SAX filter, we need to explicitly write the fragment</span><br><span style="color: #808080; font-style: italic;">        // to the result stream...</span><br><span style="color: #808080; font-style: italic;">        writeFragment(category);</span><br><span style="color: #808080; font-style: italic;">        --&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/g:script<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/g:groovy<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Routing_Output_Data"></a><h1> <span class="mw-headline">Routing Output Data</span></h1>
<p>Smooks supports a number of different options when it comes to Splitting and Routing message fragments.  The ability to split messages into fragments and route these fragments to different kinds of endpoints (File, JMS etc) is a very important capability.  Smooks provides this capability with a number of very interesting "twists":
</p><p><br>
</p>
<ol><li>  <b>Basic Fragment Splitting</b>:  It is often the case that you simply need to perform a dumb split on a message e.g. splitting all the &lt;order-item&gt; fragments in a message and route them to a file.  When we say "dumb split", we mean that you don't need to perform any type of transformation on the split message fragments before routing such as merging data from other parts of the message hierarchy before routing (e.g. add customer details info to the &lt;order-item&gt; fragment before routing).  Basic splitting and routing simply involves defining the XPath of the message fragment to be split out and the defining a routing component (e.g. JBoss ESB or Camel) to route that unmodified split message fragment. See <a href="#Basic_Splitting_and_Routing" title="">Basic Splitting and Routing</a>.
</li><li>  <b>Complex Fragment Splitting</b>:  Basic Fragment Splitting works for many use cases and is what most Splitting and Routing solutions offer.  Smooks extends the basic splitting capabilities by allowing you to perform transformations on the split fragment data before routing is applied e.g. merging in the &lt;customer-details&gt; order information with each &lt;order-item&gt; information before performing the routing order-item split fragment routing.
</li><li>  <b>In Stream Splitting &amp; Routing (Huge Message Support)</b>:  Because Smooks can perform routing "in stream" (not batched up for routing after processing the complete message), it is able to accommodate processing of huge message streams (&gt;&gt; GBs).
</li><li>  <b>Multiple Splitting and Routing</b>:  Conditionally split and route multiple message fragments (different formats XML, EDI, Java etc) to different endpoints in a single filtering pass of the input message stream e.g. route an OrderItem Java object instance to the "HighValueOrdersValidation" JMS Queue for order items with a value greater than $1,000 and route all order items (unconditional) as XML/JSON to a HTTP endpoint for logging.
</li></ol>
<p><br>
See the section on <a href="#Splitting_.26_Routing" title="">Splitting &amp; Routing</a>.
</p>
<a name="File"></a><h2> <span class="mw-headline">File</span></h2>
<p>See the <a href="#Routing_to_File" title="">Routing to File</a> chapter for more information.
</p>
<a name="Database"></a><h2> <span class="mw-headline">Database</span></h2>
<p>See the <a href="#Enriching_Output_Data" title="">Enriching Output Data</a> chapter for more information on database access (also for writing to the database)
</p>
<a name="Java"></a><h2> <span class="mw-headline">Java</span></h2>
<p>See the <a href="#The_Bean_Context" title="">Bean Context</a> chapter in th basics chapter for more information.
</p>
<a name="JMS"></a><h2> <span class="mw-headline">JMS</span></h2>
<p>See the <a href="#Routing_to_JMS" title="">Routing to JMS</a> for more information.
</p>
<a name="ESB_Support"></a><h2> <span class="mw-headline">ESB Support</span></h2>
<p>Smooks plugins are available for a number of ESBs:
</p>
<ol><li> <a href="http://wiki.jboss.org/wiki/Wiki.jsp?page=MessageTransformation" class="external text" title="http://wiki.jboss.org/wiki/Wiki.jsp?page=MessageTransformation" rel="nofollow">JBoss ESB</a>.
</li><li> <a href="http://www.mulesource.org/display/SMOOKS/Home" class="external text" title="http://www.mulesource.org/display/SMOOKS/Home" rel="nofollow">Mule</a>.
</li><li> <a href="http://esbsite.org/resources.jsp?path=/mediators/upul/Smooks%20Transform%20Mediator" class="external text" title="http://esbsite.org/resources.jsp?path=/mediators/upul/Smooks%20Transform%20Mediator" rel="nofollow">Apache Synapse/WS02</a>.
</li></ol>
<a name="Camel"></a><h2> <span class="mw-headline">Camel</span></h2>
<p>It is possible to route fragments to Apache Camel endpoints using the <b>&lt;<a href="http://www.milyn.org/xsd/smooks/camel-1.4.xsd" class="external text" title="http://www.milyn.org/xsd/smooks/camel-1.4.xsd" rel="nofollow">camel:route</a>&gt;</b> configuration from the <a href="http://www.milyn.org/xsd/smooks/camel-1.4.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/camel-1.4.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/camel-1.4.xsd</a> configuration namespace.
</p><p>For example, you can route to Camel endpoint by specifying the following in your Smooks configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">         <span style="color: #000066;">xmlns:camel</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/camel-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>  <span style="color: #808080; font-style: italic;">&lt;!-- Create some bean instances from the input source... --&gt;</span><br>  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem"</span>  ... <span style="color: #ff0000;">"&gt;</span></span><br>    <span style="color: #808080; font-style: italic;">&lt;!-- etc... See Smooks Java Binding docs --&gt;</span><br>  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>  <span style="color: #808080; font-style: italic;">&lt;!-- Route bean to camel endpoints... --&gt;</span><br>  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;camel:route</span> <span style="color: #000066;">beanid</span>=<span style="color: #ff0000;">"orderItem"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;camel:to</span> <span style="color: #000066;">endpoint</span>=<span style="color: #ff0000;">"direct:slow"</span> <span style="color: #000066;">if</span>=<span style="color: #ff0000;">"orderItem.priority == 'Normal'"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;camel:to</span> <span style="color: #000066;">endpoint</span>=<span style="color: #ff0000;">"direct:express"</span> <span style="color: #000066;">if</span>=<span style="color: #ff0000;">"orderItem.priority == 'High'"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/camel:route<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>In the above example, we route Java Beans from the Smooks BeanContext to the Camel Endpoints. Note that you can also apply templates (e.g. FreeMarker) to these same beans and route the templating result instead of beans (e.g. as XML, CSV or other).
</p><p>The above configuration shows routing using the ‘beanId’ attribute. It is also possible to route using an attribute named ‘routeOnElement'
</p>
<a name="Performance_Tuning"></a><h1> <span class="mw-headline">Performance Tuning</span></h1>
<p>Like with any Software, when configured or used incorrectly, performance can be one of the first things to suffer. Smooks is no different in this regard.
</p>
<a name="General"></a><h2> <span class="mw-headline">General</span></h2>
<ul><li> <b>Cache and Reuse</b> the Smooks Object. Initialization of Smooks takes some time and therefore it is important that it is reused.
</li><li> <b><a href="#Filter_Settings" title="">Pool reader instances</a></b> where possible.  This can result in a huge performance boost, as some readers are very expensive to create.
</li><li> <b>If possible, use <a href="#Filter_Settings" title="">SAX filtering</a></b>. However, you need to check that all Smooks Cartridges in use are SAX compatible. SAX processing is a lot faster than DOM processing and has a consistently small memory footprint. It is mandatory for processing large messages. See the <a href="#Filtering_Process_Selection_.28DOM_or_SAX.3F.29" title="">Filtering Process Selection (DOM or SAX?)</a> section.  SAX filtering is the <a href="http://jira.codehaus.org/browse/MILYN-589" class="external text" title="http://jira.codehaus.org/browse/MILYN-589" rel="nofollow">default filtering type since Smooks v1.5</a>.
</li><li> <b>Turn off debug logging</b>.  Smooks performs some intensive debug logging in parts of the code.  This can result in significant additional processing overhead and lower throughput.  Also remember that NOT having your logging configured (at all) may result in debug log statements being executed!!
</li><li> <b>Only use the HTMLReportGenerator in development</b>. When enabled, the HTMLReportGenerator incurs a significant performance overhead and with large message, can even result in OutOfMemory exceptions.
</li><li> <b>Contextual selectors</b> can obviously have a negative effect on performance e.g. evaluating a match for a selector like "a/b/c/d/e" will obviously require more processing than that of a selector like "d/e". Obviously there will be situations where your data model will require deep selectors, but where it does not, you should try to optimize them for the sake of performance.
</li></ul>
<a name="Smooks_Cartridges_2"></a><h2> <span class="mw-headline">Smooks Cartridges</span></h2>
<p>Every cartridge can have its own performance optimization tips.
</p>
<a name="Javabean_Cartridge"></a><h2> <span class="mw-headline">Javabean Cartridge</span></h2>
<ul><li> If possible don't use the Virtual Bean Model. Create Beans instead of maps. Creating and adding data to Maps is a lot slower then creating simple POJO's and calling the setter methods.
</li></ul>
<a name="Testing"></a><h1> <span class="mw-headline"> Testing </span></h1>
<a name="Unit_Testing"></a><h2> <span class="mw-headline"> Unit Testing </span></h2>
<p>Unit testing with Smooks is simple:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyMessageTransformTest <span style="color: #009900;">{</span><br>    @Test<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> test_transform<span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a>, SAXException <span style="color: #009900;">{</span><br>        Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>getClass<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"smooks-config.xml"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">{</span><br>            Source source <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>getClass<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"input-message.xml"</span> <span style="color: #009900;">)</span> <span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>            StringResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> StringResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>            smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>source, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>            <span style="color: #666666; font-style: italic;">// compare the expected xml with the transformation result.</span><br>            XMLUnit.<span style="color: #006633;">setIgnoreWhitespace</span><span style="color: #009900;">(</span> <span style="color: #000066; font-weight: bold;">true</span> <span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>            XMLAssert.<span style="color: #006633;">assertXMLEqual</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Ainputstreamreader+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">InputStreamReader</span></a><span style="color: #009900;">(</span>getClass<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"expected.xml"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>, <span style="color: #000000; font-weight: bold;">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astringreader+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">StringReader</span></a><span style="color: #009900;">(</span>result.<span style="color: #006633;">getResult</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        <span style="color: #009900;">}</span> <span style="color: #000000; font-weight: bold;">finally</span> <span style="color: #009900;">{</span><br>            smooks.<span style="color: #006633;">close</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        <span style="color: #009900;">}</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<p>The test case above uses <a href="http://xmlunit.sourceforge.net/" class="external text" title="http://xmlunit.sourceforge.net/" rel="nofollow">xmlunit</a>.
</p><p>The following maven dependency was used for xmlunit in the above test:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>xmlunit<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>xmlunit<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1.1<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Common_use_cases"></a><h1> <span class="mw-headline"> Common use cases </span></h1>
<a name="Processing_Huge_Messages_.28GBs.29"></a><h2> <span class="mw-headline">Processing Huge Messages (GBs)</span></h2>
<p>One of the main features introduced in Smooks v1.0 is the ability to process huge messages (Gbs in size). Smooks supports the following types of processing for huge messages:
</p>
<ul><li> <b>One-to-One Transformation</b>: This is the process of transforming a huge message from it's source format (e.g. XML), to a huge message in a target format e.g. EDI, CSV, XML etc.
</li><li> <b>Splitting &amp; Routing</b>: Splitting of a huge message into smaller (more consumable) messages in any format (EDI, XML, Java etc.) and <b>Routing</b> of those smaller messages to a number of different destination types (File, JMS, Database).
</li><li> <b>Persistence</b>: Persisting the components of the huge message to a Database, from where they can be more easily queried and processed. Within Smooks, we consider this to be a form of Splitting and Routing (routing to a Database).
</li></ul>
<p>All of the above is possible without writing any code (i.e. in a declarative manner). Typically, any of the above types of processing would have required writing quite a bit of ugly/unmaintainable code. It might also have been implemented as a multi-stage process where the huge message is split into smaller messages (stage #1) and then each smaller message is processed in turn to persist, route etc. (stage #2). This would all be done in an effort to make that ugly/unmaintainable code a little more maintainable and reusable. With Smooks, most of these use-cases can be handled without writing any code. As well as that, they can also be handled in a single pass over the source message, splitting and routing in parallel (plus routing to multiple destinations of different types and in different formats).
</p><p><b>Note</b>: <i>Be sure to read the section on <a href="#Java_Binding" title="">Java Binding</a></i>.
</p><p><b>Performance Hint</b>
</p>
<ul><li> When processing huge messages with Smooks, make sure you are using the <b>SAX filter</b>.
</li></ul>
<a name="One-to-One_Transformation"></a><h3> <span class="mw-headline">One-to-One Transformation</span></h3>
<p>If the requirement is to process a huge message by transforming it into a single message of another format, the easiest mechanism with Smooks is to apply multiple FreeMarker templates to the Source message Event Stream, outputting to a Smooks.filterSource Result stream.
</p><p>This can be done in one of 2 ways with FreeMarker templating, depending on the type of model that's appropriate:
</p>
<ol><li> Using FreeMarker + NodeModels for the model.
</li><li> Using FreeMarker + a Java Object model for the model. The model can be constructed from data in the message, using the Javabean Cartridge.
</li></ol>
<p>Option #1 above is obviously the option of choice, if the tradeoffs are OK for your use case. Please see the FreeMarker Templating docs for more details.
</p><p>The following images shows an &lt;order&gt; message, as well as the &lt;salesorder&gt; message to which we need to transform the &lt;order&gt; message:
</p><p><a href="http://smooks.org/mediawiki/index.php?title=Image:Huge-message.png" class="image" title="Image:huge-message.png"><img alt="Image:huge-message.png" src="./User-Guide_files/Huge-message.png" width="780" height="650" border="0"></a>
</p><p>Imagine a situation where the &lt;order&gt; message contains millions of &lt;order-item&gt; elements. Processing a huge message in this way with Smooks and FreeMarker (using NodeModels) is quite straightforward. Because the message is huge, we need to identify multiple NodeModels in the message, such that the runtime memory footprint is as low as possible. We cannot process the message using a single model, as the full message is just too big to hold in memory. In the case of the &lt;order&gt; message, there are 2 models, one for the main &lt;order&gt; data (blue highlight) and one for the &lt;order-item&gt; data (beige highlight):
</p><p><a href="http://smooks.org/mediawiki/index.php?title=Image:Huge-message-models.png" class="image" title="Image:huge-message-models.png"><img alt="Image:huge-message-models.png" src="./User-Guide_files/Huge-message-models.png" width="387" height="534" border="0"></a>
</p><p>So in this case, the most data that will be in memory at any one time is the main order data, plus one of the order-items. Because the NodeModels are nested, Smooks makes sure that the order data NodeModel never contains any of the data from the order-item NodeModels. Also, as Smooks filters the message, the order-item NodeModel will be overwritten for every order-item (i.e. they are not collected). See Mixing DOM and SAX Models with Smooks.
</p><p>Configuring Smooks to capture multiple NodeModels for use by the FreeMarker templates is just a matter of configuring the <b>DomModelCreator</b> <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a>, targeting it at the root node of each of the models. Note again that Smooks also makes this available to SAX filtering (the key to processing huge message). The Smooks configuration for creating the NodeModels for this message are:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> </span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.3.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:ftl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Filter the message using the SAX Filter (i.e. not DOM, so no</span><br><span style="color: #808080; font-style: italic;">    intermediate DOM for the "complete" message - there are "mini" DOMs</span><br><span style="color: #808080; font-style: italic;">    for the NodeModels below)....</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:filterSettings</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"SAX"</span> <span style="color: #000066;">defaultSerialization</span>=<span style="color: #ff0000;">"false"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">    Create 2 NodeModels. One high level model for the "order"</span><br><span style="color: #808080; font-style: italic;">    (header etc) and then one for the "order-item" elements...</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource-config</span> <span style="color: #000066;">selector</span>=<span style="color: #ff0000;">"order,order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.milyn.delivery.DomModelCreator<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- FreeMarker templating configs to be added below... --&gt;</span></pre>
<p>Now the FreeMarker templates need to be added. We need to apply 3 templates in total:
</p>
<ol><li> A template to output the order "header" details, up to but not including the order items.
</li><li> A template for each of the order items, to generate the &lt;item&gt; elements in the &lt;salesorder&gt;.
</li><li> A template to close out the message.
</li></ol>
<p>With Smooks, we implement this by defining 2 FreeMarker templates. One to cover #1 and #3 (combined) above, and a seconds to cover the &lt;item&gt; elements.
</p><p>The first FreeMarker template is targeted at the &lt;order-items&gt; element and looks as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order-items"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><span style="color: #808080; font-style: italic;">&lt;!--&lt;salesorder&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;details&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;orderid&gt;${order.@id}&lt;/orderid&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;customer&gt;</span><br><span style="color: #808080; font-style: italic;">            &lt;id&gt;${order.header.customer.@number}&lt;/id&gt;</span><br><span style="color: #808080; font-style: italic;">            &lt;name&gt;${order.header.customer}&lt;/name&gt;</span><br><span style="color: #808080; font-style: italic;">        &lt;/customer&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;/details&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;itemList&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;?TEMPLATE-SPLIT-PI?&gt; </span><br><span style="color: #808080; font-style: italic;">    &lt;/itemList&gt;</span><br><span style="color: #808080; font-style: italic;">&lt;/salesorder&gt;--&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>You will notice the <b>&lt;?TEMPLATE-SPLIT-PI?&gt;</b> Processing Instruction. This tells Smooks where to split the template, outputting the first part of the template at the start of the &lt;order-items&gt; element, and the other part at the end of the &lt;order-items&gt; element. The &lt;item&gt; element template (the second template) will be output in between.
</p><p>The second FreeMarker template is very straightforward. It simply outputs the &lt;item&gt; elements at the end of every &lt;order-item&gt; element in the source message:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><span style="color: #808080; font-style: italic;">&lt;!-- &lt;item&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;id&gt;${.vars["order-item"].@id}&lt;/id&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;productId&gt;${.vars["order-item"].product}&lt;/productId&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;quantity&gt;${.vars["order-item"].quantity}&lt;/quantity&gt;</span><br><span style="color: #808080; font-style: italic;">    &lt;price&gt;${.vars["order-item"].price}&lt;/price&gt;</span><br><span style="color: #808080; font-style: italic;">&lt;/item&gt;--&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Because the second template fires on the end of the &lt;order-item&gt; elements, it effectively generates output into the location of the <b>&lt;?TEMPLATE-SPLIT-PI?&gt;</b> Processing Instruction in the first template. Note that the second template could have also referenced data in the "order" NodeModel.
</p><p>And that's it! This is available as a runnable example in the Tutorials section.
</p><p>This approach to performing a One-to-One Transformation of a huge message works simply because the only objects in memory at any one time are the order header details and the current &lt;order-item&gt; details (in the Virtual Object Model).? Obviously it can't work if the transformation is so obscure as to always require full access to all the data in the source message e.g. if the messages needs to have all the order items reversed in order (or sorted).? In such a case however, you do have the option of routing the order details and items to a database and then using the database's storage, query and paging features to perform the transformation.
</p>
<a name="Splitting_.26_Routing"></a><h3> <span class="mw-headline">Splitting &amp; Routing</span></h3>
<p>Another common approach to processing large/huge messages is to split them out into smaller messages that can be processed independently. Of course Splitting and Routing is not just a solution for processing huge messages. It's often needed with smaller messages too (message size may be irrelevant) where, for example, order items in an an order message need to be split out and routed (based on content - "Content Base Routing") to different departments or partners for processing. Under these conditions, the message formats required at the different destinations may also vary e.g.
</p>
<ul><li> "destination1" required XML via the file system,
</li><li> "destination2" requires Java objects via a JMS Queue,
</li><li> "destination3" picks the messages up from a table in a Database etc.
</li><li> "destination4" requires EDI messages via a JMS Queue,
</li><li> etc etc
</li></ul>
<p>With Smooks, all of the above is possible. You can perform multiple splitting and routing operations to multiple destinations (of different types) in a single pass over a message.
</p><p>The basic concept is simple.  As you stream the message through Smooks:
</p>
<ol><li> Repeatedly create a standalone message (split) for the fragment to be routed.
</li><li> Repeatedly bind the split message into the bean context under a unique beanId.
</li><li> Repeatedly route the split message to the required endpoint (File, DB, JMS, ESB).
</li></ol>
<p>We emphasize "Repeatedly" (above) so as to reinforce the point that these operations happen for each instance of the split message found in the source message e.g. for each &lt;orderItem&gt; in an &lt;order&gt; message.
</p><p>As for points #1 and #2 above specifically, Smooks offers to approaches to creating the split messages:
</p>
<ol><li> A basic (untransformed/unenriched) fragment split and bind.  This is a very simple configuration that simply serializes a message fragment (repeatedly) to its XML form and stores it in the bean context as a String.
</li><li> A more complex approach using the Java Binding and Templating Cartridges, where you configure Smooks to extract data from the source message and and into the bean context (using &lt;jb:bean&gt; configs) and then (optionally) apply templates to create the split messages.  This is more complex, but offers the following advantages:
<ul><li> Allows for transformation of the split fragments i.e. not just XML as with the basic option.
</li><li> Allows for enrichment of the message.
</li><li> Allows for more complex splits, with the ability to merge data from multiple source fragments into each split message e.g. not just the &lt;orderItem&gt; fragments, but the order &lt;header&gt; info too.
</li><li> Allows for splitting and routing of Java Objects as the Split messages (e.g. over JMS).
</li></ul>
</li></ol>
<p>With the more complex approach outlined above, the key to processing huge messages (not an issue for the more basic approach) is to make sure that you always maintain a small memory footprint. You can do this using the Javabean Cartridge by making sure you're only binding the most relevant message data (into the bean context) at any one time. In the following sections, the examples are all based on splitting and routing of order-items out of an order message. The solutions shown all work for huge messages because the Smooks Javabean Cartridge binding configurations are implemented such that the only data held in memory at any given time is the main order details (order header etc) and the "current" order item details.
</p>
<a name="Basic_Splitting_and_Routing"></a><h4> <span class="mw-headline">Basic Splitting and Routing</span></h4>
<p>As stated above, the easiest way to split and route fragments of a message is to use the basic &lt;frag:serialize&gt; and &lt;*:router&gt; components (&lt;jms:router&gt;, &lt;file:router&gt; etc) from the Routing Cartridge.  The &lt;frag:serialize&gt; component has its own configuration in the <a href="http://www.milyn.org/xsd/smooks/fragment-routing-1.2.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/fragment-routing-1.2.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/fragment-routing-1.2.xsd</a> namespace.
</p><p>The following is an example for serializing the contents of a SOAP message body and storing it in the Bean Context under the beanId of "soapBody":
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:frag</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/fragment-routing-1.2.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;frag:serialize</span> <span style="color: #000066;">fragment</span>=<span style="color: #ff0000;">"Envelope/Body"</span> <span style="color: #000066;">bindTo</span>=<span style="color: #ff0000;">"soapBody"</span> <span style="color: #000066;">childContentOnly</span>=<span style="color: #ff0000;">"true"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Then the Smooks code for executing this:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>configStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>JavaResult javaResult <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>soapMessageStream<span style="color: #009900;">)</span>, javaResult<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> bodyContent <span style="color: #339933;">=</span> javaResult.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"soapBody"</span><span style="color: #009900;">)</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">trim</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>And of course, you can do all of this programmatically too (i.e. no need for the XML config):
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">addVisitor</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> FragmentSerializer<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">setBindTo</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"soapBody"</span><span style="color: #009900;">)</span>, <span style="color: #0000ff;">"Envelope/Body"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>JavaResult javaResult <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>soapMessageStream<span style="color: #009900;">)</span>, javaResult<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> bodyContent <span style="color: #339933;">=</span> javaResult.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"soapBody"</span><span style="color: #009900;">)</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">trim</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>The code snippets above only show how to create the split messages and bind them into the bean context, from where they can be accessed.  How about routing these split messages to another endpoint for processing?  Well it's easy, just use one of the routing components as outlined in the following sections.
</p><p>The following is a quick example, showing the config for routing split messages (this time &lt;order-item&gt; fragments) to a JMS Destination for processing:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:frag</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/fragment-routing-1.2.xsd"</span> <span style="color: #000066;">xmlns:jms</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/jms-routing-1.2.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Create the split messages for the order items... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;frag:serialize</span> <span style="color: #000066;">fragment</span>=<span style="color: #ff0000;">"order-items/order-item"</span> <span style="color: #000066;">bindTo</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Route each order items split mesage to the orderItem JMS processing queue... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jms:router</span> <span style="color: #000066;">routeOnElement</span>=<span style="color: #ff0000;">"order-items/order-item"</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">destination</span>=<span style="color: #ff0000;">"orderItemProcessingQueue"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>For more details on the JMS routing aspects of the above example, see the JMS Router documentation (below).  The &lt;jms:router&gt; could be substituted for any of the other routers e.g. if using with JBoss ESB, you could use the &lt;esbr:routeBean&gt; configuration to route the split message to any ESB endpoint.
</p>
<a name="Routing_to_File"></a><h4> <span class="mw-headline">Routing to File</span></h4>
<p>File based routing is performed via the the <b>&lt;file:outputStream&gt;</b> configuration from the <a href="http://www.milyn.org/xsd/smooks/file-routing-1.1.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/file-routing-1.1.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/file-routing-1.1.xsd</a> configuration namespace.
</p><p>This section illustrates how you can combine the following Smooks functionality to split a message out into smaller messages on the file system.
</p>
<ol><li> The <b>Javabean Cartridge</b> for extracting data from the message and holding it in variables in the bean context. In this case, we could also use DOM NodeModels for capturing the order and order-item data to be used as the templating data models.
</li><li> The <b>&lt;file:outputStream&gt;</b> configuration from the <b>Routing Cartridge</b> for managing file system streams (naming, opening, closing, throttling creation etc).
</li><li> The <b>Templating Cartridge</b> (FreeMarker Templates) for generating the individual split messages from data bound in the bean context by the Javabean Cartridge (see #1 above). The templating result is written to the file output stream (#2 above).
</li></ol>
<p>In the example, we want to process a huge order message and route the individual order item details to file. The following illustrates what we want to achieve. As you can see, the split messages don't just contain data from the order item fragments. They also contain data from the order header and root elements.
</p><p><a href="http://smooks.org/mediawiki/index.php?title=Image:File-split-required.png" class="image" title="Image:file-split-required.png"><img alt="Image:file-split-required.png" src="./User-Guide_files/File-split-required.png" width="736" height="416" border="0"></a>
</p><p>To achieve this with Smooks, we assemble the following Smooks configuration:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.3.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:file</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/file-routing-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:ftl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>        <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">        Filter the message using the SAX Filter (i.e. not DOM, so no</span><br><span style="color: #808080; font-style: italic;">        intermediate DOM, so we can process huge messages...</span><br><span style="color: #808080; font-style: italic;">        --&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:filterSettings</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"SAX"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>        <span style="color: #808080; font-style: italic;">&lt;!-- Extract and decode data from the message. Used in the freemarker template (below).</span><br><span style="color: #808080; font-style: italic;">               Note that we could also use a NodeModel here... --&gt;</span><br>(1)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.Hashtable"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order/@id"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerNumber"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer/@number"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerName"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"orderItem"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>(2)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.Hashtable"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"itemId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/@id"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"productId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/product"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/quantity"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Double"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/price"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>        <span style="color: #808080; font-style: italic;">&lt;!-- Create/open a file output stream. This is writen to by the freemarker template (below).. --&gt;</span><br>(3)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;file:outputStream</span> <span style="color: #000066;">openOnElement</span>=<span style="color: #ff0000;">"order-item"</span> <span style="color: #000066;">resourceName</span>=<span style="color: #ff0000;">"orderItemSplitStream"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;file:fileNamePattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>order-${order.orderId}-${order.orderItem.itemId}.xml<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/file:fileNamePattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;file:destinationDirectoryPattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>target/orders<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/file:destinationDirectoryPattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;file:listFileNamePattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>order-${order.orderId}.lst<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/file:listFileNamePattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;file:highWaterMark</span> <span style="color: #000066;">mark</span>=<span style="color: #ff0000;">"10"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/file:outputStream<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>        <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">        Every time we hit the end of an &lt;order-item&gt; element, apply this freemarker template,</span><br><span style="color: #808080; font-style: italic;">        outputting the result to the "orderItemSplitStream" OutputStream, which is the file</span><br><span style="color: #808080; font-style: italic;">        output stream configured above.</span><br><span style="color: #808080; font-style: italic;">        --&gt;</span><br>(4)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>target/classes/orderitem-split.ftl<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:use<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>                <span style="color: #808080; font-style: italic;">&lt;!-- Output the templating result to the "orderItemSplitStream" file output stream... --&gt;</span><br>                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:outputTo</span> <span style="color: #000066;">outputStreamResource</span>=<span style="color: #ff0000;">"orderItemSplitStream"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:use<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Smooks Resource configuration #1 and #2 define the Java Bindings for extracting the order header information (config #1) and the order-item information (config #2). This is the key to processing a huge message; making sure that we only have the current order item in memory at any one time. The Smooks Javabean Cartridge manages all this for you, creating and recreating the orderItem beans as the &lt;order-item&gt; fragments are being processed.
</p><p>The <b>&lt;file:outputStream&gt;</b> configuration in configuration #3 manages the generation of the files on the file system. As you can see from the configuration, the file names can be dynamically constructed from data in the bean context. You can also see that it can throttle the creation of the files via the "highWaterMark" configuration parameter. This helps you manage file creation so as not to overwhelm the target file system.
</p><p>Smooks Resource configuration #4 defines the FreeMarker templating resource used to write the split messages to the OutputStream created by the &lt;file:outputStream&gt; (config #3). See how config #4 references the &lt;file:outputStream&gt; resource. The Freemarker temaplte is as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;orderitem</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">"${.vars["</span>order-item<span style="color: #ff0000;">"].@id}"</span> <span style="color: #000066;">order</span>=<span style="color: #ff0000;">"${order.@id}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>${order.header.customer}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;number<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>${order.header.customer.@number}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/number<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;details<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;productId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>${.vars["order-item"].product}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/productId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>${.vars["order-item"].quantity}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/quantity<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>${.vars["order-item"].price}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/price<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/details<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/orderitem<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<a name="Routing_to_JMS"></a><h4> <span class="mw-headline">Routing to JMS</span></h4>
<p>JMS routing is performed via the the <b>&lt;<a href="http://www.milyn.org/xsd/smooks/jms-routing-1.2.xsd" class="external text" title="http://www.milyn.org/xsd/smooks/jms-routing-1.2.xsd" rel="nofollow">jms:router</a>&gt;</b> configuration from the <a href="http://www.milyn.org/xsd/smooks/jms-routing-1.2.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/jms-routing-1.2.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/jms-routing-1.2.xsd</a> configuration namespace.
</p><p>The following is an example &lt;<a href="http://www.milyn.org/xsd/smooks/jms-routing-1.2.xsd" class="external text" title="http://www.milyn.org/xsd/smooks/jms-routing-1.2.xsd" rel="nofollow">jms:router</a>&gt; configuration that routes an "orderItem_xml" bean to a JMS Queue named "smooks.exampleQueue" (also read the "Routing to File" example):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:core</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/smooks-core-1.3.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jms</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/jms-routing-1.2.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:ftl</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>        <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">        Filter the message using the SAX Filter (i.e. not DOM, so no</span><br><span style="color: #808080; font-style: italic;">        intermediate DOM, so we can process huge messages...</span><br><span style="color: #808080; font-style: italic;">        --&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;core:filterSettings</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"SAX"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br>(1)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource-config</span> <span style="color: #000066;">selector</span>=<span style="color: #ff0000;">"order,order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.milyn.delivery.DomModelCreator<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>(2)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jms:router</span> <span style="color: #000066;">routeOnElement</span>=<span style="color: #ff0000;">"order-item"</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem_xml"</span> <span style="color: #000066;">destination</span>=<span style="color: #ff0000;">"smooks.exampleQueue"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jms:message<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>                <span style="color: #808080; font-style: italic;">&lt;!-- Need to use special FreeMarker variable ".vars" --&gt;</span><br>                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jms:correlationIdPattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>${order.@id}-${.vars["order-item"].@id}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jms:correlationIdPattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jms:message<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jms:highWaterMark</span> <span style="color: #000066;">mark</span>=<span style="color: #ff0000;">"3"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jms:router<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>(3)     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:freemarker</span> <span style="color: #000066;">applyOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>            <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">            Note in the template that we need to use the special FreeMarker variable ".vars"</span><br><span style="color: #808080; font-style: italic;">            because of the hyphenated variable names ("order-item"). See http://freemarker.org/docs/ref_specvar.html.</span><br><span style="color: #808080; font-style: italic;">            --&gt;</span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>/orderitem-split.ftl<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:use<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>                <span style="color: #808080; font-style: italic;">&lt;!-- Bind the templating result into the bean context, from where</span><br><span style="color: #808080; font-style: italic;">                it can be accessed by the JMSRouter (configured above). --&gt;</span><br>                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ftl:bindTo</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">"orderItem_xml"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:use<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ftl:freemarker<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>In this case, we route the result of a FreeMarker templating operation to the JMS Queue (i.e. as a String). We could also have routed a full Object Model, in which case it would be routed as a Serialized ObjectMessage.
</p>
<a name="Routing_to_a_Database_using_SQL"></a><h4> <span class="mw-headline">Routing to a Database using SQL</span></h4>
<p>Routing to a Database is also quite easy. Please read the "Routing to File" section above before reading this section.
</p><p>So we take the same scenario as with the File Routing example above, but this time we want to route the order and order item data to a Database. This is what we want to achieve:
</p><p><a href="http://smooks.org/mediawiki/index.php?title=Image:Db-split-required.png" class="image" title="Image:db-split-required.png"><img alt="Image:db-split-required.png" src="./User-Guide_files/Db-split-required.png" width="696" height="396" border="0"></a>
</p><p>First we need to define a set of Java bindings that extract the order and order-item data from the data stream:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> </span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Extract the order data... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"order"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.Hashtable"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"orderId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order/@id"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerNumber"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer/@number"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"customerName"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"header/customer"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Extract the order-item data... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"orderItem"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.Hashtable"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"order-item"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"itemId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/@id"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"productId"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Long"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/product"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"quantity"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Integer"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/quantity"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"price"</span> <span style="color: #000066;">decoder</span>=<span style="color: #ff0000;">"Double"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"order-item/price"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Next we need to define datasource configuration and a number of &lt;db:executor&gt; configurations that will use that datasource to insert the data that was bound into the Java Object model into the database.
</p><p>The Datasource configuration (namespace <a href="http://www.milyn.org/xsd/smooks/datasource-1.3.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/datasource-1.3.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/datasource-1.3.xsd</a>) for retrieving direct database connection:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:ds</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/datasource-1.3.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ds:direct</span> <span style="color: #000066;">bindOnElement</span>=<span style="color: #ff0000;">"#document"</span></span><br><span style="color: #009900;">            <span style="color: #000066;">datasource</span>=<span style="color: #ff0000;">"DBExtractTransformLoadDS"</span></span><br><span style="color: #009900;">            <span style="color: #000066;">driver</span>=<span style="color: #ff0000;">"org.hsqldb.jdbcDriver"</span></span><br><span style="color: #009900;">            <span style="color: #000066;">url</span>=<span style="color: #ff0000;">"jdbc:hsqldb:hsql://localhost:9201/milyn-hsql-9201"</span></span><br><span style="color: #009900;">            <span style="color: #000066;">username</span>=<span style="color: #ff0000;">"sa"</span></span><br><span style="color: #009900;">            <span style="color: #000066;">password</span>=<span style="color: #ff0000;">""</span></span><br><span style="color: #009900;">            <span style="color: #000066;">autoCommit</span>=<span style="color: #ff0000;">"false"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>or it is possible to use a JNDI datasource for retrieving a database connection:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:ds</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/datasource-1.3.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- This JNDI datasource can handle JDBC and JTA transactions or </span><br><span style="color: #808080; font-style: italic;">           it can leave the transaction managment to an other external component.</span><br><span style="color: #808080; font-style: italic;">           An external component could be an other Smooks visitor, the EJB transaction manager</span><br><span style="color: #808080; font-style: italic;">           or you can do it your self. --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ds:JNDI</span></span><br><span style="color: #009900;">        <span style="color: #000066;">bindOnElement</span>=<span style="color: #ff0000;">"#document"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">datasource</span>=<span style="color: #ff0000;">"DBExtractTransformLoadDS"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">datasourceJndi</span>=<span style="color: #ff0000;">"java:/someDS"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">transactionManager</span>=<span style="color: #ff0000;">"JTA"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">transactionJndi</span>=<span style="color: #ff0000;">"java:/mockTransaction"</span></span><br><span style="color: #009900;">        <span style="color: #000066;">targetProfile</span>=<span style="color: #ff0000;">"jta"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The datasource schema describes and documents how you can configure the datasource.
</p><p>The &lt;db:executor&gt; configurations (namespace <a href="http://www.milyn.org/xsd/smooks/db-routing-1.1.xsd" class="external free" title="http://www.milyn.org/xsd/smooks/db-routing-1.1.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks/db-routing-1.1.xsd</a>):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span></span><br><span style="color: #009900;">                      <span style="color: #000066;">xmlns:db</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/db-routing-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Assert whether it's an insert or update. Need to do this just before we do the insert/update... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;db:executor</span> <span style="color: #000066;">executeOnElement</span>=<span style="color: #ff0000;">"order-items"</span> <span style="color: #000066;">datasource</span>=<span style="color: #ff0000;">"DBExtractTransformLoadDS"</span> <span style="color: #000066;">executeBefore</span>=<span style="color: #ff0000;">"true"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;db:statement<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>select OrderId from ORDERS where OrderId = ${order.orderId}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/db:statement<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;db:resultSet</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"orderExistsRS"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/db:executor<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- If it's an insert (orderExistsRS.isEmpty()), insert the order before we process the order items... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;db:executor</span> <span style="color: #000066;">executeOnElement</span>=<span style="color: #ff0000;">"order-items"</span> <span style="color: #000066;">datasource</span>=<span style="color: #ff0000;">"DBExtractTransformLoadDS"</span> <span style="color: #000066;">executeBefore</span>=<span style="color: #ff0000;">"true"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;condition<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>orderExistsRS.isEmpty()<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/condition<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;db:statement<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>INSERT INTO ORDERS VALUES(${order.orderId}, ${order.customerNumber}, ${order.customerName})<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/db:statement<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/db:executor<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- And insert each orderItem... --&gt;</span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;db:executor</span> <span style="color: #000066;">executeOnElement</span>=<span style="color: #ff0000;">"order-item"</span> <span style="color: #000066;">datasource</span>=<span style="color: #ff0000;">"DBExtractTransformLoadDS"</span> <span style="color: #000066;">executeBefore</span>=<span style="color: #ff0000;">"false"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;condition<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>orderExistsRS.isEmpty()<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/condition<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;db:statement<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>INSERT INTO ORDERITEMS VALUES (${orderItem.itemId}, ${order.orderId}, ${orderItem.productId}, ${orderItem.quantity}, ${orderItem.price})<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/db:statement<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/db:executor<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!-- Ignoring updates for now!! --&gt;</span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Check out the db-extract-transform-load example.
</p>
<a name="Message_Splitting_.26_Routing"></a><h2> <span class="mw-headline">Message Splitting &amp; Routing</span></h2>
<p>Please refer to the <a href="#Splitting_.26_Routing" title="">Splitting &amp; Routing</a> section in the previous section.
</p>
<a name="Extending_Smooks"></a><h1> <span class="mw-headline">Extending Smooks</span></h1>
<p>All existing  Smooks functionality (Java Binding, EDI processing etc) is built through extension of a number of well defined APIs.  We will look at these APIs in the coming sections.
</p><p>The main extension points/APIs in Smooks are:
</p>
<ol><li> <b>Reader APIs</b>:  Those for processing Source/Input data (Readers) so as to make it consumable by other Smooks components as a series of well defined hierarchical events (based on the SAX event model) for all of the message fragments and sub-fragments.
</li><li> <b>Visitor APIs</b>: Those for consuming the message fragment SAX Events produced by a Source/Input Reader.
</li></ol>
<p>Another very important aspect of writing Smooks extensions is how these components are configured.  Because this is common to all Smooks components, we will look at this first.
</p>
<a name="Configuring_Smooks_Components"></a><h2> <span class="mw-headline">Configuring Smooks Components</span></h2>
<p>All Smooks components are configured in exactly the same way.  As far as the Smooks Core code is concerned, all Smooks components are "resources" and are configured via a SmooksResourceConfiguration instance, which we talked about in earlier sections.
</p><p>Smooks provides mechanisms for constructing namespace (XSD) specific XML configurations for components, but the most basic configuration (and the one that maps directly to the SmooksResourceConfiguration class) is the basic &lt;resource-config&gt; XML configuration from the base configuration namespace (<a href="http://www.milyn.org/xsd/smooks-1.1.xsd" class="external free" title="http://www.milyn.org/xsd/smooks-1.1.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks-1.1.xsd</a>).
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource-config</span> <span style="color: #000066;">selector</span>=<span style="color: #ff0000;">""</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">""</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Where:
</p>
<ul><li> The <b>selector</b> attribute is the mechanism by which the resource is "selected" e.g. can be an XPath for a <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementation.  We'll see more of this in the coming sections.
</li><li> The <b>resource</b> element is the actual resource.  This can be a Java Class name or some other form of resource (such as a template).  For the purposes of this section however, lets just assume the resource to by a Java Class name.
</li><li> The <b>param</b> elements are configuration parameters for the resource defined in the resource element.
</li></ul>
<p>Smooks takes care of all the details of creating the runtime representation of the resource (e.g. constructing the class named in the the resource element) and injecting all the configuration parameters.  It also works out what the resource type is, and from that, how to interpret things like the selector e.g. if the resource is a <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> instance, it knows the selector is an XPath, selecting a Source message fragment.
</p>
<a name="Configuration_Annotations"></a><h3> <span class="mw-headline">Configuration Annotations</span></h3>
<p>After your component has been created, you need to configure it with the &lt;param&gt; element details.  This is done using the <i>@ConfigParam</i> and <i>@Config</i> Annotations.
</p>
<a name=".40ConfigParam"></a><h4> <span class="mw-headline"> @ConfigParam</span></h4>
<p>The <i>ConfigParam</i> annotation reflectively injects the named parameter (from the &lt;param&gt; elements) having the same name as the annotated property itself (the name can actually be different, but by default, it matches against the name of the component property).
</p><p>Suppose we have a component as follows:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> DataSeeder <span style="color: #009900;">{</span><br>&nbsp;<br>    @ConfigParam<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Afile+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">File</span></a> seedDataFile<span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Afile+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">File</span></a> getSeedDataFile<span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        <span style="color: #000000; font-weight: bold;">return</span> seedDataFile<span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// etc...</span><br><span style="color: #009900;">}</span></pre>
<p>We configure this component in Smooks as follows:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource-config</span> <span style="color: #000066;">selector</span>=<span style="color: #ff0000;">"dataSeeder"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.acme.DataSeeder<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"seedDataFile"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>./seedData.xml<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>This annotation eliminates a lot of noisy code from your component because it:
</p>
<ul><li> Handles decoding of the &lt;param&gt; value before setting it on the annotated component property.  Smooks provides DataDecoders for all of the main types (int, Double, File, Enums etc), but you can implement and use a custom DataDecoder where the out of the box decoders don't cover specific decoding requirements e.g. <i>@ConfigParam(decoder = MyQuirkyDataDecoder.class)</i>.  Smooks will automatically use your custom decoder (i.e. you won't need to define the decoder property on this annotation) if it is registered.  See the DataDecoder Javadocs for details on registering a DataDecoder implementation such that Smooks will automatically locate it for decoding a specific data type.
</li><li> Supports a "choice" constraint for the config property, generating a configuration exception where the configured value is not one of the defined choice values.  For example, you may have a property which has a constrained value set of "ON" and "OFF".  You can use the choice property on this annotation to constrain the config, raise exceptions etc e.g. <i>@ConfigParam(choice = {"ON", "OFF"})</i>.
</li><li> Can specify default config values e.g. <i>@ConfigParam(defaultVal = "true")</i>.
</li><li> Can specify whether or not the property config value is required or optional e.g. <i>@ConfigParam(use = Use.OPTIONAL)</i>.  By default, all properties are <i>REQUIRED</i>, but setting a <i>defaultVal</i> implicitly marks the property as being <i>OPTIONAL</i>.
</li></ul>
<a name=".40Config"></a><h4> <span class="mw-headline">@Config</span></h4>
<p>The <i>Config</i> annotation reflectively injects the full <i>SmooksResourceConfiguration</i> instance, associated with the component resource, onto the annotated component property.  Obviously an error will result if this annotation is added to a component property that is not of type <i>SmooksResourceConfiguration</i>.
</p><p>Example:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MySmooksComponent <span style="color: #009900;">{</span><br>&nbsp;<br>    @Config<br>    <span style="color: #000000; font-weight: bold;">private</span> SmooksResourceConfiguration config<span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// etc...</span><br><span style="color: #009900;">}</span></pre>
<a name=".40Initialize_and_.40Uninitialize"></a><h4> <span class="mw-headline">@Initialize and @Uninitialize</span></h4>
<p>The <i>@ConfigParam</i> annotation is great for configuring your component with simple values, but sometimes your component needs more involved configuration for which we need to write some "initialization" code.  For this, Smooks provides the <i>@Initialize</i> annotation.
</p><p>On the other side of this, there are times when we need to undo work performed during initialization when the associated Smooks instance is being discarded (garbage collected) e.g. to release some resources acquired during initialization etc.  For this, Smooks provides the <i>@Uninitialize</i> annotation.
</p><p>The basic initialization/uninitialization sequence can be described as follows:
</p>
<pre class="java" style="font-family:monospace;">smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>..<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// Initialize all annotated components</span><br>    @Initialize<br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// Use the smooks instance through a series of filterSource invocations...</span><br>        smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>...<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>...<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>...<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        ... <span style="color: #006633;">etc</span> ...<br>&nbsp;<br><span style="color: #006633;">smooks</span>.<span style="color: #006633;">close</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// Uninitialize all annotated components</span><br>    @Uninitialize</pre>
<p>In the following example, lets assume we have a component that opens multiple connections to a database on initialization and then needs to release all those database resources when we close the Smooks instance.
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MultiDataSourceAccessor <span style="color: #009900;">{</span><br>&nbsp;<br>    @ConfigParam<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Afile+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">File</span></a> dataSourceConfig<span style="color: #339933;">;</span><br>&nbsp;<br>    Map<span style="color: #339933;">&lt;</span>String, Datasource<span style="color: #339933;">&gt;</span> datasources <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> HashMap<span style="color: #339933;">&lt;</span>String, Datasource<span style="color: #339933;">&gt;</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    @Initialize<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> createDataSources<span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        <span style="color: #666666; font-style: italic;">// Add DS creation code here....</span><br>        <span style="color: #666666; font-style: italic;">// Read the dataSourceConfig property to read the DS configs...</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    @Uninitialize<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> releaseDataSources<span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        <span style="color: #666666; font-style: italic;">// Add DS release code here....</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// etc...</span><br><span style="color: #009900;">}</span></pre>
<p><b>Notes</b>:
</p>
<ul><li> The <i>@Initialize</i> and <i>@Uninitialize</i> methods must be public, zero-arg methods.
</li><li> The <i>@ConfigParam</i> properties are all initialized before the first <i>@Initialize</i> method is called.  Therefore, you can use the <i>@ConfigParam</i> component properties as input to the initialization process.
</li><li> The <i>@Uninitialize</i> methods are all called in response to a call to the <i>Smooks.close</i> method.
</li></ul>
<a name="Defining_Custom_Configuration_Namespaces"></a><h3> <span class="mw-headline">Defining Custom Configuration Namespaces</span></h3>
<p>Smooks supports a mechanism for defining custom configuration namespaces for components.  This allows you to support custom, XSD based (validatable), configurations for your components Vs treating them all as vanilla Smooks resources via the &lt;resource-config&gt; base configuration.
</p><p>The basic process involves:
</p>
<ol><li> Writing an configuration XSD for your component that extends the base <a href="http://www.milyn.org/xsd/smooks-1.1.xsd" class="external free" title="http://www.milyn.org/xsd/smooks-1.1.xsd" rel="nofollow">http://www.milyn.org/xsd/smooks-1.1.xsd</a> configuration namespace.  This XSD must be supplied on the classpath with your component.  It must be located in the <i>/META-INF</i> folder and have the same path as the namespace URI.  For example, if your extended namespace URI is "<a href="http://www.acme.com/schemas/smooks/acme-core-1.0.xsd" class="external free" title="http://www.acme.com/schemas/smooks/acme-core-1.0.xsd" rel="nofollow">http://www.acme.com/schemas/smooks/acme-core-1.0.xsd</a>", then the physical XSD file must be supplied on the classpath in "/META-INF/schemas/smooks/acme-core-1.0.xsd".
</li><li> Writing a Smooks configuration namespace mapping configuration file that maps the custom namespace configuration into a <i>SmooksResourceConfiguration</i> instance.  This file must be named (by convention) based on the name of the namespace it is mapping and must be physically located on the classpath in the same folder as the XSD.  Extending the above example, the Smooks mapping file would be "/META-INF/schemas/smooks/acme-core-1.0.xsd-smooks.xml".  Note the "-smooks.xml" postfix.
</li></ol>
<p>The easiest way to get familiar with this mechanism is by looking at existing extended namespace configurations within the Smooks code itself.  All Smooks components (including e.g. the Java Binding functionality) use this mechanism for defining their configurations.  Smooks Core itself defines a number of extended configuration namesaces, <a href="https://github.com/smooks/smooks/smooks-core/src/main/resources/META-INF/xsd/smooks/" class="external text" title="https://github.com/smooks/smooks/smooks-core/src/main/resources/META-INF/xsd/smooks/" rel="nofollow">as can be seen in the source</a>.
</p>
<a name="Implementing_a_Source_Reader"></a><h2> <span class="mw-headline">Implementing a Source Reader</span></h2>
<p>Implementing and configuring a new Source Reader for Smooks is straightforward.  The Smooks specific parts of the process are easy and are not really the issue.  The level of effort involved is a function of the complexity of the Source data format for which you are implementing the reader.
</p><p>Implementing a Reader for your custom data format immediately opens all Smooks capabilities to that data format e.g. Java Binding, Templating, Persistence, Validation, Splitting &amp; Routing etc.  So a relatively small investment can yield a quite significant return.  The only requirement, from a Smooks perspective, is that the Reader implements the standard <a href="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/XMLReader.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/XMLReader.html" rel="nofollow">org.xml.sax.XMLReader</a> interface from the Java JDK.  However, if you want to be able to configure the Reader implementation, it needs to implement the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/xml/SmooksXMLReader.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/xml/SmooksXMLReader.html" rel="nofollow">org.milyn.xml.SmooksXMLReader</a> interface (which is just an extension of <a href="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/XMLReader.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/XMLReader.html" rel="nofollow">org.xml.sax.XMLReader</a>).  So, you can easily use (or extend) an existing <a href="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/XMLReader.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/XMLReader.html" rel="nofollow">org.xml.sax.XMLReader</a> implementation, or implement a new Reader from scratch.
</p><p>Let's now look at a simple example of implementing a Reader for use with Smooks.  In this example, we will implement a Reader that can read a stream of Comma Separated Value (CSV) records, converting the CSV stream into a stream of SAX events that can be processed by Smooks, allowing you to do all the things Smooks allows (Java Binding etc).
</p><p>We start by implementing the basic Reader class:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyCSVReader <span style="color: #000000; font-weight: bold;">implements</span> SmooksXMLReader <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// Implement all of the XMLReader methods...</span><br><span style="color: #009900;">}</span></pre>
<p>Two methods from the <i><a href="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/XMLReader.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/XMLReader.html" rel="nofollow">XMLReader</a></i> interface are of particular interest:
</p>
<ul><li> <b>setContentHandler(ContentHandler)</b>:  This method is called by Smooks Core.  It sets the  <i><a href="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/ContentHandler.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/ContentHandler.html" rel="nofollow">ContentHandler</a></i> instance for the reader.  The <i><a href="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/ContentHandler.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/ContentHandler.html" rel="nofollow">ContentHandler</a></i> instance methods are called from inside the <i>parse(InputSource)</i> method.
</li><li> <b>parse(InputSource)</b>:  This is the method that receives the Source data input stream, parses it (i.e. in the case of this example, the CSV stream) and generates the SAX event stream through calls to the <i><a href="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/ContentHandler.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/ContentHandler.html" rel="nofollow">ContentHandler</a></i> instance supplied in the <i>setContentHandler(ContentHandler)</i> method.
</li></ul>
<p>We need to configure our CSV reader with the names of the fields associated with the CSV records.  Configuring a custom reader implementation is the same as for any Smooks component, as described in the <a href="#Configuring_Smooks_Components" title="">Configuring Smooks Components</a> section above.
</p><p>So focusing a little more closely on the above methods and our fields configuration:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyCSVReader <span style="color: #000000; font-weight: bold;">implements</span> SmooksXMLReader <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Acontenthandler+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">ContentHandler</span></a> contentHandler<span style="color: #339933;">;</span><br>&nbsp;<br>    @ConfigParam<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a><span style="color: #009900;">[</span><span style="color: #009900;">]</span> fields<span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// Auto decoded and injected from the "fields" &lt;param&gt; on the reader config.</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setContentHandler<span style="color: #009900;">(</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Acontenthandler+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">ContentHandler</span></a> contentHandler<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">contentHandler</span> <span style="color: #339933;">=</span> contentHandler<span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> parse<span style="color: #009900;">(</span>InputSource csvInputSource<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a>, SAXException <span style="color: #009900;">{</span><br>        <span style="color: #666666; font-style: italic;">// TODO: Implement parsing of CSV Stream...</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// Other XMLReader methods...</span><br><span style="color: #009900;">}</span></pre>
<p>So now we have our basic Reader implementation stub.  We can start writing unit tests to test the new reader implementation.
</p><p>First thing we need is some sample CSV input.  Lets use a simple list of names:
</p><p>(<i>names.csv</i>)
</p>
<pre class="text" style="font-family:monospace;">Tom,Fennelly<br>Mike,Fennelly<br>Mark,Jones</pre>
<p>Second thing we need is a test Smooks configuration to configure Smooks with our MyCSVReader.  As stated before, everything in Smooks is a resource and can be configured with the basic &lt;resource-config&gt; configuration.  While this works fine, it's a little noisy, so Smooks provides a basic &lt;reader&gt; configuration element specifically for the purpose of configuring a reader.  The configuration for our test looks like the following:
</p><p>(<i>mycsvread-config.xml</i>)
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;reader</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.MyCSVReader"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    	    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"fields"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>firstname,lastname<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>And of course we need the JUnit test class:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyCSVReaderTest <span style="color: #000000; font-weight: bold;">extends</span> TestCase <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> test<span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>getClass<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"mycsvread-config.xml"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        StringResult serializedCSVEvents <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> StringResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>getClass<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"names.csv"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>, serializedCSVEvents<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Asystem+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">System</span></a>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">(</span>serializedCSVEvents<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// TODO: add assertions etc</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<p>So now we have a basic setup with our custom Reader implementation, as well as a unit test that we can use to drive our development.  Of course, our reader <i>parse</i> method is not doing anything yet and our test class is not making any assertions etc.  So lets start implementing the <i>parse</i> method:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyCSVReader <span style="color: #000000; font-weight: bold;">implements</span> SmooksXMLReader <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Acontenthandler+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">ContentHandler</span></a> contentHandler<span style="color: #339933;">;</span><br>&nbsp;<br>    @ConfigParam<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a><span style="color: #009900;">[</span><span style="color: #009900;">]</span> fields<span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// Auto decoded and injected from the "fields" &lt;param&gt; on the reader config.</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setContentHandler<span style="color: #009900;">(</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Acontenthandler+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">ContentHandler</span></a> contentHandler<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">contentHandler</span> <span style="color: #339933;">=</span> contentHandler<span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> parse<span style="color: #009900;">(</span>InputSource csvInputSource<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a>, SAXException <span style="color: #009900;">{</span><br>        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Abufferedreader+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">BufferedReader</span></a> csvRecordReader <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Abufferedreader+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">BufferedReader</span></a><span style="color: #009900;">(</span>csvInputSource.<span style="color: #006633;">getCharacterStream</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> csvRecord<span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// Send the start of message events to the handler...</span><br>        contentHandler.<span style="color: #006633;">startDocument</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        contentHandler.<span style="color: #006633;">startElement</span><span style="color: #009900;">(</span>XMLConstants.<span style="color: #006633;">NULL_NS_URI</span>, <span style="color: #0000ff;">"message-root"</span>, <span style="color: #0000ff;">""</span>, <span style="color: #000000; font-weight: bold;">new</span> AttributesImpl<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        csvRecord <span style="color: #339933;">=</span> csvRecordReader.<span style="color: #006633;">readLine</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        <span style="color: #000000; font-weight: bold;">while</span><span style="color: #009900;">(</span>csvRecord <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>            <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a><span style="color: #009900;">[</span><span style="color: #009900;">]</span> fieldValues <span style="color: #339933;">=</span> csvRecord.<span style="color: #006633;">split</span><span style="color: #009900;">(</span><span style="color: #0000ff;">","</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>            <span style="color: #666666; font-style: italic;">// perform checks...</span><br>&nbsp;<br>            <span style="color: #666666; font-style: italic;">// Send the events for this record...</span><br>            contentHandler.<span style="color: #006633;">startElement</span><span style="color: #009900;">(</span>XMLConstants.<span style="color: #006633;">NULL_NS_URI</span>, <span style="color: #0000ff;">"record"</span>, <span style="color: #0000ff;">""</span>, <span style="color: #000000; font-weight: bold;">new</span> AttributesImpl<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>            <span style="color: #000000; font-weight: bold;">for</span><span style="color: #009900;">(</span><span style="color: #000066; font-weight: bold;">int</span> i <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> fields.<span style="color: #006633;">length</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>                contentHandler.<span style="color: #006633;">startElement</span><span style="color: #009900;">(</span>XMLConstants.<span style="color: #006633;">NULL_NS_URI</span>, fields<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span>, <span style="color: #0000ff;">""</span>, <span style="color: #000000; font-weight: bold;">new</span> AttributesImpl<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>                contentHandler.<span style="color: #006633;">characters</span><span style="color: #009900;">(</span>fieldValues<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span>.<span style="color: #006633;">toCharArray</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span>, <span style="color: #cc66cc;">0</span>, fieldValues<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span>.<span style="color: #006633;">length</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>                contentHandler.<span style="color: #006633;">endElement</span><span style="color: #009900;">(</span>XMLConstants.<span style="color: #006633;">NULL_NS_URI</span>, fields<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span>, <span style="color: #0000ff;">""</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>            <br>            <span style="color: #009900;">}</span><br>            contentHandler.<span style="color: #006633;">endElement</span><span style="color: #009900;">(</span>XMLConstants.<span style="color: #006633;">NULL_NS_URI</span>, <span style="color: #0000ff;">"record"</span>, <span style="color: #0000ff;">""</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>            <br>&nbsp;<br>            csvRecord <span style="color: #339933;">=</span> csvRecordReader.<span style="color: #006633;">readLine</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>    <br>        <span style="color: #009900;">}</span><br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// Send the end of message events to the handler...</span><br>        contentHandler.<span style="color: #006633;">endElement</span><span style="color: #009900;">(</span>XMLConstants.<span style="color: #006633;">NULL_NS_URI</span>, <span style="color: #0000ff;">"message-root"</span>, <span style="color: #0000ff;">""</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        contentHandler.<span style="color: #006633;">endDocument</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// Other XMLReader methods...</span><br><span style="color: #009900;">}</span></pre>
<p>If you run the unit test class now, you should see the following output on the console (formatted):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;message-root<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Tom<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Fennelly<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Mike<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Fennelly<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Mark<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/firstname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Jones<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/lastname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/record<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/message-root<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>After this, it's just a case of expanding the tests, hardening the reader implementation code etc.
</p><p>Now you can use your reader to perform all sorts of operations supported by Smooks.  As an example, the following configuration could be used to bind the names into a List of PersonName objects:
</p><p><i>(java-binding-config.xml)</i>
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:jb</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/javabean-1.4.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;reader</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.MyCSVReader"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    	    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"fields"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>firstname,lastname<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"peopleNames"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"java.util.ArrayList"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"message-root"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:wiring</span> <span style="color: #000066;">beanIdRef</span>=<span style="color: #ff0000;">"personName"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:bean</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"personName"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.PersonName"</span> <span style="color: #000066;">createOnElement</span>=<span style="color: #ff0000;">"message-root/record"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"first"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"record/firstname"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;jb:value</span> <span style="color: #000066;">property</span>=<span style="color: #ff0000;">"last"</span> <span style="color: #000066;">data</span>=<span style="color: #ff0000;">"record/lastname"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/jb:bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>And then a test for this configuration could look as follows:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyCSVReaderTest <span style="color: #000000; font-weight: bold;">extends</span> TestCase <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> test_java_binding<span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br>        Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>getClass<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"java-binding-config.xml"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        JavaResult javaResult <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>getClass<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"names.csv"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>, javaResult<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        List<span style="color: #339933;">&lt;</span>PersonName<span style="color: #339933;">&gt;</span> peopleNames <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>List<span style="color: #339933;">&lt;</span>PersonName<span style="color: #339933;">&gt;</span><span style="color: #009900;">)</span> javaResult.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"peopleNames"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// TODO: add assertions etc</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<p>For more on Java Binding, see the <a href="#Java_Binding" title="">Java Binding</a> section.
</p><p><b>Tips</b>:
</p>
<ul><li> Reader instances are never used concurrently.  Smooks Core will create a new instance for every message, or, will pool and reuse instances as per the <a href="#Filter_Settings" title=""><i>readerPoolSize</i> FilterSettings property</a>.
</li><li> If your Reader requires access to the Smooks ExecutionContext for the current filtering context, your Reader needs to implement the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/xml/SmooksXMLReader.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/xml/SmooksXMLReader.html" rel="nofollow">SmooksXMLReader</a> interface.
</li><li> If your Source data is a binary data stream your Reader must implement the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/StreamReader.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/StreamReader.html" rel="nofollow">StreamReader</a> interface. See next section.
</li><li> You can programmatically configure your reader (e.g. in your unit tests) using a <i>GenericReaderConfigurator</i> instance, which you then set on the <i>Smooks</i> instance.
</li><li> While the basic &lt;reader&gt; configuration is fine, it's possible to define a custom configuration namespace (XSD) for your custom CSV Reader implementation.  This topic is not covered here.  Review the source code to see the extended configuration namespace for the Reader implementations suppled with Smooks (out of the box) e.g. the EDIReader, CSVReader, JSONReader etc.  From this, you should be able to work out how to do this for your own custom Reader.
</li></ul>
<a name="Implementing_a_Binary_Source_Reader"></a><h3> <span class="mw-headline">Implementing a Binary Source Reader</span></h3>
<p>Prior to Smooks v1.5, binary readers needed to implement the <i>StreamReader</i> interface.  This is no longer a requirement.  All <i>XMLReader</i> instances receive an <i>InputSource</i> (to their parse method) that contains an <i>InputStream</i> if the <i>InputStream</i> was provided in the <i>StreamSource</i> passed in the <i>Smooks.filterSource</i> method call.  This means that all <i>XMLReader</i> instance are guaranteed to receive an <i>InputStream</i> if one is available, so no need to mark the <i>XMLReader</i> instance.
</p><p><br>
</p>
<a name="Implementing_a_Flat_File_Source_Reader"></a><h3> <span class="mw-headline">Implementing a Flat File Source Reader</span></h3>
<p>In Smooks v1.5 we tried to make it a little easier to implement a custom reader for reading flat file data formats.  By flat file we mean "record" based data formats, where the data in the message is structured in flat records as opposed to a more hierarchical structure.  Examples of this would be Comma Separated Value (CSV) and Fixed Length Field (FLF).  The new API introduced in Smooks v1.5 should remove the complexity of the XMLReader API (as outlined above).
</p><p><br>
The API is composed of 2 interfaces plus a number of support classes.  These interfaces work as a pair.  They need to be implemented if you wish to use this API for processing a custom Flat File format not already supported by Smooks.
</p><p><br>
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #008000; font-style: italic; font-weight: bold;">/**<br> * {@link RecordParser} factory class.<br> * &lt;p/&gt;<br> * Configurable by the Smooks {@link org.milyn.cdr.annotation.Configurator}<br> */</span><br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> RecordParserFactory <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #008000; font-style: italic; font-weight: bold;">/**<br>     * Create a new Flat File {@link RecordParser} instance.<br>     * @return A new {@link RecordParser} instance.<br>     */</span><br>    RecordParser newRecordParser<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br><span style="color: #009900;">}</span><br>&nbsp;<br>&nbsp;<br><span style="color: #008000; font-style: italic; font-weight: bold;">/**<br> * Flat file Record Parser.<br> */</span><br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> RecordParser<span style="color: #339933;">&lt;</span>T <span style="color: #000000; font-weight: bold;">extends</span> RecordParserFactory<span style="color: #339933;">&gt;</span>  <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #008000; font-style: italic; font-weight: bold;">/**<br>     * Set the parser factory that created the parser instance.<br>     * @param factory The parser factory that created the parser instance.<br>     */</span><br>    <span style="color: #000066; font-weight: bold;">void</span> setRecordParserFactory<span style="color: #009900;">(</span>T factory<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #008000; font-style: italic; font-weight: bold;">/**<br>     * Set the Flat File data source on the parser.<br>     * @param source The flat file data source.<br>     */</span><br>    <span style="color: #000066; font-weight: bold;">void</span> setDataSource<span style="color: #009900;">(</span>InputSource source<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #008000; font-style: italic; font-weight: bold;">/**<br>     * Parse the next record from the message stream and produce a {@link Record} instance.<br>     * @return The records instance.<br>     * @throws IOException Error reading message stream.<br>     */</span><br>    Record nextRecord<span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a><span style="color: #339933;">;</span><br>&nbsp;<br><span style="color: #009900;">}</span></pre>
<p><br>
Obviously the <i>RecordParserFactory</i> implementation is responsible for creating the <i>RecordParser</i> instances for the Smooks runtime.  The <i>RecordParserFactory</i> is the class that Smooks configures, so it is in here you place all your <i>@ConfigParam</i> details.  The created <i>RecordParser</i> instances are supplied with a reference to the <i>RecordParserFactory</i> instance that created them, so it is easy enough the provide them with access to the configuration via getters on the <i>RecordParserFactory</i> implementation.
</p><p><br>
The <i>RecordParser</i> implementation is responsible for parsing out each <i>Records</i> (a <i>Record</i> contains a set of <i>Fields</i>) in the <i>nextRecord()</i> method.  Each instance is supplied with the <i>Reader</i> to the message stream via the <i>setReader(Reader)</i> method.  The <i>RecordParser</i> should store a reference to this <i>Reader</i> and use it in the <i>nextRecord()</i> method.  A new instance of a given <i>RecordParser</i> implementation is created for each message being filtered by Smooks.
</p><p><br>
Configuring your implementation in the Smooks configuration is as simple as the following:
</p><p><br>
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:ff</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/flatfile-1.5.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ff:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"first,second,third"</span> <span style="color: #000066;">parserFactory</span>=<span style="color: #ff0000;">"com.acme.ARecordParserFactory"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"aConfigParameter"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>aValue<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"bConfigParameter"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>bValue<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/params<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ff:reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br>    <span style="color: #808080; font-style: italic;">&lt;!--</span><br><span style="color: #808080; font-style: italic;">        Other Smooks configurations e.g. &lt;jb:bean&gt; configurations</span><br><span style="color: #808080; font-style: italic;">    --&gt;</span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
The Flat File configuration also supports basic Java binding configurations, inlined in the reader configuration.
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:ff</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/flatfile-1.5.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ff:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname,lastname,gender,age,country"</span> <span style="color: #000066;">parserFactory</span>=<span style="color: #ff0000;">"com.acme.PersonRecordParserFactory"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #808080; font-style: italic;">&lt;!-- The field names must match the property names on the Person class. --&gt;</span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ff:listBinding</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"people"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.Person"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ff:reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p><br>
To execute this configuration:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>configStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>messageReader<span style="color: #009900;">)</span>, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>List<span style="color: #339933;">&lt;</span>Person<span style="color: #339933;">&gt;</span><span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"people"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><br>
Smooks also supports creation of Maps from the record set:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:ff</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks/flatfile-1.5.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ff:reader</span> <span style="color: #000066;">fields</span>=<span style="color: #ff0000;">"firstname,lastname,gender,age,country"</span> <span style="color: #000066;">parserFactory</span>=<span style="color: #ff0000;">"com.acme.PersonRecordParserFactory"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ff:mapBinding</span> <span style="color: #000066;">beanId</span>=<span style="color: #ff0000;">"people"</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">"com.acme.Person"</span> <span style="color: #000066;">keyField</span>=<span style="color: #ff0000;">"firstname"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ff:reader<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>The above configuration would produce a Map of Person instances, keyed by the "firstname" value of each Person.  It would be executed as follows:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>configStream<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>JavaResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaResult<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>messageReader<span style="color: #009900;">)</span>, result<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>Map<span style="color: #339933;">&lt;</span>String, Person<span style="color: #339933;">&gt;</span> people <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>Map<span style="color: #339933;">&lt;</span>String, Person<span style="color: #339933;">&gt;</span><span style="color: #009900;">)</span> result.<span style="color: #006633;">getBean</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"people"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>Person tom <span style="color: #339933;">=</span> people.<span style="color: #006633;">get</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"Tom"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>Person mike <span style="color: #339933;">=</span> people.<span style="color: #006633;">get</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"Mike"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><a href="#Virtual_Object_Models_.28Maps_.26_Lists.29" title="">Virtual Models</a> are also supported, so you can define the <b>class</b> attribute as a java.util.Map and have the record field values bound into Map instances, which are in turn added to a List or a Map.
</p><p><br>
</p>
<a name="VariableFieldRecordParser_and_VariableFieldRecordParserFactory"></a><h4> <span class="mw-headline">VariableFieldRecordParser and VariableFieldRecordParserFactory</span></h4>
<p>VariableFieldRecordParser and VariableFieldRecordParserFactory are abstract implementations of the <i>RecordParser</i> and <i>RecordParserFactory</i> interface.  They provide very useful base implementations for a Flat File Reader, providing base support for:
</p><p><br>
</p>
<ul><li> The utility java binding configurations as outlined in the previous section.
</li><li> Support for "variable field" records i.e. a flat file message that contains multiple record definitions.  The different records are identified by the value of the first field in the record and are defined as follows: <i>fields="book[name,author] | magazine[*]"</i>.  Note the record definitions are pipe separated.  "book" records will have a first field value of "book" while "magazine" records will have a first field value of "magazine".  Astrix ("*") as the field definition for a record basically tells the reader to generate the field names in the generated events (e.g. "field_0", "field_1" etc).
</li><li> The ability to read the next record chunk, with support for a simple record delimiter, or a regular expression (regex) pattern that marks the beginning of each record.
</li></ul>
<p><br>
The CSV and Regex readers are implemented using these abstract classes.  See the <a href="https://github.com/smooks/smooks/tree/v1.5.1/smooks-examples/csv-variable-record/" class="external text" title="https://github.com/smooks/smooks/tree/v1.5.1/smooks-examples/csv-variable-record/" rel="nofollow">csv-variable-record</a> and <a href="https://github.com/smooks/smooks/tree/v1.5.1/smooks-examples/flatfile-to-xml-regex/" class="external text" title="https://github.com/smooks/smooks/tree/v1.5.1/smooks-examples/flatfile-to-xml-regex/" rel="nofollow">flatfile-to-xml-regex</a> examples.  The <a href="https://github.com/smooks/smooks/tree/v1.5.1/smooks-cartridges/flatfile/src/main/java/org/milyn/flatfile/regex" class="external text" title="https://github.com/smooks/smooks/tree/v1.5.1/smooks-cartridges/flatfile/src/main/java/org/milyn/flatfile/regex" rel="nofollow">Regex Reader</a> implementation is also a good example that can be used as a basis for your own custom flat file reader.
</p>
<a name="Implementing_a_Fragment_Visitor"></a><h2> <span class="mw-headline">Implementing a Fragment Visitor</span></h2>
<p><a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementations are the workhorse of Smooks.  Most of the out-of-the-box functionality in Smooks (Java Binding, Templating, Persistence etc) was created by creating one or more <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementations.  <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementations often collaborate through the ExecutionContext and ApplicationContext context objects, accomplishing a common goal by working together.
</p><p>Smooks supports two types of <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementation:
</p>
<ol><li> <b>SAX</b> based implementations based on the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXVisitor.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXVisitor.html" rel="nofollow">SAXVisitor</a> sub-interfaces.
</li><li> <b>DOM</b> based implementations based on the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/dom/DOMVisitor.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/dom/DOMVisitor.html" rel="nofollow">DOMVisitor</a> sub-interfaces.
</li></ol>
<p>Your implementation can support both SAX and DOM, but in general, we recommend people to stick with implementing a SAX only <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a>.  As yet, we have not found a use case that could not be solved through the SAX based implementations, while at the same time, the SAX based implementations are usually easier to create, and offer clear advantages in terms of performance.  For this reason, we will concentrate on the SAX only here.
</p>
<dl><dd> <b>Note</b>: All <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementations are treated as stateless objects.  A single <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> instance must be usable concurrently across multiple messages i.e. across multiple concurrent calls to the <i>Smooks.filterSource</i> method.  All state associated with the current <i>Smooks.filterSource</i> execution must be stored in the <i>ExecutionContext</i>.  For more details see the <a href="#ExecutionContext_and_ApplicationContex" title="">ExecutionContext and ApplicationContex</a> section.
</dd></dl>
<a name="The_SAX_Visitor_API"></a><h3> <span class="mw-headline">The SAX Visitor API</span></h3>
<p>The SAX Visitor API is made up of a number of interfaces.  These interfaces are based on the <a href="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/ContentHandler.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/ContentHandler.html" rel="nofollow">SAX events</a> that a SAXVisitor implementation can capture and processes.  Depending on the use case being solved with the SAXVisitor implementation, you may need to implement one or all of these interfaces.
</p><p><b><a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXVisitBefore.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXVisitBefore.html" rel="nofollow">SAXVisitBefore</a></b>:  Captures the <i>startElement</i> SAX event for the targeted fragment element:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> SAXVisitBefore <span style="color: #000000; font-weight: bold;">extends</span> SAXVisitor <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000066; font-weight: bold;">void</span> visitBefore<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a><span style="color: #339933;">;</span><br><span style="color: #009900;">}</span></pre>
<p><b><a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXVisitChildren.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXVisitChildren.html" rel="nofollow">SAXVisitChildren</a></b>:  Captures the <i>character</i> based SAX events for the targeted fragment element, as well as Smooks generated (pseudo) events corresponding to the <i>startElement</i> events of child fragment elements:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> SAXVisitChildren <span style="color: #000000; font-weight: bold;">extends</span> SAXVisitor <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000066; font-weight: bold;">void</span> onChildText<span style="color: #009900;">(</span>SAXElement element, SAXText childText, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #000066; font-weight: bold;">void</span> onChildElement<span style="color: #009900;">(</span>SAXElement element, SAXElement childElement, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a><span style="color: #339933;">;</span><br><span style="color: #009900;">}</span></pre>
<p><b><a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXVisitAfter.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXVisitAfter.html" rel="nofollow">SAXVisitAfter</a></b>:  Captures the <i>endElement</i> SAX event for the targeted fragment element:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> SAXVisitAfter <span style="color: #000000; font-weight: bold;">extends</span> SAXVisitor <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000066; font-weight: bold;">void</span> visitAfter<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a><span style="color: #339933;">;</span><br><span style="color: #009900;">}</span></pre>
<p>As a convenience for those implementations that need to capture all of the SAX events, the above three interfaces are pulled together into a single interface in the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXElementVisitor.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXElementVisitor.html" rel="nofollow">SAXElementVisitor</a> interface.
</p><p>Illustrating these events using a piece of XML:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;message<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;target-fragment<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>      <span style="color: #009900;">&lt;--- SAXVisitBefore.visitBefore</span><br><span style="color: #009900;">        Text!!                       &lt;--- SAXVisitChildren.onChildText  </span><br><span style="color: #009900;">        <span style="color: #000000; font-weight: bold;">&lt;child<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>                      <span style="color: #009900;">&lt;--- SAXVisitChildren.onChildElement</span><br><span style="color: #009900;">        <span style="color: #000000; font-weight: bold;">&lt;/child<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>                 <br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/target-fragment<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>     <span style="color: #009900;">&lt;--- SAXVisitAfter.visitAfter</span><br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/message<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<dl><dd> <b>Note</b>: <i>Of course, the above is just an illustration of a Source message event stream and it looks like XML, but could be EDI, CSV, JSON etc.  Think of this as just an XML serialization of a Source message event stream, serialized as XML for easy reading.</i>
</dd></dl>
<p><b><a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXElement.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXElement.html" rel="nofollow">SAXElement</a></b>:  As can be seen from the above SAX interfaces, the <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXElement.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXElement.html" rel="nofollow">SAXElement</a> type is passed in all method calls.  This object contains details about the targeted fragment element, including attributes and their values.  It also contains methods for managing text accumulation, as well as accessing the <i>Writer</i> associated with any <i>StreamResult</i> instance that may have been passed in the <i>Smooks.filterSource(Source, Result)</i> method call.  We'll see more on text accumulation and <i>StreamResult</i> writing in the coming sections.
</p>
<a name="Text_Accumulation"></a><h3> <span class="mw-headline">Text Accumulation</span></h3>
<p>SAX is a stream based processing model.  It doesn't create a Document Object Model (DOM) of any form.  It doesn't "accumulate" event data in any way.  This is why it is a suitable processing model for processing huge message streams.
</p><p>The <a href="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXElement.html" class="external text" title="http://www.milyn.org/javadoc/v1.3/smooks/org/milyn/delivery/sax/SAXElement.html" rel="nofollow">SAXElement</a> will always contain attribute data associated with the targeted element, but will not contain the fragment child text data, whose SAX events (<i>SAXVisitChildren.onChildText</i>) occur between the <i>SAXVisitBefore.visitBefore</i> and <i>SAXVisitAfter.visitAfter</i> events (see above illustration).  The text events are not accumulated on the <i>SAXElement</i> because, as already stated, that could result in a significant performance drain.  Of course the downside to this is the fact that if your <i>SAXVisitor</i> implementation needs access to the text content of a fragment, you need to explicitly tell Smooks to <b>accumulate text</b> for the targeted fragment.  This is done by calling the <i>SAXElement.accumulateText</i> method from inside the <i>SAXVisitBefore.visitBefore</i> method implementation  of your <i>SAXVisitor</i>:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyVisitor <span style="color: #000000; font-weight: bold;">implements</span> SAXVisitBefore, SAXVisitAfter <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitBefore<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        element.<span style="color: #006633;">accumulateText</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitAfter<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> fragmentText <span style="color: #339933;">=</span> element.<span style="color: #006633;">getTextContent</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// ... etc ...</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<p>Of course, it's a bit ugly having to implement <i>SAXVisitBefore.visitBefore</i> just to tell Smooks to accumulate the text events for the targeted fragment.  For that reason, we have the <i>@TextConsumer</i> annotation that can be used to annotate your <i>SAXVisitor</i> implementation, removing the need to implement the <i>SAXVisitBefore.visitBefore</i> method:
</p>
<pre class="java" style="font-family:monospace;">@TextConsumer<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyVisitor <span style="color: #000000; font-weight: bold;">implements</span> SAXVisitAfter <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitAfter<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> fragmentText <span style="color: #339933;">=</span> element.<span style="color: #006633;">getTextContent</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// ... etc ...</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<p>Note that all of the fragment text will not be available until the <i>SAXVisitAfter.visitAfter</i> event.
</p>
<a name="StreamResult_Writing.2FSerialization"></a><h3> <span class="mw-headline">StreamResult Writing/Serialization</span></h3>
<p>The <i>Smooks.filterSource(Source, Result)</i> method can take one or more of a number of different <i>Result</i> type implementations, one of which is the <i><a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a></i> class (see <a href="#Multiple_Outputs.2FResults" title="">Multiple Outputs/Results</a>).  By default, Smooks will always serialize the full Source event stream as XML to any <i><a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a></i> instance provided to the <i>Smooks.filterSource(Source, Result)</i> method.
</p><p>So, if the Source provided to the <i>Smooks.filterSource(Source, Result)</i> method is an XML stream and a <i><a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a></i> instance is provided as one of the <i>Result</i> instances, the Source XML will be written out to the <i><a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a></i> unmodified, unless the Smooks instance is configured with one or more <i>SAXVisitor</i> implementations that modify one or more fragments.  In other words, Smooks streams the Source in and back out again through the <i><a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" class="external text" title="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/stream/StreamResult.html" rel="nofollow">StreamResult</a></i> instance.  This <b>default serialization</b> behavior can be turned on/off by <a href="#Filter_Settings" title="">configuring the filter settings</a>.
</p><p>If you want to modify the serialized form of one of the message fragments (i.e. "transform"), you need to implement a <i>SAXVisitor</i> to do so and target it at the message fragment using an XPath-like expression.
</p>
<dl><dd> <b>Note</b>: <i>Of course, you can also modify the serialized form of a message fragment using one of the out-of-the-box <a href="#Templating" title="">Templating</a> components.  These components are also </i>SAXVisitor<i> implementations.</i>
</dd></dl>
<p>The key to implementing a <i>SAXVisitor</i> geared towards transforming the serialized form of a fragment is telling Smooks that the <i>SAXVisitor</i> implementation in question will be writing to the <i>StreamResult</i>.  You need to tell Smooks this because Smooks supports targeting of multiple <i>SAXVisitor</i> implementations at a single fragment, but only one <i>SAXVisitor</i> is allowed to write to the <i>StreamResult</i>, per fragment.  If a second <i>SAXVisitor</i> attempts to write to the <i>StreamResult</i>, a <i>SAXWriterAccessException</i> will result and you will need to modify your Smooks configuration.
</p><p>In order to be "the one" that writes to the <i>StreamResult</i>, the <i>SAXVisitor</i> needs to <b>acquire ownership</b> of the <i>Writer</i> to the <i>StreamResult</i>.  It does this by simply making a call to the <i>SAXElement.getWriter(SAXVisitor)</i> method from inside the <i>SAXVisitBefore.visitBefore</i> methods implementation, passing <i>this</i> as the <i>SAXVisitor</i> parameter:
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyVisitor <span style="color: #000000; font-weight: bold;">implements</span> SAXElementVisitor <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitBefore<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Awriter+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Writer</span></a> writer <span style="color: #339933;">=</span> element.<span style="color: #006633;">getWriter</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">this</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// ... write the start of the fragment...</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> onChildText<span style="color: #009900;">(</span>SAXElement element, SAXText childText, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span>        <br>        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Awriter+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Writer</span></a> writer <span style="color: #339933;">=</span> element.<span style="color: #006633;">getWriter</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">this</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// ... write the child text...</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> onChildElement<span style="color: #009900;">(</span>SAXElement element, SAXElement childElement, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitAfter<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Awriter+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Writer</span></a> writer <span style="color: #339933;">=</span> element.<span style="color: #006633;">getWriter</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">this</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// ... close the fragment...</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<dl><dd> <b>Note</b>: If you need to control serialization of sub-fragments you need to reset the <i>Writer</i> instance so as to divert serialization of the sub-fragments.  You do this by calling <i>SAXElement.setWriter</i>.
</dd></dl>
<p>Sometimes you know that the target fragment you are serializing/transforming will never have sub-fragments.  In this situation, it's a bit ugly to have to implement the <i>SAXVisitBefore.visitBefore</i> method just to make a call to the <i>SAXElement.getWriter</i> method to acquire ownership of the <i>Writer</i>.  For this reason, we have the <i>@StreamResultWriter</i> annotation.  Used in combination with the <i>@TextConsumer</i> annotation, we can remove the need to implement all but the <i>SAXVisitAfter.visitAfter</i> method:
</p>
<pre class="java" style="font-family:monospace;">@TextConsumer<br>@StreamResultWriter<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyVisitor <span style="color: #000000; font-weight: bold;">implements</span> SAXVisitAfter <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitAfter<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Awriter+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Writer</span></a> writer <span style="color: #339933;">=</span> element.<span style="color: #006633;">getWriter</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">this</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        <span style="color: #666666; font-style: italic;">// ... serialize to the writer ...</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<a name="SAXToXMLWriter"></a><h4> <span class="mw-headline">SAXToXMLWriter</span></h4>
<p>Smooks provides the <i>SAXToXMLWriter</i> class to make serializing of <i>SAXElement</i> data, as XML, a little easier.  This class allows you to write a <i>SAXVisitor</i> implementation like:
</p>
<pre class="java" style="font-family:monospace;">@StreamResultWriter<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyVisitor <span style="color: #000000; font-weight: bold;">implements</span> SAXElementVisitor <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">private</span> SAXToXMLWriter xmlWriter <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SAXToXMLWriter<span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">this</span>, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitBefore<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        xmlWriter.<span style="color: #006633;">writeStartElement</span><span style="color: #009900;">(</span>element<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> onChildText<span style="color: #009900;">(</span>SAXElement element, SAXText childText, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        xmlWriter.<span style="color: #006633;">writeText</span><span style="color: #009900;">(</span>childText, element<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> onChildElement<span style="color: #009900;">(</span>SAXElement element, SAXElement childElement, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>    <span style="color: #009900;">}</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitAfter<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        xmlWriter.<span style="color: #006633;">writeEndElement</span><span style="color: #009900;">(</span>element<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<p>You may have noticed that the second argument in the <i>SAXToXMLWriter</i> constructor is a boolean.  This is the <i>encodeSpecialChars</i> arg and should be set based on the <i>rewriteEntities</i> <a href="#Filter_Settings" title="">filter setting</a>.  Smooks provides a small code optimization/assist here.  If you move the <i>@StreamResultWriter</i> annotation from the class and onto the <i>SAXToXMLWriter</i> instance declaration, Smooks will create the <i>SAXToXMLWriter</i> instance and initialize it with the <i>rewriteEntities</i> <a href="#Filter_Settings" title="">filter setting</a> for the associated Smooks instance:
</p>
<pre class="java" style="font-family:monospace;">@TextConsumer<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyVisitor <span style="color: #000000; font-weight: bold;">implements</span> SAXVisitAfter <span style="color: #009900;">{</span><br>&nbsp;<br>    @StreamResultWriter<br>    <span style="color: #000000; font-weight: bold;">private</span> SAXToXMLWriter xmlWriter<span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitAfter<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        xmlWriter.<span style="color: #006633;">writeStartElement</span><span style="color: #009900;">(</span>element<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        xmlWriter.<span style="color: #006633;">writeText</span><span style="color: #009900;">(</span>element<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        xmlWriter.<span style="color: #006633;">writeEndElement</span><span style="color: #009900;">(</span>element<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<a name="Visitor_Configuration"></a><h3> <span class="mw-headline">Visitor Configuration</span></h3>
<p><i>SAXVisitor</i> configuration works in exactly the same way as any other Smooks component.  See <a href="#Configuring_Smooks_Components" title="">Configuring Smooks Components</a>.
</p><p>The most important thing to note with respect to configuring of Smooks <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> instances is the fact that the configuration <i>selector</i> is interpreted as an XPath (like) expression.  For more on this see the docs on <a href="#Selectors" title="">Selectors</a>.
</p><p>Also note that <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> instances can be programatically configured on a Smooks instance.  Among other things, this is very useful for unit testing.
</p>
<a name="Example_Visitor_Configuration"></a><h4> <span class="mw-headline">Example Visitor Configuration</span></h4>
<p>Lets assume we have a very simple <i>SAXVisitor</i> implementation as follows:
</p>
<pre class="java" style="font-family:monospace;">@TextConsumer<br><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> ChangeItemState <span style="color: #000000; font-weight: bold;">implements</span> SAXVisitAfter <span style="color: #009900;">{</span><br>&nbsp;<br>    @StreamResultWriter<br>    <span style="color: #000000; font-weight: bold;">private</span> SAXToXMLWriter xmlWriter<span style="color: #339933;">;</span><br>&nbsp;<br>    @ConfigParam<br>    <span style="color: #000000; font-weight: bold;">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">String</span></a> newState<span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> visitAfter<span style="color: #009900;">(</span>SAXElement element, ExecutionContext executionContext<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">throws</span> SmooksException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">IOException</span></a> <span style="color: #009900;">{</span><br>        element.<span style="color: #006633;">setAttribute</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"state"</span>, newState<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        xmlWriter.<span style="color: #006633;">writeStartElement</span><span style="color: #009900;">(</span>element<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        xmlWriter.<span style="color: #006633;">writeText</span><span style="color: #009900;">(</span>element<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>        xmlWriter.<span style="color: #006633;">writeEndElement</span><span style="color: #009900;">(</span>element<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>    <span style="color: #009900;">}</span><br><span style="color: #009900;">}</span></pre>
<p>Declaratively configuring <i>ChangeItemState</i> to fire on &lt;order-item&gt; fragments having a status of "OK" is as simple as:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource-config</span> <span style="color: #000066;">selector</span>=<span style="color: #ff0000;">"order-items/order-item[@status = 'OK']"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.acme.ChangeItemState <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;param</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">"newState"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>COMPLETED<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/param<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>Of course it would be really nice to be able to define a cleaner and more strongly typed configuration for the <i>ChangeItemState</i> component, such that it could be configured something like:
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;smooks-resource-list</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://www.milyn.org/xsd/smooks-1.1.xsd"</span> <span style="color: #000066;">xmlns:order</span>=<span style="color: #ff0000;">"http://www.acme.com/schemas/smooks/order.xsd"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br>&nbsp;<br>    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;order:changeItemState</span> <span style="color: #000066;">itemElement</span>=<span style="color: #ff0000;">"order-items/order-item[@status = 'OK']"</span> <span style="color: #000066;">newState</span>=<span style="color: #ff0000;">"COMPLETED"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span><br>&nbsp;<br><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/smooks-resource-list<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<p>For details on this, see the section on <a href="#Defining_Custom_Configuration_Namespaces" title="">Defining Custom Configuration Namespaces</a>.
</p><p>This Visitor could also be programmatically configured on a Smooks as follows:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">addVisitor</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> ChangeItemState<span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #006633;">setNewState</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"COMPLETED"</span><span style="color: #009900;">)</span>, <span style="color: #0000ff;">"order-items/order-item[@status = 'OK']"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> StreamSource<span style="color: #009900;">(</span>inReader<span style="color: #009900;">)</span>, <span style="color: #000000; font-weight: bold;">new</span> StreamResult<span style="color: #009900;">(</span>outWriter<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<a name="Visitor_Instance_Lifecycle"></a><h3> <span class="mw-headline">Visitor Instance Lifecycle</span></h3>
<p>One aspect of Visitor lifecycle has already been discussed in the general context of Smooks component <a href="#.40Initialize_and_.40Uninitialize" title="">initialization and uninitialization</a>.
</p><p>Smooks supports two additional component lifecycle events, specific to <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> components, via the <i>ExecutionLifecycleCleanable</i> and <i>VisitLifecycleCleanable</i> interfaces.
</p>
<a name="ExecutionLifecycleCleanable"></a><h4> <span class="mw-headline">ExecutionLifecycleCleanable</span></h4>
<p><a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> components implementing this lifecycle interface will be able to perform post <i>Smooks.filterSource</i> lifecycle operations.
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> ExecutionLifecycleCleanable <span style="color: #000000; font-weight: bold;">extends</span> Visitor <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">abstract</span> <span style="color: #000066; font-weight: bold;">void</span> executeExecutionLifecycleCleanup<span style="color: #009900;">(</span>ExecutionContext executionContext<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br><span style="color: #009900;">}</span></pre>
<p>The basic call sequence can be described as follows (note the executeExecutionLifecycleCleanup calls):
</p>
<pre class="java" style="font-family:monospace;">smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span>..<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>        smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>...<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>            <span style="color: #339933;">**</span> VisitorXX.<span style="color: #006633;">executeExecutionLifecycleCleanup</span> <span style="color: #339933;">**</span><br>        smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>...<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>            <span style="color: #339933;">**</span> VisitorXX.<span style="color: #006633;">executeExecutionLifecycleCleanup</span> <span style="color: #339933;">**</span><br>        smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>...<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>            <span style="color: #339933;">**</span> VisitorXX.<span style="color: #006633;">executeExecutionLifecycleCleanup</span> <span style="color: #339933;">**</span><br>        ... <span style="color: #006633;">etc</span> ...</pre>
<p>This lifecycle method allows you to ensure that resources scoped around the <i>Smooks.filterSource</i> execution lifecycle can be cleaned up for the associated <i>ExecutionContext</i>.
</p>
<a name="VisitLifecycleCleanable"></a><h4> <span class="mw-headline"> VisitLifecycleCleanable </span></h4>
<p><a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> components implementing this lifecycle interface will be able to perform post <i>SAXVisitAfter.visitAfter</i> lifecycle operations.
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> VisitLifecycleCleanable <span style="color: #000000; font-weight: bold;">extends</span> Visitor <span style="color: #009900;">{</span><br>&nbsp;<br>    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">abstract</span> <span style="color: #000066; font-weight: bold;">void</span> executeVisitLifecycleCleanup<span style="color: #009900;">(</span>ExecutionContext executionContext<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br><span style="color: #009900;">}</span></pre>
<p>The basic call sequence can be described as follows (note the executeVisitLifecycleCleanup calls):
</p>
<pre class="java" style="font-family:monospace;">smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>...<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #339933;">&lt;</span>message<span style="color: #339933;">&gt;</span><br>        <span style="color: #339933;">&lt;</span>target<span style="color: #339933;">-</span>fragment<span style="color: #339933;">&gt;</span>      <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">visitBefore</span><br>            Text<span style="color: #339933;">!!</span>                       <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">onChildText</span>  <br>            <span style="color: #339933;">&lt;</span>child<span style="color: #339933;">&gt;</span>                      <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">onChildElement</span><br>            <span style="color: #339933;">&lt;/</span>child<span style="color: #339933;">&gt;</span>                 <br>        <span style="color: #339933;">&lt;/</span>target<span style="color: #339933;">-</span>fragment<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">visitAfter</span><br>        <span style="color: #339933;">**</span> VisitorXX.<span style="color: #006633;">executeVisitLifecycleCleanup</span> <span style="color: #339933;">**</span><br>        <span style="color: #339933;">&lt;</span>target<span style="color: #339933;">-</span>fragment<span style="color: #339933;">&gt;</span>      <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">visitBefore</span><br>            Text<span style="color: #339933;">!!</span>                       <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">onChildText</span>  <br>            <span style="color: #339933;">&lt;</span>child<span style="color: #339933;">&gt;</span>                      <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">onChildElement</span><br>            <span style="color: #339933;">&lt;/</span>child<span style="color: #339933;">&gt;</span>                 <br>        <span style="color: #339933;">&lt;/</span>target<span style="color: #339933;">-</span>fragment<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">visitAfter</span><br>        <span style="color: #339933;">**</span> VisitorXX.<span style="color: #006633;">executeVisitLifecycleCleanup</span> <span style="color: #339933;">**</span><br>    <span style="color: #339933;">&lt;/</span>message<span style="color: #339933;">&gt;</span><br>    VisitorXX.<span style="color: #006633;">executeExecutionLifecycleCleanup</span><br>&nbsp;<br>smooks.<span style="color: #006633;">filterSource</span><span style="color: #009900;">(</span>...<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #339933;">&lt;</span>message<span style="color: #339933;">&gt;</span><br>        <span style="color: #339933;">&lt;</span>target<span style="color: #339933;">-</span>fragment<span style="color: #339933;">&gt;</span>      <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">visitBefore</span><br>            Text<span style="color: #339933;">!!</span>                       <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">onChildText</span>  <br>            <span style="color: #339933;">&lt;</span>child<span style="color: #339933;">&gt;</span>                      <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">onChildElement</span><br>            <span style="color: #339933;">&lt;/</span>child<span style="color: #339933;">&gt;</span>                 <br>        <span style="color: #339933;">&lt;/</span>target<span style="color: #339933;">-</span>fragment<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">visitAfter</span><br>        <span style="color: #339933;">**</span> VisitorXX.<span style="color: #006633;">executeVisitLifecycleCleanup</span> <span style="color: #339933;">**</span><br>        <span style="color: #339933;">&lt;</span>target<span style="color: #339933;">-</span>fragment<span style="color: #339933;">&gt;</span>      <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">visitBefore</span><br>            Text<span style="color: #339933;">!!</span>                       <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">onChildText</span>  <br>            <span style="color: #339933;">&lt;</span>child<span style="color: #339933;">&gt;</span>                      <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">onChildElement</span><br>            <span style="color: #339933;">&lt;/</span>child<span style="color: #339933;">&gt;</span>                 <br>        <span style="color: #339933;">&lt;/</span>target<span style="color: #339933;">-</span>fragment<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;---</span> VisitorXX.<span style="color: #006633;">visitAfter</span><br>        <span style="color: #339933;">**</span> VisitorXX.<span style="color: #006633;">executeVisitLifecycleCleanup</span> <span style="color: #339933;">**</span><br>    <span style="color: #339933;">&lt;/</span>message<span style="color: #339933;">&gt;</span><br>    VisitorXX.<span style="color: #006633;">executeExecutionLifecycleCleanup</span></pre>
<p>This lifecycle method allows you to ensure that resources scoped around a single fragment execution of a SAXVisitor implementation can be cleaned up for the associated <i>ExecutionContext</i>.
</p>
<a name="ExecutionContext_and_ApplicationContext"></a><h3> <span class="mw-headline">ExecutionContext and ApplicationContext</span></h3>
<p>Smooks provides these two Context objects for storing of state information.
</p><p>The <i>ExecutionContext</i> is scoped specifically around a single execution of a <i>Smooks.filterSource</i> method.  All Smooks <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementations must be stateless within the context of a single <i>Smooks.filterSource</i> execution, allowing the <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> implementation to be used across multiple concurrent executions of the <i>Smooks.filterSource</i> method.  All data stored in an <i>ExecutionContext</i> instance will be lost on completion of the 'Smooks.filterSource<i> execution.  The </i>ExecutionContext<i> is supplied in all <a href="http://smooks.org/mediawiki/index.php?title=Visitor" title="Visitor">Visitor</a> API message event calls.</i>
</p><p>The <i>ApplicationContext</i> is scoped around the associated <i>Smooks</i> instance i.e. only one <i>ApplicationContext</i> instance exists per <i>Smooks</i> instance.  This context object can be used to store data that needs to be maintained (and accessible) across multiple 'Smooks.filterSource<i> executions.  Components (any component, including </i>SAXVisitor<i> components) can gain access to their associated </i>ApplicationContext<i> instance by declaring an </i>ApplicationContext<i> class property and annotating it with the </i>@AppContext<i> annotation:</i>
</p>
<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MySmooksComponent <span style="color: #009900;">{</span><br>&nbsp;<br>    @AppContext<br>    <span style="color: #000000; font-weight: bold;">private</span> ApplicationContext appContext<span style="color: #339933;">;</span><br>&nbsp;<br>    <span style="color: #666666; font-style: italic;">// etc...</span><br><span style="color: #009900;">}</span></pre>
<a name="Apache_Camel_Integration"></a><h1> <span class="mw-headline">Apache Camel Integration</span></h1>
<p>The Camel-Smooks integration lets you to access all the features of Smooks from within Camel. You can take an existing Smooks configuration and use this in your Camel routes using one of the options that are described in this chapter. If you are interested in routing from Smooks to Camel endpoints the please refer to the Camel section in <a href="#Camel" title="">Routing</a> chapter.
</p><p>Using Smooks in Camel can be done in three ways:
</p>
<ol><li> <a href="#SmooksComponent" title="">SmooksComponent</a>
</li><li> <a href="#SmooksDataformat" title="">SmooksDataformat</a>
</li><li> <a href="#SmooksProcessor" title="">SmooksProcessor</a>
</li></ol>
<a name="SmooksComponent"></a><h2> <span class="mw-headline"> SmooksComponent </span></h2>
<p>The SmooksComponent is a Camel [<a href="http://camel.apache.org/component.html%7C" class="external text" title="http://camel.apache.org/component.html|" rel="nofollow">Component</a>] which can used when you want to process the Camel Message Body using Smooks. You can do this by adding a route in your Camel route configuration:
</p>
<pre class="java" style="font-family:monospace;">from<span style="color: #009900;">(</span><span style="color: #0000ff;">"file://inputDir?noop=true"</span><span style="color: #009900;">)</span><br>.<span style="color: #006633;">to</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"smooks://smooks-config.xml"</span><span style="color: #009900;">)</span><br>.<span style="color: #006633;">to</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"jms:queue:order"</span><span style="color: #009900;">)</span></pre>
<p>The Smooks Component is configured with a mandatory configuration file, which is 'smooks-config-xml' in the example above.
By just looking at the above route definition it is not clear what type of output that the SmooksComponent is producing. This is actually expressed in the Smooks configuration using the <a href="#Output.2FExport_Result_type_declaration" title=""> exports</a> element.
</p><p>If you prefer/require programmatic configuration of Smooks you can use the <a href="#SmooksProcessor" title=""> SmooksProcessor</a> to achieve this.
</p>
<a name="Options"></a><h4> <span class="mw-headline"> Options </span></h4>
<p>An Apache Component can take options that are specified after the Smooks configuration file. Currently only one option is available for the SmooksComponent:
</p>
<ol><li> <b>reportPath</b> which is path (including the file name) to the Smooks Excecution Report to be generated.
</li></ol>
<a name="SmooksDataformat"></a><h2> <span class="mw-headline"> SmooksDataformat </span></h2>
<p>SmooksDataFormat is a Camel DataFormat which is capable of transforming from one dataformat to another and back again. You would use this when you are only interested in transforming from one format to another and not interested in other Smooks features.
</p><p>Below is an example of using SmooksDataFormat to transform a comma separated value string into a java.util.List of Customer object instances:
</p>
<pre class="java" style="font-family:monospace;">SmooksDataFormat sdf <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SmooksDataFormat<span style="color: #009900;">(</span><span style="color: #0000ff;">"csv-smooks-unmarshal-config.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>from<span style="color: #009900;">(</span><span style="color: #0000ff;">"direct:unmarshal"</span><span style="color: #009900;">)</span><br>.<span style="color: #006633;">unmarshal</span><span style="color: #009900;">(</span>sdf<span style="color: #009900;">)</span><br>.<span style="color: #006633;">convertBodyTo</span><span style="color: #009900;">(</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Alist+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">List</span></a>.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">)</span><br>.<span style="color: #006633;">to</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"mock:result"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<a name="SmooksProcessor"></a><h2> <span class="mw-headline"> SmooksProcessor </span></h2>
<p>Using the SmooksProcessor gives you full control over Smooks, for example if you want to programatically create the underlying Smooks instance you’d use the SmooksProcessor. When using the SmooksProcessor you can pass a Smooks instance to its constructor and prior to that programmatically configure Smooks.
</p><p>Below is an example of using the SmooksProcessor in a Camel route:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #0000ff;">"edi-to-xml-smooks-config.xml"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>ExecutionContext context <span style="color: #339933;">=</span> smooks.<span style="color: #006633;">createExecutionContext</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>...<br><span style="color: #006633;">SmooksProcessor</span> processor <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SmooksProcessor<span style="color: #009900;">(</span>smooks, context<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>&nbsp;<br>from<span style="color: #009900;">(</span><span style="color: #0000ff;">"file://input?noop=true"</span><span style="color: #009900;">)</span><br>.<span style="color: #006633;">process</span><span style="color: #009900;">(</span>processor<span style="color: #009900;">)</span><br>.<span style="color: #006633;">to</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"mock:result"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Similar to the SmooksComponent we have not specified the result type that Smooks produces (if any that is). Instead this is expressed in the Smooks configuration using the <a href="#Output.2FExport_Result_type_declaration" title=""> exports</a> element or you can do the same programmatically like this:
</p>
<pre class="java" style="font-family:monospace;">Smooks smooks <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Smooks<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>ExecutionContext context <span style="color: #339933;">=</span> smooks.<span style="color: #006633;">createExecutionContext</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>smooks.<span style="color: #006633;">setExports</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">new</span> Exports<span style="color: #009900;">(</span>StringResult.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>SmooksProcessor processor <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SmooksProcessor<span style="color: #009900;">(</span>smooks, context<span style="color: #009900;">)</span><span style="color: #339933;">;</span><br>...<br><span style="color: #006633;">from</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"file://input?noop=true"</span><span style="color: #009900;">)</span><br>.<span style="color: #006633;">process</span><span style="color: #009900;">(</span>processor<span style="color: #009900;">)</span><br>.<span style="color: #006633;">to</span><span style="color: #009900;">(</span><span style="color: #0000ff;">"mock:result"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p><br>
</p>
<a name="Apache_Camel_Examples"></a><h2> <span class="mw-headline">Apache Camel Examples</span></h2>
<p>Please see the <a href="http://smooks.org/mediawiki/index.php?title=Smooks_v1.5_Examples#Apache_Camel" title="Smooks v1.5 Examples">Apache Camel Examples</a> in the Examples page.
</p>
<!--
NewPP limit report
Preprocessor node count: 960/1000000
Post-expand include size: 9224/2097152 bytes
Template argument size: 3905/2097152 bytes
Expensive parser function count: 0/100
-->

                        <!-- end content -->
            <div class="visualClear"></div>
        </div>
    </div>
    <!-- end of content -->
    </div>

    <!-- end of gumax-content-body -->




	<div id="gumax_footer_spacer"></div>
	<!-- ///// gumax-footer ///// -->
	<div id="gumax-footer">


</div>
<!-- ===== end of gumax-page ===== -->
<div class="visualClear"></div><div id="gumax_page_spacer"></div>



<!-- Served in 43.687 secs. -->




	<!-- ======================================== FUNCTIONS ======================================= -->
</body><!-- Cached 20160818201138 --></html>
